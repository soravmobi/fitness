/**
 * @license OpenTok.js v2.6.9 26c0968 HEAD
 *
 * Copyright (c) 2010-2015 TokBox, Inc.
 * Subject to the applicable Software Development Kit (SDK) License Agreement:
 * https://tokbox.com/support/sdk_license
 *
 * Date: October 30 12:16:40 2015
 */
!function(a){!function(a,b,c){function d(a){if("string"==typeof a)return a;var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&").replace(/\+/g,"%20")}function e(a,b){return b?k.hasCapabilities("classList")?a.classList.contains(b):a.className.indexOf(b)>-1:!1}function f(a,b){if(b&&0!==b.length&&1===a.nodeType){var c=b.length,d=0;if(k.hasCapabilities("classList"))for(;c>d;++d)a.classList.toggle(b[d]);else{for(var f=(" "+a.className+" ").replace(/[\s+]/," ");c>d;++d)e(a,b[d])?f=f.replace(" "+b[d]+" "," "):f+=b[d]+" ";a.className=k.trim(f)}}}function g(a,b){if(b&&0!==b.length&&1===a.nodeType){var c=b.length,d=0;if(k.hasCapabilities("classList"))for(;c>d;++d)a.classList.add(b[d]);else if(a.className||1!==b.length){for(var e=" "+a.className+" ";c>d;++d)~e.indexOf(" "+b[d]+" ")||(e+=b[d]+" ");a.className=k.trim(e)}else a.className=b.join(" ")}}function h(a,b){if(b&&0!==b.length&&1===a.nodeType){var c=b.length,d=0;if(k.hasCapabilities("classList"))for(;c>d;++d)a.classList.remove(b[d]);else{for(var e=(" "+a.className+" ").replace(/[\s+]/," ");c>d;++d)e=e.replace(" "+b[d]+" "," ");a.className=k.trim(e)}}}/**
 * @license  Common JS Helpers on OpenTok 0.4.1 259ca46 v0.4.1-branch
 * http://www.tokbox.com/
 *
 * Copyright (c) 2015 TokBox, Inc.
 *
 * Date: October 30 12:16:29 2015
 *
 */
var i=Array.prototype.slice,j=/^#([\w-]*)$/,b=function(c,d){var e=[];if("string"==typeof c){var f=j.exec(c);if(d=d||document,f&&f[1]){var g=d.getElementById(f[1]);g&&e.push(g)}else e=d.querySelectorAll(c)}else c&&(c.nodeType||a.XMLHttpRequest&&c instanceof XMLHttpRequest)?(e=[c],d=c):b.isArray(c)&&(e=c.slice(),d=null);return new m(e,d)},k=b,l=function(a){if("IE"!==k.env.name||k.env.version>9)return i.call(a);for(var b=[],c=0,d=a.length;d>c;++c)b.push(a[c]);return b},m=function(a,b){var c=l(a);this.context=b,this.toArray=function(){return c},this.length=c.length,this.first=c[0],this.last=c[c.length-1],this.get=function(a){return void 0===a?c:c[a]}};m.prototype.some=function(a,b){return k.some(this.get(),a,b)},m.prototype.forEach=function(a,b){return k.forEach(this.get(),a,b),this},m.prototype.map=function(a,b){return new m(k.map(this.get(),a,b),this.context)},m.prototype.filter=function(a,b){return new m(k.filter(this.get(),a,b),this.context)},m.prototype.find=function(a){return k(a,this.first)};var n=a.OTHelpers;a.OTHelpers=b,a.___othelpers=!0,b.keys=Object.keys||function(a){var b=[],c=Object.prototype.hasOwnProperty;for(var d in a)c.call(a,d)&&b.push(d);return b};var o=Array.prototype.forEach||function(a,b){for(var c=0,d=this.length||0;d>c;++c)c in this&&a.call(b,this[c],c)};b.forEach=function(a,b,c){return o.call(a,b,c)};var p=Array.prototype.map||function(a,b){var c=[];return o.call(this,function(d,e){c.push(a.call(b,d,e))}),c};b.map=function(a,b){return p.call(a,b)};var q=Array.prototype.filter||function(a,b){var c=[];return o.call(this,function(d,e){a.call(b,d,e)&&c.push(d)}),c};b.filter=function(a,b,c){return q.call(a,b,c)};var r=Array.prototype.some||function(a,b){for(var c=!1,d=0,e=this.length||0;e>d;++d)if(d in this&&a.call(b,this[d],d)){c=!0;break}return c};b.find=function(a,b,c){if(!k.isFunction(b))throw new TypeError("iter must be a function");for(var d=void 0,e=0,f=a.length||0;f>e;++e)if(e in a&&b.call(c,a[e],e)){d=a[e];break}return d},b.findIndex=function(a,b,c){if(!k.isFunction(b))throw new TypeError("iter must be a function");for(var d=0,e=a.length||0;e>d;++d)if(d in a&&b.call(c,a[d],d,a))return d;return-1},b.some=function(a,b,c){return r.call(a,b,c)};var s=Array.prototype.indexOf||function(a,b){var c,d,e=b?b:0;if(!this)throw new TypeError;if(d=this.length,0===d||e>=d)return-1;for(0>e&&(e=d-Math.abs(e)),c=e;d>c;c++)if(this[c]===a)return c;return-1};b.arrayIndexOf=function(a,b,c){return s.call(a,b,c)};var t=Function.prototype.bind||function(){var a=i.call(arguments),b=a.shift(),c=this;return function(){return c.apply(b,a.concat(i.call(arguments)))}};b.bind=function(){var a=i.call(arguments),b=a.shift();return t.apply(b,a)};var u=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")};b.trim=function(a){return u.call(a)},b.noConflict=function(){return b.noConflict=function(){return b},a.OTHelpers=n,b},b.isNone=function(a){return void 0===a||null===a},b.isObject=function(a){return a===Object(a)},b.isFunction=function(a){return!!a&&(-1!==a.toString().indexOf("()")||"[object Function]"===Object.prototype.toString.call(a))},b.isArray=b.isFunction(Array.isArray)&&Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},b.isEmpty=function(a){if(null===a||void 0===a)return!0;if(b.isArray(a)||"string"==typeof a)return 0===a.length;for(var c in a)if(a.hasOwnProperty(c))return!1;return!0},b.extend=function(){var a=i.call(arguments),c=a.shift();return b.forEach(a,function(a){for(var b in a)c[b]=a[b]}),c},b.defaults=function(){var a=i.call(arguments),c=a.shift();return b.forEach(a,function(a){for(var b in a)void 0===c[b]&&(c[b]=a[b])}),c},b.clone=function(a){return b.isObject(a)?b.isArray(a)?a.slice():b.extend({},a):a},b.noop=function(){},b.now=function(){var c,d=a.performance||{},e=d.now||d.mozNow||d.msNow||d.oNow||d.webkitNow;return e?(e=b.bind(e,d),c=d.timing.navigationStart,function(){return c+e()}):function(){return(new Date).getTime()}}(),b.canDefineProperty=!0;try{Object.defineProperty({},"x",{})}catch(v){b.canDefineProperty=!1}b.defineGetters=function(a,c,d){var e={};void 0===d&&(d=!1);for(var f in c)e[f]={get:c[f],enumerable:d};b.defineProperties(a,e)};var w=function(a,b,c){return b&&!c?function(){return b.call(a)}:b&&c?function(d){return void 0!==d&&c.call(a,d),b.call(a)}:function(b){void 0!==b&&c.call(a,b)}};b.defineProperties=function(a,b){for(var c in b)a[c]=w(a,b[c].get,b[c].set)},Object.create||(Object.create=function(a){function b(){}if(arguments.length>1)throw new Error("Object.create implementation only accepts the first parameter.");return b.prototype=a,new b}),b.invert=function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[a[c]]=c);return b},b.makeSimplePromise=function(a){return new b.RSVP.Promise(function(b,c){void 0===a?b():c(a)})},b.Event=function(){return function(a,d){this.type=a,this.cancelable=d!==c?d:!0;var e=!1;this.preventDefault=function(){this.cancelable?e=!0:b.warn("Event.preventDefault :: Trying to preventDefault on an Event that isn't cancelable")},this.isDefaultPrevented=function(){return e}}},b.statable=function(a,c,d,e,f){var g,h=a.currentState=d,i=function(d){if(h!==d){if(-1===b.arrayIndexOf(c,d))return void(f&&b.isFunction(f)&&f("invalidState",d));a.previousState=g=h,a.currentState=h=d,e&&b.isFunction(e)&&e(d,g)}};return a.is=function(){return-1!==b.arrayIndexOf(arguments,h)},a.isNot=function(){return-1===b.arrayIndexOf(arguments,h)},i},/*!
 *  This is a modified version of Robert Kieffer awesome uuid.js library.
 *  The only modifications we've made are to remove the Node.js specific
 *  parts of the code and the UUID version 1 generator (which we don't
 *  use). The original copyright notice is below.
 *
 *     node-uuid/uuid.js
 *
 *     Copyright (c) 2010 Robert Kieffer
 *     Dual licensed under the MIT and GPL licenses.
 *     Documentation and details at https://github.com/broofa/node-uuid
 */
function(){function c(a,b,c){var d=b&&c||0,e=0;for(b=b||[],a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){16>e&&(b[d+e++]=m[a])});16>e;)b[d+e++]=0;return b}function d(a,b){var c=b||0,d=l;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}function e(a,b,c){var e=b&&c||0;"string"==typeof a&&(b="binary"===a?new k(16):null,a=null),a=a||{};var f=a.random||(a.rng||j)();if(f[6]=15&f[6]|64,f[8]=63&f[8]|128,b)for(var g=0;16>g;g++)b[e+g]=f[g];return b||d(f)}var f,g,h=new Array(16);if(f=function(){var a,b=h,c=0;for(c=0;16>c;c++)0===(3&c)&&(a=4294967296*Math.random()),b[c]=a>>>((3&c)<<3)&255;return b},a.crypto&&crypto.getRandomValues){var i=new Uint32Array(4);g=function(){crypto.getRandomValues(i);for(var a=0;16>a;a++)h[a]=i[a>>2]>>>8*(3&a)&255;return h}}for(var j=g||f,k="function"==typeof Buffer?Buffer:Array,l=[],m={},n=0;256>n;n++)l[n]=(n+256).toString(16).substr(1),m[l[n]]=n;var o=e;o.v4=e,o.parse=c,o.unparse=d,o.BufferClass=k,o.mathRNG=f,o.whatwgRNG=g,b.uuid=o}(),/*!
 * @overview RSVP - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/tildeio/rsvp.js/master/LICENSE
 * @version   3.0.16
 */
function(){"use strict";function d(a){return"function"==typeof a||"object"==typeof a&&null!==a}function e(a){return"function"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(){}function h(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1}function i(a){var b=a._promiseCallbacks;return b||(b=a._promiseCallbacks={}),b}function j(a,b){return"onerror"===a?void ya.on("error",b):2!==arguments.length?ya[a]:void(ya[a]=b)}function k(){setTimeout(function(){for(var a,b=0;b<za.length;b++){a=za[b];var c=a.payload;c.guid=c.key+c.id,c.childGuid=c.key+c.childId,c.error&&(c.stack=c.error.stack),ya.trigger(a.name,a.payload)}za.length=0},50)}function l(a,b,c){1===za.push({name:a,payload:{key:b._guidKey,id:b._id,eventName:a,detail:b._result,childId:c&&c._id,label:b._label,timeStamp:va(),error:ya["instrument-with-stack"]?new Error(b._label):null}})&&k()}function m(){return new TypeError("A promises callback cannot return that same promise.")}function n(){}function o(a){try{return a.then}catch(b){return Ea.error=b,Ea}}function p(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}function q(a,b,c){ya.async(function(a){var d=!1,e=p(c,b,function(c){d||(d=!0,b!==c?t(a,c):v(a,c))},function(b){d||(d=!0,w(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,w(a,e))},a)}function r(a,b){b._state===Ca?v(a,b._result):b._state===Da?(b._onError=null,w(a,b._result)):x(b,c,function(c){b!==c?t(a,c):v(a,c)},function(b){w(a,b)})}function s(a,b){if(b.constructor===a.constructor)r(a,b);else{var d=o(b);d===Ea?w(a,Ea.error):d===c?v(a,b):e(d)?q(a,b,d):v(a,b)}}function t(a,b){a===b?v(a,b):d(b)?s(a,b):v(a,b)}function u(a){a._onError&&a._onError(a._result),y(a)}function v(a,b){a._state===Ba&&(a._result=b,a._state=Ca,0===a._subscribers.length?ya.instrument&&Aa("fulfilled",a):ya.async(y,a))}function w(a,b){a._state===Ba&&(a._state=Da,a._result=b,ya.async(u,a))}function x(a,b,c,d){var e=a._subscribers,f=e.length;a._onError=null,e[f]=b,e[f+Ca]=c,e[f+Da]=d,0===f&&a._state&&ya.async(y,a)}function y(a){var b=a._subscribers,c=a._state;if(ya.instrument&&Aa(c===Ca?"fulfilled":"rejected",a),0!==b.length){for(var d,e,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?B(c,d,e,f):e(f);a._subscribers.length=0}}function z(){this.error=null}function A(a,b){try{return a(b)}catch(c){return Fa.error=c,Fa}}function B(a,b,c,d){var f,g,h,i,j=e(c);if(j){if(f=A(c,d),f===Fa?(i=!0,g=f.error,f=null):h=!0,b===f)return void w(b,m())}else f=d,h=!0;b._state!==Ba||(j&&h?t(b,f):i?w(b,g):a===Ca?v(b,f):a===Da&&w(b,f))}function C(a,b){var c=!1;try{b(function(b){c||(c=!0,t(a,b))},function(b){c||(c=!0,w(a,b))})}catch(d){w(a,d)}}function D(a,b,c){return a===Ca?{state:"fulfilled",value:c}:{state:"rejected",reason:c}}function E(a,b,c,d){this._instanceConstructor=a,this.promise=new a(n,d),this._abortOnReject=c,this._validateInput(b)?(this._input=b,this.length=b.length,this._remaining=b.length,this._init(),0===this.length?v(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&v(this.promise,this._result))):w(this.promise,this._validationError())}function F(a,b){return new Ga(this,a,!0,b).promise}function G(a,b){function d(a){t(g,a)}function e(a){w(g,a)}var f=this,g=new f(n,b);if(!ua(a))return w(g,new TypeError("You must pass an array to race.")),g;for(var h=a.length,i=0;g._state===Ba&&h>i;i++)x(f.resolve(a[i]),c,d,e);return g}function H(a,b){var c=this;if(a&&"object"==typeof a&&a.constructor===c)return a;var d=new c(n,b);return t(d,a),d}function I(a,b){var c=this,d=new c(n,b);return w(d,a),d}function J(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function K(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function L(a,b){this._id=Ma++,this._label=b,this._state=c,this._result=c,this._subscribers=[],ya.instrument&&Aa("created",this),n!==a&&(e(a)||J(),this instanceof L||K(),C(this,a))}function M(a,b,c){this._superConstructor(a,b,!1,c)}function N(a,b){return new M(Na,a,b).promise}function O(a,b){return Na.all(a,b)}function P(a,b){Za[Sa]=a,Za[Sa+1]=b,Sa+=2,2===Sa&&Pa()}function Q(){var a=process.nextTick,b=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(b)&&"0"===b[1]&&"10"===b[2]&&(a=setImmediate),function(){a(V)}}function R(){return function(){Oa(V)}}function S(){var a=0,b=new Wa(V),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function T(){var a=new MessageChannel;return a.port1.onmessage=V,function(){a.port2.postMessage(0)}}function U(){return function(){setTimeout(V,1)}}function V(){for(var a=0;Sa>a;a+=2){var b=Za[a],d=Za[a+1];b(d),Za[a]=c,Za[a+1]=c}Sa=0}function W(){try{var a=require,b=a("vertx");return Oa=b.runOnLoop||b.runOnContext,R()}catch(c){return U()}}function X(a){var b={};return b.promise=new Na(function(a,c){b.resolve=a,b.reject=c},a),b}function Y(a,b,c){return Na.all(a,c).then(function(a){if(!e(b))throw new TypeError("You must pass a function as filter's second argument.");for(var d=a.length,f=new Array(d),g=0;d>g;g++)f[g]=b(a[g]);return Na.all(f,c).then(function(b){for(var c=new Array(d),e=0,f=0;d>f;f++)b[f]&&(c[e]=a[f],e++);return c.length=e,c})})}function Z(a,b,c){this._superConstructor(a,b,!0,c)}function $(a,b,c){this._superConstructor(a,b,!1,c)}function _(a,b){return new $(Na,a,b).promise}function aa(a,b){return new ab(Na,a,b).promise}function ba(a,b,c){return Na.all(a,c).then(function(a){if(!e(b))throw new TypeError("You must pass a function as map's second argument.");for(var d=a.length,f=new Array(d),g=0;d>g;g++)f[g]=b(a[g]);return Na.all(f,c)})}function ca(){this.value=c}function da(a){try{return a.then}catch(b){return eb.value=b,eb}}function ea(a,b,c){try{a.apply(b,c)}catch(d){return eb.value=d,eb}}function fa(a,b){for(var c,d,e={},f=a.length,g=new Array(f),h=0;f>h;h++)g[h]=a[h];for(d=0;d<b.length;d++)c=b[d],e[c]=g[d+1];return e}function ga(a){for(var b=a.length,c=new Array(b-1),d=1;b>d;d++)c[d-1]=a[d];return c}function ha(a,b){return{then:function(c,d){return a.call(b,c,d)}}}function ia(a,b){var d=function(){for(var d,e=this,f=arguments.length,g=new Array(f+1),h=!1,i=0;f>i;++i){if(d=arguments[i],!h){if(h=la(d),h===fb){var j=new Na(n);return w(j,fb.value),j}h&&h!==!0&&(d=ha(h,d))}g[i]=d}var k=new Na(n);return g[f]=function(a,d){a?w(k,a):b===c?t(k,d):b===!0?t(k,ga(arguments)):ua(b)?t(k,fa(arguments,b)):t(k,d)},h?ka(k,g,a,e):ja(k,g,a,e)};return d.__proto__=a,d}function ja(a,b,c,d){var e=ea(c,d,b);return e===eb&&w(a,e.value),a}function ka(a,b,c,d){return Na.all(b).then(function(b){var e=ea(c,d,b);return e===eb&&w(a,e.value),a})}function la(a){return a&&"object"==typeof a?a.constructor===Na?!0:da(a):!1}function ma(a,b){return Na.race(a,b)}function na(a,b){return Na.reject(a,b)}function oa(a,b){return Na.resolve(a,b)}function pa(a){throw setTimeout(function(){throw a}),a}function qa(a,b){ya.async(a,b)}function ra(){ya.on.apply(ya,arguments)}function sa(){ya.off.apply(ya,arguments)}var ta;ta=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};var ua=ta,va=Date.now||function(){return(new Date).getTime()},wa=Object.create||function(a){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof a)throw new TypeError("Argument must be an object");return g.prototype=a,new g},xa={mixin:function(a){return a.on=this.on,a.off=this.off,a.trigger=this.trigger,a._promiseCallbacks=c,a},on:function(a,b){var c,d=i(this);c=d[a],c||(c=d[a]=[]),-1===h(c,b)&&c.push(b)},off:function(a,b){var c,d,e=i(this);return b?(c=e[a],d=h(c,b),void(-1!==d&&c.splice(d,1))):void(e[a]=[])},trigger:function(a,b){var c,d,e=i(this);if(c=e[a])for(var f=0;f<c.length;f++)(d=c[f])(b)}},ya={instrument:!1};xa.mixin(ya);var za=[],Aa=l,Ba=void 0,Ca=1,Da=2,Ea=new z,Fa=new z,Ga=E;E.prototype._validateInput=function(a){return ua(a)},E.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},E.prototype._init=function(){this._result=new Array(this.length)},E.prototype._enumerate=function(){for(var a=this.length,b=this.promise,c=this._input,d=0;b._state===Ba&&a>d;d++)this._eachEntry(c[d],d)},E.prototype._eachEntry=function(a,b){var c=this._instanceConstructor;f(a)?a.constructor===c&&a._state!==Ba?(a._onError=null,this._settledAt(a._state,b,a._result)):this._willSettleAt(c.resolve(a),b):(this._remaining--,this._result[b]=this._makeResult(Ca,b,a))},E.prototype._settledAt=function(a,b,c){var d=this.promise;d._state===Ba&&(this._remaining--,this._abortOnReject&&a===Da?w(d,c):this._result[b]=this._makeResult(a,b,c)),0===this._remaining&&v(d,this._result)},E.prototype._makeResult=function(a,b,c){return c},E.prototype._willSettleAt=function(a,b){var d=this;x(a,c,function(a){d._settledAt(Ca,b,a)},function(a){d._settledAt(Da,b,a)})};var Ha=F,Ia=G,Ja=H,Ka=I,La="rsvp_"+va()+"-",Ma=0,Na=L;L.cast=Ja,L.all=Ha,L.race=Ia,L.resolve=Ja,L.reject=Ka,L.prototype={constructor:L,_guidKey:La,_onError:function(a){ya.async(function(b){setTimeout(function(){b._onError&&ya.trigger("error",a)},0)},this)},then:function(a,b,c){var d=this,e=d._state;if(e===Ca&&!a||e===Da&&!b)return ya.instrument&&Aa("chained",this,this),this;d._onError=null;var f=new this.constructor(n,c),g=d._result;if(ya.instrument&&Aa("chained",d,f),e){var h=arguments[e-1];ya.async(function(){B(e,f,h,g)})}else x(d,f,a,b);return f},"catch":function(a,b){return this.then(null,a,b)},"finally":function(a,b){var c=this.constructor;return this.then(function(b){return c.resolve(a()).then(function(){return b})},function(b){return c.resolve(a()).then(function(){throw b})},b)}},M.prototype=wa(Ga.prototype),M.prototype._superConstructor=Ga,M.prototype._makeResult=D,M.prototype._validationError=function(){return new Error("allSettled must be called with an array")};var Oa,Pa,Qa=N,Ra=O,Sa=0,Ta=({}.toString,P),Ua="undefined"!=typeof a?a:c,Va=Ua||{},Wa=Va.MutationObserver||Va.WebKitMutationObserver,Xa="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),Ya="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Za=new Array(1e3);Pa=Xa?Q():Wa?S():Ya?T():Ua===c&&"function"==typeof require?W():U();var $a=X,_a=Y,ab=Z;Z.prototype=wa(Ga.prototype),Z.prototype._superConstructor=Ga,Z.prototype._init=function(){this._result={}},Z.prototype._validateInput=function(a){return a&&"object"==typeof a},Z.prototype._validationError=function(){return new Error("Promise.hash must be called with an object")},Z.prototype._enumerate=function(){var a=this.promise,b=this._input,c=[];for(var d in b)a._state===Ba&&b.hasOwnProperty(d)&&c.push({position:d,entry:b[d]});var e=c.length;this._remaining=e;for(var f,g=0;a._state===Ba&&e>g;g++)f=c[g],this._eachEntry(f.entry,f.position)},$.prototype=wa(ab.prototype),$.prototype._superConstructor=Ga,$.prototype._makeResult=D,$.prototype._validationError=function(){return new Error("hashSettled must be called with an object")};var bb=_,cb=aa,db=ba,eb=new ca,fb=new ca,gb=ia,hb=ma,ib=na,jb=oa,kb=pa;ya.async=Ta;if("undefined"!=typeof a&&"object"==typeof a.__PROMISE_INSTRUMENTATION__){var lb=a.__PROMISE_INSTRUMENTATION__;j("instrument",!0);for(var mb in lb)lb.hasOwnProperty(mb)&&ra(mb,lb[mb])}var nb={race:hb,Promise:Na,allSettled:Qa,hash:cb,hashSettled:bb,denodeify:gb,on:ra,off:sa,map:db,filter:_a,resolve:jb,reject:ib,all:Ra,rethrow:kb,defer:$a,EventTarget:xa,configure:j,async:qa};b.RSVP=nb}.call(this);var x,y=["description","fileName","lineNumber","message","name","number","stack"];b.Error=function(a,b,c){switch(arguments.length){case 1:k.isObject(a)&&(c=a,b=void 0,a=void 0);break;case 2:k.isObject(b)&&(c=b,b=void 0)}if(c instanceof Error)for(var d=0,e=y.length;e>d;++d)this[y[d]]=c[y[d]];else if(k.isObject(c))for(var f in c)c.hasOwnProperty(f)&&(this[f]=c[f]);if(!(this.fileName&&this.lineNumber&&this.columnNumber&&this.stack)){var g=x();!this.fileName&&g.fileName&&(this.fileName=g.fileName),!this.lineNumber&&g.lineNumber&&(this.lineNumber=g.lineNumber),!this.columnNumber&&g.columnNumber&&(this.columnNumber=g.columnNumber),!this.stack&&g.stack&&(this.stack=g.stack)}!this.message&&a&&(this.message=a),!this.name&&b&&(this.name=b)},b.Error.prototype.toString=b.Error.prototype.valueOf=function(){var a="";return this.fileName&&(a+=" "+this.fileName),this.lineNumber&&(a+=" "+this.lineNumber,this.columnNumber&&(a+=":"+this.columnNumber)),"<"+(this.name?this.name+" ":"")+this.message+a+">"};var z=function(a,b){return k.map(b.slice(2),function(a){var b={fileName:a.getFileName(),linenumber:a.getLineNumber(),columnNumber:a.getColumnNumber()};return a.getFunctionName()&&(b.functionName=a.getFunctionName()),a.getMethodName()&&(b.methodName=a.getMethodName()),a.getThis()&&(b.self=a.getThis()),b})};x=function(){var b,c,d,e={};switch(k.env.name){case"Firefox":case"Safari":case"IE":if("IE"!==k.env.name)d=new Error;else try{a.call.js.is.explody}catch(f){d=f}b=(d.stack||"").split("\n"),b.shift(),b.shift(),e.stack=b,"IE"===k.env.name&&(e.stack.shift(),e.stack=k.map(b,function(a){return a.replace(/^\s+at\s+/g,"")})),c=/@(.+?):([0-9]+)(:([0-9]+))?$/.exec(b[0]),c&&(e.fileName=c[1],e.lineNumber=parseInt(c[2],10),c.length>3&&(e.columnNumber=parseInt(c[4],10)));break;case"Chrome":case"Node":case"Opera":var g=Error.prepareStackTrace;Error.prepareStackTrace=z,d=new Error,e.stack=d.stack,Error.prepareStackTrace=g;var h=e.stack[0];e.lineNumber=h.lineNumber,e.columnNumber=h.columnNumber,e.fileName=h.fileName,h.functionName&&(e.functionName=h.functionName),h.methodName&&(e.methodName=h.methodName),h.self&&(e.self=h.self);break;default:d=new Error,d.stack&&(e.stack=d.stack.split("\n"))}return d.message&&(e.message=d.message),e},function(){var c=-1,d=function(a){if(a===c)return!0;if("number"==typeof a&&"number"==typeof c)return a>c;for(var b=a.split("."),d=c.split("."),e=(b.length>d.length?d:b).length,f=0;e>f;++f)if(parseInt(b[f],10)>parseInt(d[f],10))return!0;return f<b.length?!0:!1},e=function(){if("undefined"!=typeof process&&"undefined"!=typeof process.versions&&"string"==typeof process.versions.node)return c=process.versions.node,"v"===c.substr(1)&&(c=c.substr(1)),{name:"Node",version:c,userAgent:"Node "+c,iframeNeedsLoad:!1,versionGreaterThan:d};var b,e=a.navigator.userAgent.toLowerCase(),f=a.navigator.appName,g="unknown";return e.indexOf("opera")>-1||e.indexOf("opr")>-1?(g="Opera",null!==/opr\/([0-9]{1,}[\.0-9]{0,})/.exec(e)&&(c=parseFloat(RegExp.$1))):e.indexOf("firefox")>-1?(g="Firefox",null!==/firefox\/([0-9]{1,}[\.0-9]{0,})/.exec(e)&&(c=parseFloat(RegExp.$1))):"Microsoft Internet Explorer"===f?(g="IE",null!==/msie ([0-9]{1,}[\.0-9]{0,})/.exec(e)&&(c=parseFloat(RegExp.$1))):"Netscape"===f&&e.indexOf("trident")>-1?(g="IE",null!==/trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(e)&&(c=parseFloat(RegExp.$1))):e.indexOf("chrome")>-1?(g="Chrome",null!==/chrome\/([0-9]{1,}[\.0-9]{0,})/.exec(e)&&(c=parseFloat(RegExp.$1))):(b=a.navigator.vendor)&&b.toLowerCase().indexOf("apple")>-1&&(g="Safari",null!==/version\/([0-9]{1,}[\.0-9]{0,})/.exec(e)&&(c=parseFloat(RegExp.$1))),{name:g,version:c,userAgent:a.navigator.userAgent,iframeNeedsLoad:e.indexOf("webkit")<0,versionGreaterThan:d}}();b.env=e,b.browser=function(){return b.env.name},b.browserVersion=function(){return b.env}}();var A;"Node"===k.env.name&&!function(){var a=require("events").EventEmitter,b=require("util"),c=function(){a.call(this),this.events={}};b.inherits(c,a),A=function(){var a=new c,b=a.on,d=a.removeListener;return a.addListeners=function(c,d,e,f){var g={handler:d};e&&(g.context=e),f&&(g.closure=f),k.forEach(c,function(c){a.events[c]||(a.events[c]=[]),a.events[c].push(g),b(c,d);var e=c+":added";a.events[e]&&a.emit(e,a.events[c].length)})},a.removeAllListenersNamed=function(b){var c=b.split(" ");a.removeAllListeners(c),k.forEach(c,function(b){a.events[b]&&delete a.events[b]})},a.removeListeners=function(b,c,e){function f(a){return!(a.handler===c&&a.closure===e)}k.forEach(b.split(" "),function(b){if(a.events[b]){d(b,c),a.events[b]=k.filter(a.events[b],f),0===a.events[b].length&&delete a.events[b];var e=b+":removed";a.events[e]&&a.emit(e,a.events[b]?a.events[b].length:0)}})},a.removeAllListeners=function(){a.events={},a.removeAllListeners()},a.dispatchEvent=function(a,b){this.emit(a.type,a),b&&b.call(null,a)},a.trigger=k.bind(a.emit,a),a}}();var B;if("Node"!==k.env.name&&(B=function(a,b){function c(a,b){a&&a.apply(null,b.slice())}function d(a,b,d){var e=f.events[a];if(e&&0!==e.length){var g=e.length;k.forEach(e,function(e){function h(a){return a.handler===e.handler}k.callAsync(function(){try{f.events[a]&&k.some(f.events[a],h)&&(e.closure||e.handler).apply(e.context||null,b)}finally{g--,0===g&&c(d,b)}})})}}function e(a,b){var c=f.events[a];c&&0!==c.length&&k.forEach(c,function(a){(a.closure||a.handler).apply(a.context||null,b)})}var f={events:{}},g=b===!0?e:d;return f.addListeners=function(a,b,c,d){var e={handler:b};c&&(e.context=c),d&&(e.closure=d),k.forEach(a,function(a){f.events[a]||(f.events[a]=[]),f.events[a].push(e);var b=a+":added";f.events[b]&&g(b,[f.events[a].length])})},f.removeListeners=function(a,b,c){function d(a){var d=a.handler.originalHandler===b||a.handler===b;return!(d&&a.context===c)}k.forEach(a,function(a){if(f.events[a]){f.events[a]=k.filter(f.events[a],d),0===f.events[a].length&&delete f.events[a];var b=a+":removed";f.events[b]&&g(b,[f.events[a]?f.events[a].length:0])}})},f.removeAllListenersNamed=function(a){k.forEach(a,function(a){f.events[a]&&delete f.events[a]})},f.removeAllListeners=function(){f.events={}},f.dispatchEvent=function(a,b){return f.events[a.type]&&0!==f.events[a.type].length?void g(a.type,[a],b):void c(b,[a])},f.trigger=function(a,b){f.events[a]&&0!==f.events[a].length&&g(a,b)},f}),"Node"===a.OTHelpers.env.name){var C=require("request");b.request=function(a,b,c){var d=function(a,b,d){var e={response:b,body:d};!a&&b.statusCode>=200&&(b.statusCode<300||304===b.statusCode)?c(null,e):c(a,e)};"get"===b.method.toLowerCase()?C.get(a,d):C.post(a,b.body,d)},b.getJSON=function(a,b,c){var d=require("underscore").extend({Accept:"application/json"},b.headers||{});C.get({url:a,headers:d,json:!0},function(a,b){c(a,b&&b.body)})}}"Node"!==a.OTHelpers.env.name&&(b.xdomainRequest=function(a,b,c){function e(a,b){f.onload=f.onerror=f.ontimeout=function(){},f=void 0,c(a,b)}var f=new XDomainRequest,g=b||{},h=g.method.toLowerCase();return h?(h=h.toUpperCase(),"GET"!==h&&"POST"!==h?void c(new Error("HTTP method can only be ")):(f.onload=function(){e(null,{target:{responseText:f.responseText,headers:{"content-type":f.contentType}}})},f.onerror=function(){e(new Error("XDomainRequest of "+a+" failed"))},f.ontimeout=function(){e(new Error("XDomainRequest of "+a+" timed out"))},f.open(h,a),void f.send(b.body&&d(b.body)))):void c(new Error("No HTTP method specified in options"))},b.request=function(a,c,e){var f=new XMLHttpRequest,g=c||{},h=g.method;if(!h)return void e(new Error("No HTTP method specified in options"));c.overrideMimeType&&(f.overrideMimeType&&f.overrideMimeType(c.overrideMimeType),delete c.overrideMimeType),e&&(b.on(f,"load",function(a){var b=a.target.status;b>=200&&(300>b||304===b)?e(null,a):e(a)}),b.on(f,"error",e)),f.open(c.method,a,!0),g.headers||(g.headers={});for(var i in g.headers)Object.prototype.hasOwnProperty.call(g.headers,i)&&f.setRequestHeader(i,g.headers[i]);f.send(c.body&&d(c.body))},b.getJSON=function(a,c,d){c=c||{};var e=function(a,b){if(a)d(a,b&&b.target&&b.target.responseText);else{var c;try{c=JSON.parse(b.target.responseText)}catch(e){return void d(e,b&&b.target&&b.target.responseText)}d(null,c,b)}};if(c.xdomainrequest)b.xdomainRequest(a,{method:"GET"},e);else{var f=b.extend({Accept:"application/json"},c.headers||{});b.get(a,b.extend(c||{},{headers:f}),e)}});var D=5,E=4,F=3,G=2,H=1,I=0,J=I,K=function(a){return J="number"==typeof a?a:0};b.useLogHelpers=function(c){function d(b,d,e){return function(){if(c.shouldLog(d)){var f=a.console,g=m(arguments);if(f&&f[b])f[b].apply||k?(f[b].apply||(f[b]=Function.prototype.bind.call(f[b],f)),f[b].apply(f,g)):f[b](g);else if(e)return void e.apply(c,g);h(b,m(arguments))}}}function e(){var a=new Date;return a.toLocaleTimeString()+a.getMilliseconds()}function f(a){try{return JSON.stringify(a)}catch(b){return a.toString()}}function g(a){var c=[];if("undefined"==typeof a);else if(null===a)c.push("NULL");else if(b.isArray(a))for(var d=0;d<a.length;++d)c.push(f(a[d]));else if(b.isObject(a))for(var e in a){var g;b.isFunction(a[e])?a.hasOwnProperty(e)&&(g="function "+e+"()"):g=f(a[e]),c.push(e+": "+g)}else if(b.isFunction(a))try{c.push(a.toString())}catch(h){c.push("function()")}else c.push(a.toString());return c.join(", ")}function h(a,b){if(b){var c=g(b);c.length<=2||j.push([a,e(),c])}}c.DEBUG=D,c.LOG=E,c.INFO=F,c.WARN=G,c.ERROR=H,c.NONE=I;var j=[],k=!0;try{Function.prototype.bind.call(a.console.log,a.console)}catch(l){k=!1}var m=function(a){return a};"IE"===b.env.name&&(m=function(a){return[g(i.apply(a))]}),c.log=d("log",c.LOG),c.debug=d("debug",c.DEBUG,c.log),c.info=d("info",c.INFO,c.log),c.warn=d("warn",c.WARN,c.log),c.error=d("error",c.ERROR,c.log),c.setLogLevel=function(a){return c.debug("TB.setLogLevel("+J+")"),K(a)},c.getLogs=function(){return j},c.shouldLog=function(a){return J>=a}},b.useLogHelpers(b),b.setLogLevel(b.ERROR),m.prototype.on=function(a,b){return this.forEach(function(c){if(c.addEventListener)c.addEventListener(a,b,!1);else if(c.attachEvent)c.attachEvent("on"+a,b);else{var d=c["on"+a];c["on"+a]=function(){b.apply(this,arguments),d&&d.apply(this,arguments)}}})},m.prototype.off=function(a,b){return this.forEach(function(c){c.removeEventListener?c.removeEventListener(a,b,!1):c.detachEvent&&c.detachEvent("on"+a,b)})},m.prototype.once=function(a,b){var c=k.bind(function(){this.off(a,c),b.apply(null,arguments)},this);return this.on(a,c)},b.on=function(a,b,c){return k(a).on(b,c)},b.off=function(a,b,c){return k(a).off(b,c)},b.once=function(a,b,c){return k(a).once(b,c)},function(){var c="undefined"==typeof document||"complete"===document.readyState||"interactive"===document.readyState&&document.body,d=[],e=[],f=!1,g=function(){c=!0,"undefined"!=typeof document&&(document.addEventListener?(document.removeEventListener("DOMContentLoaded",g,!1),a.removeEventListener("load",g,!1)):(document.detachEvent("onreadystatechange",g),a.detachEvent("onload",g))),b.on(a,"unload",h),b.forEach(d,function(a){a[0].call(a[1])}),d=[]},h=function(){f=!0,b.forEach(e,function(a){a[0].call(a[1])}),e=[]};b.onDOMLoad=function(a,c){return b.isReady()?void a.call(c):void d.push([a,c])},b.onDOMUnload=function(a,b){return this.isDOMUnloaded()?void a.call(b):void e.push([a,b])},b.isReady=function(){return!f&&c},b.isDOMUnloaded=function(){return f},c?g():"undefined"!=typeof document&&(document.addEventListener?(document.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&g()}),a.attachEvent("onload",g)))}(),b.setCookie=function(a,b){try{localStorage.setItem(a,b)}catch(c){var d=new Date;d.setTime(d.getTime()+31536e6);var e="; expires="+d.toGMTString();document.cookie=a+"="+b+e+"; path=/"}},b.getCookie=function(a){var b;try{return b=localStorage.getItem(a)}catch(c){for(var d=a+"=",e=document.cookie.split(";"),f=0;f<e.length;f++){for(var g=e[f];" "===g.charAt(0);)g=g.substring(1,g.length);0===g.indexOf(d)&&(b=g.substring(d.length,g.length))}if(b)return b}return null},b.Collection=function(a){var c=[],d={},e=a||"id";b.eventing(this,!0);var f=function(a,c){return b.isFunction(a[c])?a[c]():a[c]},g=b.bind(function(a){this.trigger("update",a),this.trigger("update:"+a.target.id,a)},this),h=b.bind(function(a){this.remove(a.target,a.reason)},this);this.reset=function(){b.forEach(c,function(a){a.off("updated",g,this),a.off("destroyed",h,this)},this),c=[],d={}},this.destroy=function(a){b.forEach(c,function(b){b&&"function"==typeof b.destroy&&b.destroy(a,!0)}),this.reset(),this.off()},this.get=function(a){return a&&void 0!==d[a]?c[d[a]]:void 0},this.has=function(a){return a&&void 0!==d[a]},this.toString=function(){return c.toString()},this.where=function(a,d){return b.isFunction(a)?b.filter(c,a,d):b.filter(c,function(b){for(var c in a)if(a.hasOwnProperty(c)&&f(b,c)!==a[c])return!1;return!0})},this.find=function(a,d){var e;e=b.isFunction(a)?a:function(b){for(var c in a)if(a.hasOwnProperty(c)&&f(b,c)!==a[c])return!1;return!0},e=b.bind(e,d);for(var g=0;g<c.length;++g)if(e(c[g])===!0)return c[g];return null},this.forEach=function(a,d){return b.forEach(c,a,d),this},this.add=function(a){var i=f(a,e);return this.has(i)?(b.warn("Model "+i+" is already in the collection",c),this):(d[i]=c.push(a)-1,a.on("updated",g,this),a.on("destroyed",h,this),this.trigger("add",a),this.trigger("add:"+i,a),this)},this.remove=function(a,b){var i=f(a,e);c.splice(d[i],1);for(var j=d[i];j<c.length;++j)d[c[j][e]]=j;return delete d[i],a.off("updated",g,this),a.off("destroyed",h,this),this.trigger("remove",a,b),this.trigger("remove:"+i,a,b),this},this._triggerAddEvents=function(){var a=this.where.apply(this,arguments);b.forEach(a,function(a){this.trigger("add",a),this.trigger("add:"+f(a,e),a)},this)},this.length=function(){return c.length}},b.castToBoolean=function(a,b){return a===c?b:"true"===a||a===!0},b.roundFloat=function(a,b){return Number(a.toFixed(b))},function(){var a={};b.registerCapability=function(d,e){var f=d.toLowerCase();return a.hasOwnProperty(f)?void b.error("Attempted to register",d,"capability more than once"):b.isFunction(e)?void c(f,e):void b.error("Attempted to register",d,"capability with a callback that isn' a function")};var c=function(b,c){a[b]=function(){var d=c();return a[b]=function(){return d},d}},d=function(b){return a[b]()};b.hasCapabilities=function(){for(var c,e=i.call(arguments),f=0;f<e.length;++f){if(c=e[f].toLowerCase(),!a.hasOwnProperty(c))return b.error("hasCapabilities was called with an unknown capability: "+c),!1;if(d(c)===!1)return!1}return!0}}(),b.registerCapability("websockets",function(){return"WebSocket"in a&&void 0!==a.WebSocket}),function(){var c,d=function(){if(a.postMessage){var b=!0,c=a.onmessage;return a.onmessage=function(){b=!1},a.postMessage("","*"),a.onmessage=c,b}}();if(d){var e=[],f="OTHelpers."+b.uuid.v4()+".zero-timeout",g=function(){e=[],a.removeEventListener?a.removeEventListener("message",h):a.detachEvent&&a.detachEvent("onmessage",h)},h=function(c){if(c.source===a&&c.data===f){if(b.isFunction(c.stopPropagation)&&c.stopPropagation(),c.cancelBubble=!0,!a.___othelpers)return void g();if(e.length>0){var d=e.shift(),h=d.shift();h.apply(null,d)}}};b.on(a,"unload",g),a.addEventListener?a.addEventListener("message",h,!0):a.attachEvent&&a.attachEvent("onmessage",h),c=function(){e.push(i.call(arguments)),a.postMessage(f,"*")}}else c=function(){var a=i.call(arguments),b=a.shift();setTimeout(function(){b.apply(null,a)},0)};b.callAsync=c,b.createAsyncHandler=function(a){return function(){var c=i.call(arguments);b.callAsync(function(){a.apply(null,c)})}}}(),b.eventing=function(a,b){var c=(A||B)(this,b);return a.on=function(a,b,d){if("string"==typeof a&&b)c.addListeners(a.split(" "),b,d);else for(var e in a)a.hasOwnProperty(e)&&c.addListeners([e],a[e],b);return this},a.off=function(a,b,d){if("string"==typeof a)b&&k.isFunction(b)?c.removeListeners(a.split(" "),b,d):c.removeAllListenersNamed(a.split(" "));else if(a)for(var e in a)a.hasOwnProperty(e)&&c.removeListeners([e],a[e],d);else c.removeAllListeners();return this},a.once=function(b,c,d){var e=function(){a.off(b,e,d),c.apply(d,arguments)};return e.originalHandler=c,a.on(b,e,d),this},a.dispatchEvent=function(a,b){if(!a.type)throw k.error("OTHelpers.Eventing.dispatchEvent: Event has no type"),k.error(a),new Error("OTHelpers.Eventing.dispatchEvent: Event has no type");return a.target||(a.target=this),c.dispatchEvent(a,b),this},a.trigger=function(){var a=i.call(arguments);return c.trigger(a.shift(),a),this},a.emit=a.trigger,a.addEventListener=function(b,c,d){return k.warn("The addEventListener() method is deprecated. Use on() or once() instead."),a.on(b,c,d)},a.removeEventListener=function(b,c,d){return k.warn("The removeEventListener() method is deprecated. Use off() instead."),a.off(b,c,d)},a},b.createElement=function(a,b,c,d){var e=(d||document).createElement(a);if(b)for(var f in b)if("object"==typeof b[f]){e[f]||(e[f]={});var g=b[f];for(var h in g)e[f][h]=g[h]}else"className"===f?e.className=b[f]:e.setAttribute(f,b[f]);var i=function(a){"string"==typeof a?e.innerHTML=e.innerHTML+a:e.appendChild(a)};return k.isArray(c)?k.forEach(c,i):c&&i(c),e},b.createButton=function(a,b,c){var d=k.createElement("button",b,a);if(c){for(var e in c)c.hasOwnProperty(e)&&k.on(d,e,c[e]);d._boundEvents=c}return d};var L;L="undefined"!=typeof document&&void 0!==document.createElement("div").firstElementChild?function(a){return a.firstElementChild}:function(a){var b=a.firstChild;do{if(1===b.nodeType)return b;b=b.nextSibling}while(b);return null},m.prototype.appendTo=function(a){if(!a)throw new Error("appendTo requires a DOMElement to append to.");return this.forEach(function(b){a.appendChild(b)})},m.prototype.append=function(){var a=this.first;return a?(k.forEach(i.call(arguments),function(b){a.appendChild(b)}),this):this},m.prototype.prepend=function(){if(0===arguments.length)return this;var a,b=this.first;return b?(a=i.call(arguments),L(b)||b.appendChild(a.shift()),k.forEach(a,function(a){b.insertBefore(a,L(b))}),this):this},m.prototype.after=function(a){if(!a)throw new Error("after requires a DOMElement to insert after");return this.forEach(function(b){b.parentElement&&(a!==b.parentNode.lastChild?b.parentElement.insertBefore(b,a):b.parentElement.appendChild(b))})},m.prototype.before=function(a){if(!a)throw new Error("before requires a DOMElement to insert before");return this.forEach(function(b){b.parentElement&&b.parentElement.insertBefore(b,a)})},m.prototype.remove=function(){return this.forEach(function(a){a.parentNode&&a.parentNode.removeChild(a)})},m.prototype.empty=function(){return this.forEach(function(a){for(;a.firstChild;)a.removeChild(a.firstChild)})},m.prototype.isDisplayNone=function(){return this.some(function(a){return 0!==a.offsetWidth&&0!==a.offsetHeight||"none"!==k(a).css("display")?a.parentNode&&a.parentNode.style?k(a.parentNode).isDisplayNone():void 0:!0})},m.prototype.findElementWithDisplayNone=function(a){return k.findElementWithDisplayNone(a)},b.isElementNode=function(a){return a&&"object"==typeof a&&1===a.nodeType},b.removeElement=function(a){k(a).remove()},b.removeElementById=function(a){return k("#"+a).remove()},b.removeElementsByType=function(a,b){return k(b,a).remove()},b.emptyElement=function(a){return k(a).empty()},b.isDisplayNone=function(a){return k(a).isDisplayNone()},b.findElementWithDisplayNone=function(a){return 0!==a.offsetWidth&&0!==a.offsetHeight||"none"!==k.css(a,"display")?a.parentNode&&a.parentNode.style?k.findElementWithDisplayNone(a.parentNode):null:a},b.Modal=function(a){b.eventing(this,!0);var c=arguments[arguments.length-1];if(!b.isFunction(c))throw new Error("OTHelpers.Modal2 must be given a callback");arguments.length<2&&(a={});var d=document.createElement("iframe");d.id=a.id||b.uuid(),d.style.position="absolute",d.style.position="fixed",d.style.height="100%",d.style.width="100%",d.style.top="0px",d.style.left="0px",d.style.right="0px",d.style.bottom="0px",d.style.zIndex=1e3,d.style.border="0";try{d.style.backgroundColor="rgba(0,0,0,0.2)"}catch(e){d.style.backgroundColor="transparent",d.setAttribute("allowTransparency","true")}d.scrolling="no",d.setAttribute("scrolling","no");var f='<!DOCTYPE html><html><head><meta http-equiv="x-ua-compatible" content="IE=Edge"><meta http-equiv="Content-type" content="text/html; charset=utf-8"><title></title></head><body></body></html>',g=function(){var a=d.contentDocument||d.contentWindow.document;b.env.iframeNeedsLoad&&(a.body.style.backgroundColor="transparent",
a.body.style.border="none","IE"!==b.env.name&&(a.open(),a.write(f),a.close())),c(d.contentWindow,a)};document.body.appendChild(d),b.env.iframeNeedsLoad?("IE"===b.env.name&&(d.contentWindow.contents=f,d.src='javascript:window["contents"]'),b.on(d,"load",g)):setTimeout(g,0),this.close=function(){return b.removeElement(d),this.trigger("closed"),this.element=d=null,this},this.element=d},function(){function a(b,c,d,e){var f,g=c[d],h=parseFloat(g),i=g.split(/\d/)[0];return e=null!=e?e:/%|em/.test(i)&&b.parentElement?a(b.parentElement,b.parentElement.currentStyle,"fontSize",null):16,f="fontSize"===d?e:/width/i.test(d)?b.clientWidth:b.clientHeight,"em"===i?h*e:"in"===i?96*h:"pt"===i?96*h/72:"%"===i?h/100*f:h}function c(a,b){var c="border"===b?"Width":"",d=b+"Top"+c,e=b+"Right"+c,f=b+"Bottom"+c,g=b+"Left"+c;a[b]=(a[d]===a[e]===a[f]===a[g]?[a[d]]:a[d]===a[f]&&a[g]===a[e]?[a[d],a[e]]:a[g]===a[e]?[a[d],a[e],a[f]]:[a[d],a[e],a[f],a[g]]).join(" ")}function d(b){var d,e=b.currentStyle,f=this,g=a(b,e,"fontSize",null);for(d in e)/width|height|margin.|padding.|border.+W/.test(d)&&"auto"!==f[d]?f[d]=a(b,e,d,g)+"px":"styleFloat"===d?f["float"]=e[d]:f[d]=e[d];return c(f,"margin"),c(f,"padding"),c(f,"border"),f.fontSize=g+"px",f}function e(a){return new d(a)}d.prototype={constructor:d,getPropertyPriority:function(){},getPropertyValue:function(a){return this[a]||""},item:function(){},removeProperty:function(){},setProperty:function(){},getPropertyCSSValue:function(){}},b.getComputedStyle=function(a){return a&&a.ownerDocument&&a.ownerDocument.defaultView&&a.ownerDocument.defaultView.getComputedStyle?a.ownerDocument.defaultView.getComputedStyle(a):e(a)}}();var M=function(a,b,c){var d={},e=function(b){switch(b){case"width":return k(a).width();case"height":return k(a).height();default:return k(a).css(b)}};k.forEach(b,function(a){d[a]=e(a)});var f=new MutationObserver(function(f){var g={};k.forEach(f,function(c){if("style"===c.attributeName){var f=k.isDisplayNone(a);k.forEach(b,function(a){if(!f||"width"!==a&&"height"!==a){var b=e(a);b!==d[a]&&(g[a]=[d[a],b],d[a]=b)}})}}),k.isEmpty(g)||k.callAsync(function(){c.call(null,g)})});return f.observe(a,{attributes:!0,attributeFilter:["style"],childList:!1,characterData:!1,subtree:!1}),f},N=function(a,b){var c=new MutationObserver(function(a){var c=[];k.forEach(a,function(a){a.removedNodes.length&&(c=c.concat(i.call(a.removedNodes)))}),c.length&&k.callAsync(function(){b(k(c))})});return c.observe(a,{attributes:!1,childList:!0,characterData:!1,subtree:!0}),c},O=function(a,b){var c={width:0,height:0},d=setInterval(function(){var d=a.getBoundingClientRect();(c.width!==d.width||c.height!==d.height)&&(b(d,c),c={width:d.width,height:d.height})},200);return{disconnect:function(){clearInterval(d)}}};m.prototype.observeStyleChanges=function(a,b){var c=[];return this.forEach(function(d){c.push(M(d,a,b))}),c},m.prototype.observeNodeOrChildNodeRemoval=function(a){var b=[];return this.forEach(function(c){b.push(N(c,a))}),b},m.prototype.observeSize=function(a){var b=[];return this.forEach(function(c){b.push(O(c,a))}),b},b.observeStyleChanges=function(a,b,c){return k(a).observeStyleChanges(b,c)[0]},b.observeNodeOrChildNodeRemoval=function(a,b){return k(a).observeNodeOrChildNodeRemoval(b)[0]},b.registerCapability("classList",function(){return"undefined"!=typeof document&&"classList"in document.createElement("a")}),m.prototype.addClass=function(a){if(a){var b=k.trim(a).split(/\s+/);this.forEach(function(a){g(a,b)})}return this},m.prototype.removeClass=function(a){if(a){var b=k.trim(a).split(/\s+/);this.forEach(function(a){h(a,b)})}return this},m.prototype.toggleClass=function(a){if(a){var b=k.trim(a).split(/\s+/);this.forEach(function(a){f(a,b)})}return this},m.prototype.hasClass=function(a){return this.some(function(b){return e(b,a)})},b.addClass=function(a,b){return k(a).addClass(b)},b.removeClass=function(a,b){return k(a).removeClass(b)};var P={"for":"htmlFor","class":"className"};m.prototype.attr=function(a,c){if(b.isObject(a)){var d;for(var e in a)d=P[e]||e,this.first.setAttribute(d,a[e])}else{if(void 0===c)return this.first.getAttribute(P[a]||a);this.first.setAttribute(P[a]||a,c)}return this},m.prototype.removeAttr=function(a){var b=P[a]||a;return this.forEach(function(a){a.removeAttribute(b)}),this},m.prototype.html=function(a){return void 0!==a&&(this.first.innerHTML=a),this.first.innerHTML},m.prototype.center=function(a,b){var c;return this.forEach(function(d){c=k(d),a||(a=parseInt(c.width(),10)),b||(b=parseInt(c.height(),10));var e=-.5*a+"px",f=-.5*b+"px";c.css("margin",f+" 0 0 "+e).addClass("OT_centered")}),this},b.centerElement=function(a,b,c){return k(a).center(b,c)},function(){var a=function(a){return a.offsetWidth>0?a.offsetWidth+"px":k(a).css("width")},c=function(a){return a.offsetHeight>0?a.offsetHeight+"px":k(a).css("height")};m.prototype.width=function(b){return b?(this.css("width",b),this):this.isDisplayNone()?this.makeVisibleAndYield(function(b){return a(b)})[0]:a(this.get(0))},m.prototype.height=function(a){return a?(this.css("height",a),this):this.isDisplayNone()?this.makeVisibleAndYield(function(a){return c(a)})[0]:c(this.get(0))},b.width=function(a,c){var d=k(a).width(c);return c?b:d},b.height=function(a,c){var d=k(a).height(c);return c?b:d}}(),function(){var a={},d={},e=function(a){if(d[a.ownerDocument]&&d[a.ownerDocument][a.nodeName])return d[a.ownerDocument][a.nodeName];d[a.ownerDocument]||(d[a.ownerDocument]={});var b,c=a.ownerDocument.createElement(a.nodeName);return a.ownerDocument.body.appendChild(c),b=d[a.ownerDocument][a.nodeName]=k(c).css("display"),k(c).remove(),c=null,b},f=function(a){var b=k.getComputedStyle(a);return"none"===b.getPropertyValue("display")},g=function(a,b){var c=a.style;for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d])},h=function(a,b,c){a.style[b]=c},i=function(a,b){var c=b.replace(/([A-Z]|^ms)/g,"-$1").toLowerCase(),d=k.getComputedStyle(a),e=d.getPropertyValue(c);return""===e&&(e=a.style[c]),e},j=function(a,b,c){var d,e,f={};for(d in b)b.hasOwnProperty(d)&&(f[d]=a.style[d],k(a).css(d,b[d]));e=c(a);for(d in b)b.hasOwnProperty(d)&&k(a).css(d,f[d]||"");return e};m.prototype.show=function(){return this.forEach(function(b){var c=b.style.display;(""===c||"none"===c)&&(b.style.display=a[b]||"",delete a[b]),f(b)&&(a[b]="none",b.style.display=e(b))})},m.prototype.hide=function(){return this.forEach(function(b){"none"!==b.style.display&&(a[b]=b.style.display,b.style.display="none")})},m.prototype.css=function(a,b){return 0!==this.length?"string"!=typeof a?this.forEach(function(b){g(b,a)}):b!==c?this.forEach(function(c){h(c,a,b)}):i(this.first,a,b):void 0},m.prototype.applyCSS=function(a,b){var c=[];return this.forEach(function(d){c.push(j(d,a,b))}),c},m.prototype.makeVisibleAndYield=function(a){var b={display:"block",visibility:"hidden"},c=[];return this.forEach(function(d){var e=k.findElementWithDisplayNone(d);e?c.push(j(e,b,a)):c.push(void 0)}),c},b.show=function(a){return k(a).show()},b.hide=function(a){return k(a).hide()},b.css=function(a,b,c){return k(a).css(b,c)},b.applyCSS=function(a,b,c){return k(a).applyCSS(b,c)},b.makeVisibleAndYield=function(a,b){return k(a).makeVisibleAndYield(b)}}(),function(){b.setImmediate=function(){return"undefined"!=typeof process&&process.nextTick?"undefined"!=typeof setImmediate?setImmediate:process.nextTick:"function"==typeof setImmediate?function(a){setImmediate(a)}:function(a){setTimeout(a,0)}}(),b.iterator=function(a){var b=function(c){var d=function(){return a.length&&a[c].apply(null,arguments),d.next()};return d.next=function(){return c<a.length-1?b(c+1):null},d};return b(0)},b.waterfall=function(a,c){if(c=c||function(){},a.constructor!==Array)return c(new Error("First argument to waterfall must be an array of functions"));if(!a.length)return c();var d=function(a){return function(e){if(e)c.apply(null,arguments),c=function(){};else{var f=i.call(arguments,1),g=a.next();g?f.push(d(g)):f.push(c),b.setImmediate(function(){a.apply(null,f)})}}};d(b.iterator(a))()}}(),function(){var c=a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.msRequestAnimationFrame;if(c)c=b.bind(c,a);else{var d=0,e=b.now();c=function(c){var f=b.now(),g=Math.max(0,16-(f-d)),h=a.setTimeout(function(){c(f-e)},g);return d=f+g,h}}b.requestAnimationFrame=c}(),function(){var a=[],d=!1;b.Analytics=function(e,f){var g=e+"/logging/ClientEvent",h=e+"/logging/ClientQos",i={},j=function(a,c,d){b.post((c?h:g)+"?_="+b.uuid.v4(),{body:a,xdomainrequest:"IE"===k.env.name&&k.env.version<10,overrideMimeType:"text/plain",headers:{Accept:"text/plain","Content-Type":"application/json"}},d)},l=function(){if(!d&&a.length>0){d=!0;var b=a[0],c=function(){a.shift(),d=!1,l()};b&&j(b.data,b.isQos,function(a){if(a){var d="Failed to send ClientEvent, moving on to the next item.";f?f(d):console.log(d),b.onComplete&&b.onComplete(a)}b.onComplete&&b.onComplete(a),setTimeout(c,50)})}},m=function(b,c,d){a.push({data:b,onComplete:c,isQos:d}),l()},n=function(a,b,d){if(!d)return!1;var e=[d,b,a].join("_"),f=100;return null===f||f===c?!1:(i[e]||0)<=f};this.logError=function(a,c,d,e,f){f||(f={});var g=f.partnerId;if(!n(a,c,g)){var h=[g,c,a].join("_"),j=e?e:null;i[h]="undefined"!=typeof i[h]?i[h]+1:1,this.logEvent(b.extend(f,{action:c+"."+a,payload:j}),!1)}},this.logEvent=function(a,b,c,d){if(b||(b=!1),!(c&&!isNaN(c)&&Math.random()>c)){for(var e in a)a.hasOwnProperty(e)&&null===a[e]&&delete a[e];a=JSON.stringify(a),m(a,d,b)}},this.logQOS=function(a){this.logEvent(a,!0)}}}(),b.get=function(a,c,d){var e=b.extend(c||{},{method:"GET"});b.request(a,e,d)},b.post=function(a,c,d){var e=b.extend(c||{},{method:"POST"});e.xdomainrequest?b.xdomainRequest(a,e,d):b.request(a,e,d)}}(a,a.OTHelpers),/**
 * @license  TB Plugin 0.4.0.12 6e40a4e v0.4.0.12-branch
 * http://www.tokbox.com/
 *
 * Copyright (c) 2015 TokBox, Inc.
 *
 * Date: October 30 12:16:21 2015
 *
 */
function(b){if(void 0===b.OTPlugin){var c=OTHelpers;a.EmpiricDelay=3e3;var d="IE"===c.env.name&&c.env.version>=8&&-1===c.env.userAgent.indexOf("x64"),e=!1,f={isSupported:function(){return d},isReady:function(){return e},meta:{mimeType:"application/x-opentokplugin,version=0.4.0.12",activeXName:"TokBox.OpenTokPlugin.0.4.0.12",version:"0.4.0.12"},useLoggingFrom:function(a){f.log=c.bind(a.log,a),f.debug=c.bind(a.debug,a),f.info=c.bind(a.info,a),f.warn=c.bind(a.warn,a),f.error=c.bind(a.error,a)}};if(c.useLogHelpers(f),b.OTPlugin=f,c.registerCapability("otplugin",function(){return f.isInstalled()}),!f.isSupported())return void(f.isInstalled=function(){return!1});var g=function(){Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c,d,e=b?b:0;if(!this)throw new TypeError;if(d=this.length,0===d||e>=d)return-1;for(0>e&&(e=d-Math.abs(e)),c=e;d>c;c++)if(this[c]===a)return c;return-1}),Array.prototype.map||(Array.prototype.map=function(a){"use strict";if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=new Array(c),e=arguments.length>=2?arguments[1]:void 0,f=0;c>f;f++)f in b&&(d[f]=a.call(e,b[f],f,b));return d})},h=function(){var a=function(){},b=new a,d=[];return b.add=function(a,b){b?d.push(c.bind(a,b)):d.push(a)},b.runAll=function(){for(var a;a=d.shift();)a()},b},i=function(a,b){var d,e,g,h=function(){},i=new h,j=!1;try{d=a._.RumorInit(b,"")}catch(k){f.error("Error creating the Rumor Socket: ",k.message)}if(!d)throw new Error("Could not initialise OTPlugin rumor connection");return i.open=function(){j=!0,a._.RumorOpen(d)},i.close=function(b,c){j&&(j=!1,a._.RumorClose(d,b,c)),a.removeRef(i)},i.destroy=function(){this.close()},i.send=function(b){a._.RumorSend(d,b.type,b.toAddress,JSON.parse(JSON.stringify(b.headers)),b.data)},i.onOpen=function(a){e=a},i.onClose=function(a){g=a},i.onError=function(b){a._.SetOnRumorError(d,n(b))},i.onMessage=function(b){a._.SetOnRumorMessage(d,n(b))},a.addRef(i),a._.SetOnRumorOpen(d,n(function(){e&&c.isFunction(e)&&e.call(null)})),a._.SetOnRumorClose(d,n(function(b){g(b),a.removeRef(i)})),i},j=function(a){var b=[];a.addRef=function(c){return b.push(c),a},a.removeRef=function(c){if(0!==b.length){var d=b.indexOf(c);return-1!==d&&b.splice(d,1),0===b.length&&a.destroy(),a}},a.removeAllRefs=function(){for(;b.length;)b.shift().destroy()}},k=function(b){var d={},e=new h,g=!1,i=function(){var a=Array.prototype.slice.call(arguments);b.emit(a.shift(),a)},j=function(){var a=Array.prototype.slice.call(arguments);f.debug(a),b.emit("devicesChanged",a)};b.on=function(a,c,e){return d.hasOwnProperty(a)||(d[a]=[]),d[a].push([c,e]),b},b.off=function(a,e,f){return d.hasOwnProperty(a)&&0!==d[a].length?(c.filter(d[a],function(a){return a[0]===e&&a[1]===f}),b):void 0},b.once=function(a,c,d){var e=function(){return b.off(a,e),c.apply(d,arguments)};return b.on(a,e),b},b.emit=function(a,e){return c.callAsync(function(){(d.hasOwnProperty(a)||!d[a].length)&&c.forEach(d[a],function(a){a[0].apply(a[1],e)})}),b},b.listenForDeviceChanges=function(){return g?void setTimeout(function(){b._.registerXCallback("devicesChanged",j)},a.EmpiricDelay):void e.add(b.listenForDeviceChanges,b)};var k=function(a){b._.on&&b._.on(-1,{customEvent:n(i)});var c=function(){g=!0,e.runAll(),a.call(b)};b._.initialise?(b.on("ready",n(c)),b._.initialise()):c.call(b)};return function(a){k(function(c){return c?(f.error("Error while starting up plugin "+b.uuid+": "+c),void a(c)):(f.debug("Plugin "+b.id+" is loaded"),void a(void 0,b))})}},l=5e3,m={},n=function(a){return function(){var b=Array.prototype.slice.call(arguments);b.unshift(a),c.callAsync.apply(c,b)}},o=function(a){if(a&&(m[a]&&(clearTimeout(m[a]),m[a]=null),b[a]))try{delete b[a]}catch(c){b[a]=void 0}},p=function(a,c){m[a]=setTimeout(function(){o(a),c("The object timed out while loading.")},l),b[a]=function(){o(a);var b=Array.prototype.slice.call(arguments);b.unshift(null),c.apply(null,b)}},q=function(){return"OTPlugin_loaded_"+c.uuid().replace(/\-+/g,"")},r=function(a,b){b=b||{};var d=[],e=['type="'+b.mimeType+'"','id="'+a+'_obj"','tb_callback_id="'+a+'"','width="0" height="0"'],f={userAgent:c.env.userAgent.toLowerCase(),windowless:b.windowless,onload:a};b.isVisible!==!0&&e.push('visibility="hidden"'),d.push("<object "+e.join(" ")+">");for(var g in f)f.hasOwnProperty(g)&&d.push('<param name="'+g+'" value="'+f[g]+'" />');return d.push("</object>"),d.join("")},s=function(a,c,d){c=c||{};var e=r(a,c),f=c.doc||b.document;f.body.insertAdjacentHTML("beforeend",e);var g=f.body.querySelector("#"+a+"_obj");d(void 0,g)},t=function(a,b){var d=function(){},e=new d,f=k(e);j(e);var g=function(a){a?(e._=a,e.parentElement=a.parentElement,e.$=c(a)):(e._=null,e.parentElement=null,e.$=c())};return e.uuid=q(),e.isValid=function(){return e._.valid},e.destroy=function(){e.removeAllRefs(),g(null),e.emit("destroy")},e.enumerateDevices=function(a){e._.enumerateDevices(a)},g(null),p(e.uuid,function(c){return c?(b("The plugin with the mimeType of "+a.mimeType+" timed out while loading: "+c),void e.destroy()):(e._.setAttribute("id","tb_plugin_"+e._.uuid),e._.removeAttribute("tb_callback_id"),e.uuid=e._.uuid,e.id=e._.id,void f(function(a){return a?(b("Error while starting up plugin "+e.uuid+": "+a),void e.destroy()):void b(void 0,e)}))}),s(e.uuid,a,function(a,b){g(b)}),e},u=function(a){return a.selectSources=function(){return a._.selectSources.apply(a._,arguments)},a.listenForDeviceChanges(),a},v=function(a){return a.setStream=function(b,d){if(a._.setStream(b),d)if(b.hasVideo()){var e=function(){return a._?void(a._.videoWidth>0?setTimeout(d,200):setTimeout(e,500)):void d(new c.Error("The plugin went away before the stream could be bound."))};setTimeout(e,500)}else setTimeout(d,200);return a},a},w=function(a,b){var d=function(){},e=new d;return e.domElement=a._,e.$=c(a._),e.parentElement=a._.parentNode,a.addRef(e),e.appendTo=function(b){b&&a._.parentNode!==b&&(f.debug("VideoContainer appendTo",b),b.appendChild(a._),e.parentElement=b)},e.show=function(d){return f.debug("VideoContainer show"),a._.removeAttribute("width"),a._.removeAttribute("height"),a.setStream(b,d),c.show(a._),e},e.setSize=function(b,c){return a._.setAttribute("width",b),a._.setAttribute("height",c),e},e.width=function(b){return void 0!==b&&(f.debug("VideoContainer set width to "+b),a._.setAttribute("width",b)),a._.getAttribute("width")},e.height=function(b){return void 0!==b&&(f.debug("VideoContainer set height to "+b),a._.setAttribute("height",b)),a._.getAttribute("height")},e.volume=function(a){return void 0!==a?f.debug("VideoContainer setVolume not implemented: called with "+a):f.debug("VideoContainer getVolume not implemented"),.5},e.getImgData=function(){return a._.getImgData("image/png")},e.videoWidth=function(){return a._.videoWidth},e.videoHeight=function(){return a._.videoHeight},e.destroy=function(){a._.setStream(null),a.removeRef(e)},e},x=function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])};x.prototype.forEach=function(a,b){for(var c in this)this.hasOwnProperty(c)&&a.call(b,this[c])};var y=function(){var a=function(){},b=new a,d={},e=function(a){b.mediaCapturer&&b.mediaCapturer.id===a.id?b.mediaCapturer=null:d.hasOwnProperty(a.id)&&delete d[a.id],a.$&&a.$.remove()};return b.mediaCapturer=null,b.removeAll=function(){for(var a in d)d.hasOwnProperty(a)&&d[a].destroy();b.mediaCapturer&&b.mediaCapturer.destroy()},b.create=function(a,b){var c=t(a,b);return d[c.uuid]=c,c.on("destroy",function(){e(c)}),c},b.createMediaPeer=function(a,e){c.isFunction(a)&&(e=a,a={});var g=b.create(c.extend(a||{},{mimeType:f.meta.mimeType,isVisible:!0,windowless:!0}),function(a){return a?void e.call(f,a):(d[g.id]=g,void e.call(f,void 0,g))});v(g)},b.createMediaCapturer=function(a){return b.mediaCapturer?(a.call(f,void 0,b.mediaCapturer),b):(b.mediaCapturer=b.create({mimeType:f.meta.mimeType,isVisible:!1,windowless:!1},function(c){a.call(f,c,b.mediaCapturer)}),void u(b.mediaCapturer))},b}(),z=function(b,d,e,g){var h,i=function(){},j=new i,k=c.uuid(),l=!1,m=!1,o=[],p=!1,q=[];e.addRef(j),h={addstream:[],removestream:[],icecandidate:[],signalingstatechange:[],iceconnectionstatechange:[]};var r=function(){},s=function(a){f.error("Failed to process candidate"),f.error(a)},t=function(){for(var a=0;a<o.length;++a)e._.addIceCandidate(k,o[a],r,s)},u=function(a){return function(){return p===!0?a.apply(j,arguments):void q.push([a,arguments])}},v=function(){for(var a;a=q.shift();)a[0].apply(j,a[1])},w=function(){var a=Array.prototype.slice.call(arguments),b=a.shift();return h.hasOwnProperty(b)?void c.forEach(h[b],function(b){b.apply(null,a)}):void f.error("PeerConnection does not have an event called: "+b)},y=function(a){for(var b in a)a.hasOwnProperty(b)&&(a[b]=n(a[b]));e._.on(k,a)},z=function(b){setTimeout(function(){var a=B.fromJson(b,e),d={stream:a,target:j};j.onaddstream&&c.isFunction(j.onaddstream)&&c.callAsync(j.onaddstream,d),w("addstream",d)},a.EmpiricDelay)},A=function(a){var b=B.fromJson(a,e),d={stream:b,target:j};j.onremovestream&&c.isFunction(j.onremovestream)&&c.callAsync(j.onremovestream,d),w("removestream",d)},C=function(a,b,d){var e=new f.RTCIceCandidate({candidate:a,sdpMid:b,sdpMLineIndex:d}),g={candidate:e,target:j};j.onicecandidate&&c.isFunction(j.onicecandidate)&&c.callAsync(j.onicecandidate,g),w("icecandidate",g)},D=function(a){j.signalingState=a;var b={state:a,target:j};j.onsignalingstatechange&&c.isFunction(j.onsignalingstatechange)&&c.callAsync(j.onsignalingstatechange,b),w("signalingstate",b)},E=function(a){j.iceConnectionState=a;var b={state:a,target:j};j.oniceconnectionstatechange&&c.isFunction(j.oniceconnectionstatechange)&&c.callAsync(j.oniceconnectionstatechange,b),w("iceconnectionstatechange",b)};return j.createOffer=u(function(a,b,c){f.debug("createOffer",c),e._.createOffer(k,function(b,c){a(new f.RTCSessionDescription({type:b,sdp:c}))},b,c||{})}),j.createAnswer=u(function(a,b,c){f.debug("createAnswer",c),e._.createAnswer(k,function(b,c){a(new f.RTCSessionDescription({type:b,sdp:c}))},b,c||{})}),j.setLocalDescription=u(function(a,b,c){f.debug("setLocalDescription"),e._.setLocalDescription(k,a,function(){l=!0,m&&t(),b&&b.call(null)},c)}),j.setRemoteDescription=u(function(a,b,c){f.debug("setRemoteDescription"),e._.setRemoteDescription(k,a,function(){m=!0,l&&t(),b&&b.call(null)},c)}),j.addIceCandidate=u(function(a){f.debug("addIceCandidate"),l&&m?e._.addIceCandidate(k,a,r,s):o.push(a)}),j.addStream=u(function(a){var b={};e._.addStream(k,a,b)}),j.removeStream=u(function(a){e._.removeStream(k,a)}),j.getRemoteStreams=function(){return c.map(e._.getRemoteStreams(k),function(a){return B.fromJson(a,e)})},j.getLocalStreams=function(){return c.map(e._.getLocalStreams(k),function(a){return B.fromJson(a,e)})},j.getStreamById=function(a){return B.fromJson(e._.getStreamById(k,a),e)},j.getStats=u(function(a,b,c){e._.getStats(k,a||null,n(function(a){var c=new x(JSON.parse(a));b(c)}),c)}),j.close=function(){e._.destroyPeerConnection(k),e.removeRef(this)},j.destroy=function(){j.close()},j.addEventListener=function(a,b){void 0!==h[a]&&h[a].push(b)},j.removeEventListener=function(a,b){void 0!==h[a]&&(h[a]=c.filter(h[a],b))},j.onaddstream=null,j.onremovestream=null,j.onicecandidate=null,j.onsignalingstatechange=null,j.oniceconnectionstatechange=null,c.forEach(b.iceServers,function(a){a.username||(a.username=""),a.credential||(a.credential="")}),e._.initPeerConnection(k,b,d)?(y({addStream:z,removeStream:A,iceCandidate:C,signalingStateChange:D,iceConnectionChange:E}),p=!0,v(),g(void 0,j),j):void g(new c.error("Failed to initialise PeerConnection"))};z.create=function(a,b,c,d){new z(a,b,c,d)};var A=function(a,b,d){var e=function(){},f=new e;return f.id=b.id,f.kind=b.kind,f.label=b.label,f.enabled=c.castToBoolean(b.enabled),f.streamId=a,f.setEnabled=function(b){f.enabled=c.castToBoolean(b),f.enabled?d._.enableMediaStreamTrack(a,f.id):d._.disableMediaStreamTrack(a,f.id)},f},B=function(a,b){var d=function(){},e=new d,f=[],g=[];e.id=a.id,b.addRef(e),a.videoTracks&&a.videoTracks.map(function(c){g.push(new A(a.id,c,b))}),a.audioTracks&&a.audioTracks.map(function(c){f.push(new A(a.id,c,b))});var h=function(a){var b="video"===a?g:f;return c.some(b,function(a){return a.enabled})};return e.getVideoTracks=function(){return g},e.getAudioTracks=function(){return f},e.getTrackById=function(a){return g.concat(f).forEach(function(b){return b.id===a?b:void 0}),null},e.hasVideo=function(){return h("video")},e.hasAudio=function(){return h("audio")},e.addTrack=function(){},e.removeTrack=function(){},e.stop=function(){b._.stopMediaStream(e.id),b.removeRef(e)},e.destroy=function(){e.stop()},e._={plugin:b,render:function(){return new w(b,e)}},e};B.fromJson=function(a,b){return a?new B(JSON.parse(a),b):null};var C,D=function(a){var b=c.clone(a);this.hasVideo=void 0!==b.video&&b.video!==!1,this.hasAudio=void 0!==b.audio&&b.audio!==!1,b.video===!0&&(b.video={}),b.audio===!0&&(b.audio={}),this.hasVideo&&!b.video.mandatory&&(b.video.mandatory={}),this.hasAudio&&!b.audio.mandatory&&(b.audio.mandatory={}),this.screenSharing=this.hasVideo&&("screen"===b.video.mandatory.chromeMediaSource||"window"===b.video.mandatory.chromeMediaSource),this.audio=b.audio,this.video=b.video,this.setVideoSource=function(a){void 0!==a?b.video.mandatory.sourceId=a:delete b.video},this.setAudioSource=function(a){void 0!==a?b.audio.mandatory.sourceId=a:delete b.audio},this.toHash=function(){return b}};!function(){var b,d,e=-1,g=function(a,b){if(a===b)return!1;if(-1===a)return b;if(-1===b)return a;if(-1===a.indexOf(".")&&-1===b.indexOf("."))return a>b;for(var c=a.split("."),d=b.split("."),e=(c.length>d.length?d:c).length,f=0;e>f;++f)if(parseInt(c[f],10)>parseInt(d[f],10))return!0;return f<c.length?!0:!1},h=function(){if(void 0!==d)return d;var a="TokBox.OpenTokPluginInstaller",b="OpenTokPluginInstaller",f="application/x-opentokplugininstaller",h=navigator.plugins[a]||navigator.plugins[b];if(e=-1,h)for(var i,j,k=h.length,l=new RegExp(f.replace("-","\\-")+",version=([0-9a-zA-Z-_.]+)","i"),m=0;k>m;++m)i=h[m],i&&i.enabledPlugin&&i.enabledPlugin.name===h.name&&-1!==i.type.indexOf(f)&&(j=l.exec(i.type),null!==j&&g(j[1],e)&&(e=j[1]));else if("IE"===c.env.name)try{h=new ActiveXObject(a),e=h.getMasterVersion()}catch(n){}d=-1!==e?f+",version="+e:null},i=function(){return void 0===d&&h(),d},j=function(){return void 0===e&&h(),e},k=function(){var a="0.4.0.9"===j()||!g(j(),"0.4.0.4");return k=function(){return a},a};C=function(){var b,d=function(a){return function(){return b?a(void 0,arguments):void y.create({mimeType:i(),isVisible:!1,windowless:!1},function(c,d){return b=d,c?void f.error("Error while loading the AutoUpdater: "+c):a.apply(void 0,arguments)})}};this.isOutOfDate=function(){return g(f.meta.version,j())},this.autoUpdate=d(function(){var d=OT.Dialogs.Plugin.updateInProgress(),e=new OT.Analytics,g={ieVersion:c.env.version,pluginOldVersion:f.installedVersion(),pluginNewVersion:f.version()},h=n(function(){e.logEvent({action:"OTPluginAutoUpdate",variation:"Success",partnerId:OT.APIKEY,payload:JSON.stringify(g)}),b.destroy(),d.close(),OT.Dialogs.Plugin.updateComplete().on({reload:function(){a.location.reload()}})}),i=n(function(a,c,h){g.errorCode=a,g.systemErrorCode=h,e.logEvent({action:"OTPluginAutoUpdate",variation:"Failure",partnerId:OT.APIKEY,payload:JSON.stringify(g)}),b.destroy(),d.close();var i=c+" ("+a+"). Please restart your browser and try again.";d=OT.Dialogs.Plugin.updateComplete(i).on({reload:function(){d.close()}}),f.error("autoUpdate failed: "+c+" ("+a+"). Please restart your browser and try again.")}),j=n(function(a){d.setUpdateProgress(a.toFixed())});b._.updatePlugin(f.pathToInstaller(),h,i,j)}),this.destroy=function(){b&&b.destroy()},navigator.plugins&&navigator.plugins.refresh(!1)},C.get=function(a){if(!b){if(!this.isinstalled())return void a.call(null,"Plugin was not installed");b=new C}a.call(null,void 0,b)},C.isinstalled=function(){return null!==i()&&!k()},C.installedVersion=function(){return j()}}();var E,F=function(){var a=function(){},b=new a;return b.enumerateDevices=function(a){f.ready(function(b){b?a(b):y.mediaCapturer.enumerateDevices(a)})},b.addListener=function(a,b){f.ready(function(c){c||y.mediaCapturer.on("devicesChanged",a,b)})},b.removeListener=function(a,b){f.isReady()&&y.mediaCapturer.off("devicesChanged",a,b)},b},G=[],H=function(){y.removeAll()},I=function(a){return c.isFunction(a)?void(f.isReady()?a.call(f,E):G.push(a)):void f.warn("registerReadyListener was called with something that was not a function.")},J=function(){for(var a;(a=G.pop())&&c.isFunction(a);)a.call(f,E)},K=function(){C.get(function(a,b){return a?(E="Error while loading the AutoUpdater: "+a,void J()):b.isOutOfDate()?void b.autoUpdate():void y.createMediaCapturer(function(a){E=a,E||y.mediaCapturer&&y.mediaCapturer.isValid()||(E="The TB Plugin failed to load properly"),e=!0,J(),c.onDOMUnload(H)})})};f.isInstalled=function(){return this.isSupported()?C.isinstalled():!1},f.version=function(){return f.meta.version},f.installedVersion=function(){return C.installedVersion()},f.pathToInstaller=function(){return"https://s3.amazonaws.com/otplugin.tokbox.com/v"+f.meta.version+"/OpenTokPluginMain.msi"},f.ready=function(a){I(a)};var L=function(a,b,c){y.createMediaPeer(function(d,e){return d?void c.call(f,d):void e._.getUserMedia(a.toHash(),function(a){b.call(f,B.fromJson(a,e))},c)})};f.getUserMedia=function(a,b,c){var d=new D(a);if(d.screenSharing)L(d,b,c);else{var e=[];d.hasVideo&&e.push("video"),d.hasAudio&&e.push("audio"),y.mediaCapturer.selectSources(e,function(a){for(var e in a)a.hasOwnProperty(e)&&f.debug(e+" Capture Device: "+a[e]);d.setVideoSource(a.video),d.setAudioSource(a.audio),L(d,b,c)},c)}},f.enumerateDevices=function(a){f.ready(function(b){b?a(b):y.mediaCapturer.enumerateDevices(a)})},f.initRumorSocket=function(a,b){f.ready(function(c){c?b(c):b(null,new i(y.mediaCapturer,a))})},f.initPeerConnection=function(a,b,c,d){var e=function(c,e){return c?void d.call(f,c):(f.debug("Got PeerConnection for "+e.id),void z.create(a,b,e,function(a,b){return a?void d.call(f,a):void d.call(f,null,b)}))};c&&c._.plugin?e(null,c._.plugin):y.createMediaPeer(e)},f.RTCSessionDescription=function(a){this.type=a.type,this.sdp=a.sdp},f.RTCIceCandidate=function(a){this.sdpMid=a.sdpMid,this.sdpMLineIndex=parseInt(a.sdpMLineIndex,10),this.candidate=a.candidate},f.mediaDevices=new F,g(),c.onDOMLoad(K)}}(this);var b=function(b,c){"Firefox"===OT.$.env.name&&a.mozRTCPeerConnection&&a.mozRTCPeerConnection.generateCertificate?a.mozRTCPeerConnection.generateCertificate({name:"RSASSA-PKCS1-v1_5",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])})["catch"](function(a){c(a)}).then(function(a){b.certificates=[a],c(void 0,b)}):OT.$.callAsync(function(){c(void 0,b)})},c=function(b,c){function d(){h||((f!==c.videoWidth||g!==c.videoHeight)&&(b.trigger("videoDimensionsChanged",{width:f,height:g},{width:c.videoWidth,height:c.videoHeight}),f=c.videoWidth,g=c.videoHeight),e())}function e(){b.whenTimeIncrements(function(){a.requestAnimationFrame(d)})}var f=c.videoWidth,g=c.videoHeight,h=!0;b.startObservingSize=function(){h=!1,e()},b.stopObservingSize=function(){h=!0}};!function(a,d){function e(a){for(var b=new ArrayBuffer(a.length),c=new Uint8Array(b),d=0;d<a.length;++d)c[d]=a[d];return b}function f(a){function b(a){var b=new XMLHttpRequest,c=new d.$.RSVP.Promise(function(c,d){function e(a){return 8e3*a/(Date.now()-f)}var f=Date.now(),g=0;b.addEventListener("load",function(a){c(e(a.loaded))}),b.addEventListener("abort",function(){c(e(g))}),b.addEventListener("error",function(a){d(a)}),b.addEventListener("progress",function(a){g=a.loaded}),b.open("GET",a+"?_"+Math.random()),b.send()});return{promise:c,abort:function(){b.abort()}}}function c(a,b){var c=new XMLHttpRequest,e=new d.$.RSVP.Promise(function(d,e){var f,g,h;c.upload.addEventListener("progress",function(a){f||(f=Date.now()),h=a.loaded}),c.addEventListener("load",function(){g=Date.now(),d(8e3*h/(g-f))}),c.addEventListener("error",function(a){e(a)}),c.addEventListener("abort",function(){e()}),c.open("POST",a),c.send(b)});return{promise:e,abort:function(){c.abort()}}}function e(a,c){var d=b(a);return setTimeout(function(){d.abort()},c),d.promise}function f(a,b,e){return new d.$.RSVP.Promise(function(d){function f(b){g=c(a,new ArrayBuffer(b/8)),g.promise.then(function(a){h=a,f(2*b)})}var g,h=0;setTimeout(function(){g.abort(),d(h)},e),f(b)})}var g=a.httpConfig;return d.$.RSVP.Promise.all([e(g.downloadUrl,1e3*g.duration),f(g.uploadUrl,g.uploadSize,1e3*g.duration)]).then(function(a){return{downloadBandwidth:a[0],uploadBandwidth:a[1]}})}function g(a){return a.hasOwnProperty("googFrameWidthReceived")||a.hasOwnProperty("googFrameWidthInput")||"video"===a.mediaType}function h(a){return a.hasOwnProperty("audioInputLevel")||a.hasOwnProperty("audioOutputLevel")||"audio"===a.mediaType}function i(a){return a.hasOwnProperty("bytesReceived")}function j(a){var b={packetsLost:0,packetsReceived:0,bytesReceived:0};return a.hasOwnProperty("packetsReceived")&&(b.packetsReceived=parseInt(a.packetsReceived,10)),a.hasOwnProperty("packetsLost")&&(b.packetsLost=parseInt(a.packetsLost,10)),a.hasOwnProperty("bytesReceived")&&(b.bytesReceived+=parseInt(a.bytesReceived,10)),b}function k(a){return d.$.isObject(a)&&"getTime"in a?a.getTime():a}function l(){function a(a,b){a.getStats(function(a){var c=[];a.result().forEach(function(a){var b={};a.names().forEach(function(c){b[c]=a.stat(c)}),b.id=a.id,b.type=a.type,b.timestamp=a.timestamp,c.push(b)}),b(null,c)})}function b(a,b){a.getStats(null,function(a){var c=[];a.forEach(function(a){c.push(a)}),b(null,c)},b)}return"Firefox"===d.$.browserVersion().name||OTPlugin.isInstalled()?b:a}function m(b){function c(a){return-1!==a.candidate.indexOf("relay")}function e(){var a=new d.VideoElement({attributes:{muted:!0}});return a.domElement().style.position="absolute",a.domElement().style.top="-9999%",a.appendTo(document.body),a}function f(){return new d.$.RSVP.Promise(function(a,b){d.$.createPeerConnection({iceServers:t.iceServers},{},null,function(c,e){c?b(new d.$.Error("createPeerConnection failed",1600,c)):a(e)})})}function g(a){return new d.$.RSVP.Promise(function(b,c){a.createOffer(b,c)})}function h(a,b){return new d.$.RSVP.Promise(function(c,e){a.bindToStream(b,function(a){a?e(new d.$.Error("bindToStream failed",1600,a)):c()})})}function i(a,b){return new d.$.RSVP.Promise(function(c,d){a.addIceCandidate(new r({sdpMLineIndex:b.sdpMLineIndex,candidate:b.candidate}),c,d)})}function j(a,b){return new d.$.RSVP.Promise(function(c,e){a.setLocalDescription(b,c,function(a){e(new d.$.Error("setLocalDescription failed",1600,a))})})}function k(a,b){return new d.$.RSVP.Promise(function(c,e){a.setRemoteDescription(b,c,function(a){e(new d.$.Error("setRemoteDescription failed",1600,a))})})}function l(a){return new d.$.RSVP.Promise(function(b,c){a.createAnswer(b,function(a){c(new d.$.Error("createAnswer failed",1600,a))})})}function m(a){return new d.$.RSVP.Promise(function(b,c){s(a,function(a,e){a?c(new d.$.Error("geStats failed",1600,a)):b(e)})})}function n(a){return function(b){b.candidate&&c(b.candidate)&&i(a,b.candidate)["catch"](function(){d.warn("An error occurred while adding a ICE candidate during webrtc test")})}}function o(a){return 8*(a.videoBytesReceived+a.audioBytesReceived)/(d.$.now()-a.startTs)*1e3}function p(a,b){var c=1e3;return new d.$.RSVP.Promise(function(e){function f(){d.$.RSVP.Promise.all([m(a).then(function(a){d.$.forEach(a,function(a){if(d.getStatsHelpers.isVideoStat(a)){var b=null;a.hasOwnProperty("googRtt")?b=parseInt(a.googRtt,10):a.hasOwnProperty("mozRtt")&&(b=a.mozRtt),null!==b&&b>-1&&(i.roundTripTimeSamplesCount++,i.roundTripTime+=b)}})}),m(b).then(function(a){d.$.forEach(a,function(a){if(d.getStatsHelpers.isVideoStat(a)){if(a.hasOwnProperty("packetsReceived")&&a.hasOwnProperty("packetsLost")){var b=parseInt(a.packetsLost,10),c=parseInt(a.packetsReceived,10);b>=0&&c>0&&(i.packetLostRatioSamplesCount++,i.packetLostRatio+=100*b/c)}a.hasOwnProperty("bytesReceived")&&(i.videoBytesReceived=parseInt(a.bytesReceived,10))}else d.getStatsHelpers.isAudioStat(a)&&a.hasOwnProperty("bytesReceived")&&(i.audioBytesReceived=parseInt(a.bytesReceived,10))})})]).then(function(){setTimeout(function(){h&&f()},c)})}function g(a){h=!1;var b={packetLostRatio:i.packetLostRatioSamplesCount>0?i.packetLostRatio/=100*i.packetLostRatioSamplesCount:null,roundTripTime:i.roundTripTimeSamplesCount>0?i.roundTripTime/=i.roundTripTimeSamplesCount:null,bandwidth:o(i),extended:a};e(b)}var h=!0,i={startTs:d.$.now(),packetLostRatioSamplesCount:0,packetLostRatio:0,roundTripTimeSamplesCount:0,roundTripTime:0,videoBytesReceived:0,audioBytesReceived:0};f(),setTimeout(function(){o(i)<t.thresholdBitsPerSecond?setTimeout(function(){g(!0)},1e3*t.extendedDuration):g(!1)},1e3*t.duration)})}var q,r,s=d.getStatsAdpater(),t=b.mediaConfig,u=b.localStream;return OTPlugin.isInstalled()?(q=OTPlugin.RTCSessionDescription,r=OTPlugin.RTCIceCandidate):(q=a.mozRTCSessionDescription||a.RTCSessionDescription,r=a.mozRTCIceCandidate||a.RTCIceCandidate),d.$.RSVP.Promise.all([f(),f()]).then(function(a){function b(){i.destroy(),m.destroy(),c.close(),f.close()}var c=a[0],f=a[1],i=e(),m=e();h(i,u),c.addStream(u);var o;return f.onaddstream=function(a){o=a.stream,h(m,o)},c.onicecandidate=n(f),f.onicecandidate=n(c),g(c).then(function(a){return d.$.RSVP.Promise.all([j(c,a),k(f,a)])}).then(function(){return l(f)}).then(function(a){return d.$.RSVP.Promise.all([j(f,a),k(c,a)])}).then(function(){return p(c,f)}).then(function(a){return b(),a},function(a){throw b(),a})})}function n(a,b){this.code=a,this.message=b,this.reason=b}"file:"===location.protocol&&alert("You cannot test a page using WebRTC through the file system due to browser permissions. You must run it over a web server.");var d=a.OT||{};d.APIKEY=function(){var a=function(){var a=document.getElementsByTagName("script");return a=a[a.length-1],a=a.getAttribute("src")||a.src}(),b=a.match(/[\?\&]apikey=([^&]+)/i);return b?b[1]:""}(),a.OT||(a.OT=d),a.TB||(a.TB=d),d.properties={version:"v2.6.9",build:"26c0968",debug:"false",websiteURL:"http://www.tokbox.com",cdnURL:"http://static.opentok.com",loggingURL:"http://hlg.tokbox.com/prod",apiURL:"http://anvil.opentok.com",messagingProtocol:"wss",messagingPort:443,supportSSL:"true",cdnURLSSL:"https://static.opentok.com",loggingURLSSL:"https://hlg.tokbox.com/prod",apiURLSSL:"https://anvil.opentok.com",minimumVersion:{firefox:parseFloat("37"),chrome:parseFloat("39")}},d.$=a.OTHelpers,d.$.eventing(d),d.$.defineGetters=function(a,b,c){var d={};void 0===c&&(c=!1);for(var e in b)b.hasOwnProperty(e)&&(d[e]={get:b[e],enumerable:c});Object.defineProperties(a,d)},d.Modal=d.$.Modal,d.$.useLogHelpers(d);var o=!1,p=d.setLogLevel;d.setLogLevel=function(a){d.$.setLogLevel(a);var b=p.call(d,a);return d.shouldLog(d.DEBUG)&&!o&&(d.debug("OpenTok JavaScript library "+d.properties.version),d.debug("Release notes: "+d.properties.websiteURL+"/opentok/webrtc/docs/js/release-notes.html"),d.debug("Known issues: "+d.properties.websiteURL+"/opentok/webrtc/docs/js/release-notes.html#knownIssues"),o=!0),d.debug("OT.setLogLevel("+b+")"),b};var q="true"===d.properties.debug||d.properties.debug===!0;d.setLogLevel(q?d.DEBUG:d.ERROR),OTPlugin&&OTPlugin.isInstalled()&&(d.$.env.userAgent+="; OTPlugin "+OTPlugin.version()),d.$.userAgent=function(){return d.$.env.userAgent},d.Rumor={MessageType:{SUBSCRIBE:0,UNSUBSCRIBE:1,MESSAGE:2,CONNECT:3,DISCONNECT:4,PING:7,PONG:8,STATUS:9}},!function(){d.Rumor.PluginSocket=function(a,b){var c,e="initializing";OTPlugin.initRumorSocket(a,d.$.bind(function(a,f){a?(e="closed",b.onClose({code:4999})):"initializing"===e?(c=f,c.onOpen(function(){e="open",b.onOpen()}),c.onClose(function(a){e="closed",b.onClose({code:a})}),c.onError(function(a){e="closed",b.onError(a),b.onClose({code:a})}),c.onMessage(function(a,c,e,f){var g=new d.Rumor.Message(a,c,e,f);b.onMessage(g)}),c.open()):this.close()},this)),this.close=function(){return"initializing"===e||"closed"===e?void(e="closed"):void c.close(1e3,"")},this.send=function(a){"open"===e&&c.send(a)},this.isClosed=function(){return"closed"===e}}}(this),/**
 * @license  Copyright 2014 Joshua Bell
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Original source: https://github.com/inexorabletash/text-encoding
 ***/
function(a){"use strict";function b(a,b,c){return a>=b&&c>=a}function c(a,b){return Math.floor(a/b)}function e(a){var b=0;this.get=function(){return b>=a.length?r:Number(a[b])},this.offset=function(c){if(b+=c,0>b)throw new Error("Seeking past start of the buffer");if(b>a.length)throw new Error("Seeking past EOF")},this.match=function(c){if(c.length>b+a.length)return!1;var d;for(d=0;d<c.length;d+=1)if(Number(a[b+d])!==c[d])return!1;return!0}}function f(a){var b=0;this.emit=function(c){var d,e=r;for(d=0;d<arguments.length;++d)e=Number(arguments[d]),a[b++]=e;return e}}function g(a){function c(a){for(var c=[],d=0,e=a.length;d<a.length;){var f=a.charCodeAt(d);if(b(f,55296,57343))if(b(f,56320,57343))c.push(65533);else if(d===e-1)c.push(65533);else{var g=a.charCodeAt(d+1);if(b(g,56320,57343)){var h=1023&f,i=1023&g;d+=1,c.push(65536+(h<<10)+i)}else c.push(65533)}else c.push(f);d+=1}return c}var d=0,e=c(a);this.offset=function(a){if(d+=a,0>d)throw new Error("Seeking past start of the buffer");if(d>e.length)throw new Error("Seeking past EOF")},this.get=function(){return d>=e.length?s:e[d]}}function h(){var a="";this.string=function(){return a},this.emit=function(b){65535>=b?a+=String.fromCharCode(b):(b-=65536,a+=String.fromCharCode(55296+(b>>10&1023)),a+=String.fromCharCode(56320+(1023&b)))}}function i(a){this.name="EncodingError",this.message=a,this.code=0}function j(a,b){if(a)throw new i("Decoder error");return b||65533}function k(a){throw new i("The code point "+a+" could not be encoded.")}function l(a){return a=String(a).trim().toLowerCase(),Object.prototype.hasOwnProperty.call(v,a)?v[a]:null}function m(a){var c=a.fatal,d=0,e=0,f=0,g=0;this.decode=function(a){var h=a.get();if(h===r)return 0!==e?j(c):s;if(a.offset(1),0===e){if(b(h,0,127))return h;if(b(h,194,223))e=1,g=128,d=h-192;else if(b(h,224,239))e=2,g=2048,d=h-224;else{if(!b(h,240,244))return j(c);e=3,g=65536,d=h-240}return d*=Math.pow(64,e),null}if(!b(h,128,191))return d=0,e=0,f=0,g=0,a.offset(-1),j(c);if(f+=1,d+=(h-128)*Math.pow(64,e-f),f!==e)return null;var i=d,k=g;return d=0,e=0,f=0,g=0,b(i,k,1114111)&&!b(i,55296,57343)?i:j(c)}}function n(a){a.fatal;this.encode=function(a,d){var e=d.get();if(e===s)return r;if(d.offset(1),b(e,55296,57343))return k(e);if(b(e,0,127))return a.emit(e);var f,g;b(e,128,2047)?(f=1,g=192):b(e,2048,65535)?(f=2,g=224):b(e,65536,1114111)&&(f=3,g=240);for(var h=a.emit(c(e,Math.pow(64,f))+g);f>0;){var i=c(e,Math.pow(64,f-1));h=a.emit(128+i%64),f-=1}return h}}function o(a,b){return b.match([255,254])&&"utf-16"===a?void b.offset(2):b.match([254,255])&&"utf-16be"==a?void b.offset(2):b.match([239,187,191])&&"utf-8"==a?void b.offset(3):void 0}function p(b,c){if(!this||this===a)return new p(b,c);if(b=b?String(b):w,c=Object(c),this._encoding=l(b),null===this._encoding||"utf-8"!==this._encoding.name&&"utf-16"!==this._encoding.name&&"utf-16be"!==this._encoding.name)throw new TypeError("Unknown encoding: "+b);return this._streaming=!1,this._encoder=null,this._options={fatal:Boolean(c.fatal)},Object.defineProperty?Object.defineProperty(this,"encoding",{get:function(){return this._encoding.name}}):this.encoding=this._encoding.name,this}function q(b,c){if(!this||this===a)return new q(b,c);if(b=b?String(b):w,c=Object(c),this._encoding=l(b),null===this._encoding)throw new TypeError("Unknown encoding: "+b);return this._streaming=!1,this._decoder=null,this._options={fatal:Boolean(c.fatal)},Object.defineProperty?Object.defineProperty(this,"encoding",{get:function(){return this._encoding.name}}):this.encoding=this._encoding.name,this}if(!(d.$.env&&"IE"===d.$.env.name&&d.$.env.version<10||void 0!==a.TextEncoder&&void 0!==a.TextDecoder)){var r=-1,s=-1;i.prototype=Error.prototype;var t=[{encodings:[{labels:["unicode-1-1-utf-8","utf-8","utf8"],name:"utf-8"}],heading:"The Encoding"},{encodings:[{labels:["cp864","ibm864"],name:"ibm864"},{labels:["cp866","ibm866"],name:"ibm866"},{labels:["csisolatin2","iso-8859-2","iso-ir-101","iso8859-2","iso_8859-2","l2","latin2"],name:"iso-8859-2"},{labels:["csisolatin3","iso-8859-3","iso_8859-3","iso-ir-109","l3","latin3"],name:"iso-8859-3"},{labels:["csisolatin4","iso-8859-4","iso_8859-4","iso-ir-110","l4","latin4"],name:"iso-8859-4"},{labels:["csisolatincyrillic","cyrillic","iso-8859-5","iso_8859-5","iso-ir-144"],name:"iso-8859-5"},{labels:["arabic","csisolatinarabic","ecma-114","iso-8859-6","iso_8859-6","iso-ir-127"],name:"iso-8859-6"},{labels:["csisolatingreek","ecma-118","elot_928","greek","greek8","iso-8859-7","iso_8859-7","iso-ir-126"],name:"iso-8859-7"},{labels:["csisolatinhebrew","hebrew","iso-8859-8","iso-8859-8-i","iso-ir-138","iso_8859-8","visual"],name:"iso-8859-8"},{labels:["csisolatin6","iso-8859-10","iso-ir-157","iso8859-10","l6","latin6"],name:"iso-8859-10"},{labels:["iso-8859-13"],name:"iso-8859-13"},{labels:["iso-8859-14","iso8859-14"],name:"iso-8859-14"},{labels:["iso-8859-15","iso_8859-15"],name:"iso-8859-15"},{labels:["iso-8859-16"],name:"iso-8859-16"},{labels:["koi8-r","koi8_r"],name:"koi8-r"},{labels:["koi8-u"],name:"koi8-u"},{labels:["csmacintosh","mac","macintosh","x-mac-roman"],name:"macintosh"},{labels:["iso-8859-11","tis-620","windows-874"],name:"windows-874"},{labels:["windows-1250","x-cp1250"],name:"windows-1250"},{labels:["windows-1251","x-cp1251"],name:"windows-1251"},{labels:["ascii","ansi_x3.4-1968","csisolatin1","iso-8859-1","iso8859-1","iso_8859-1","l1","latin1","us-ascii","windows-1252"],name:"windows-1252"},{labels:["cp1253","windows-1253"],name:"windows-1253"},{labels:["csisolatin5","iso-8859-9","iso-ir-148","l5","latin5","windows-1254"],name:"windows-1254"},{labels:["cp1255","windows-1255"],name:"windows-1255"},{labels:["cp1256","windows-1256"],name:"windows-1256"},{labels:["windows-1257"],name:"windows-1257"},{labels:["cp1258","windows-1258"],name:"windows-1258"},{labels:["x-mac-cyrillic","x-mac-ukrainian"],name:"x-mac-cyrillic"}],heading:"Legacy single-byte encodings"},{encodings:[{labels:["chinese","csgb2312","csiso58gb231280","gb2312","gbk","gb_2312","gb_2312-80","iso-ir-58","x-gbk"],name:"gbk"},{labels:["gb18030"],name:"gb18030"},{labels:["hz-gb-2312"],name:"hz-gb-2312"}],heading:"Legacy multi-byte Chinese (simplified) encodings"},{encodings:[{labels:["big5","big5-hkscs","cn-big5","csbig5","x-x-big5"],name:"big5"}],heading:"Legacy multi-byte Chinese (traditional) encodings"},{encodings:[{labels:["cseucpkdfmtjapanese","euc-jp","x-euc-jp"],name:"euc-jp"},{labels:["csiso2022jp","iso-2022-jp"],name:"iso-2022-jp"},{labels:["csshiftjis","ms_kanji","shift-jis","shift_jis","sjis","windows-31j","x-sjis"],name:"shift_jis"}],heading:"Legacy multi-byte Japanese encodings"},{encodings:[{labels:["cseuckr","csksc56011987","euc-kr","iso-ir-149","korean","ks_c_5601-1987","ks_c_5601-1989","ksc5601","ksc_5601","windows-949"],name:"euc-kr"},{labels:["csiso2022kr","iso-2022-kr"],name:"iso-2022-kr"}],heading:"Legacy multi-byte Korean encodings"},{encodings:[{labels:["utf-16","utf-16le"],name:"utf-16"},{labels:["utf-16be"],name:"utf-16be"}],heading:"Legacy utf-16 encodings"}],u={},v={};t.forEach(function(a){a.encodings.forEach(function(a){u[a.name]=a,a.labels.forEach(function(b){v[b]=a})})});a["encoding-indexes"]||{};u["utf-8"].getEncoder=function(a){return new n(a)},u["utf-8"].getDecoder=function(a){return new m(a)};var w="utf-8";p.prototype={encode:function(a,b){a=a?String(a):"",b=Object(b),this._streaming||(this._encoder=this._encoding.getEncoder(this._options)),this._streaming=Boolean(b.stream);for(var c=[],d=new f(c),e=new g(a);e.get()!==s;)this._encoder.encode(d,e);if(!this._streaming){var h;do h=this._encoder.encode(d,e);while(h!==r);this._encoder=null}return new Uint8Array(c)}},q.prototype={decode:function(a,b){if(a&&!("buffer"in a&&"byteOffset"in a&&"byteLength"in a))throw new TypeError("Expected ArrayBufferView");a||(a=new Uint8Array(0)),b=Object(b),this._streaming||(this._decoder=this._encoding.getDecoder(this._options)),this._streaming=Boolean(b.stream);var c=new Uint8Array(a.buffer,a.byteOffset,a.byteLength),d=new e(c);this._BOMseen||(this._BOMseen=!0,o(this._encoding.name,d));for(var f,g=new h;d.get()!==r;)f=this._decoder.decode(d),null!==f&&f!==s&&g.emit(f);if(!this._streaming){do f=this._decoder.decode(d),null!==f&&f!==s&&g.emit(f);while(f!==s&&d.get()!=r);this._decoder=null}return g.string()}},a.TextEncoder=a.TextEncoder||p,a.TextDecoder=a.TextDecoder||q}}(this),d.Rumor.Message=function(a,b,c,d){this.type=a,this.toAddress=b,this.headers=c,this.data=d,this.transactionId=this.headers["TRANSACTION-ID"],this.status=this.headers.STATUS,this.isError=!(this.status&&"2"===this.status[0])},d.Rumor.Message.prototype.serialize=function(){var a,b,c,d,e=8,f=7,g=[],h=[],i=[];for(f++,c=0;c<this.toAddress.length;c++)g.push(new TextEncoder("utf-8").encode(this.toAddress[c])),f+=2,f+=g[c].length;f++,c=0;for(var j in this.headers)this.headers.hasOwnProperty(j)&&(h.push(new TextEncoder("utf-8").encode(j)),i.push(new TextEncoder("utf-8").encode(this.headers[j])),f+=4,f+=h[c].length,f+=i[c].length,c++);b=new TextEncoder("utf-8").encode(this.data),f+=b.length;var k=new ArrayBuffer(f),l=new Uint8Array(k,0,f);for(f-=4,l[0]=(4278190080&f)>>>24,l[1]=(16711680&f)>>>16,l[2]=(65280&f)>>>8,l[3]=(255&f)>>>0,l[4]=0,l[5]=0,l[6]=this.type,l[7]=this.toAddress.length,c=0;c<g.length;c++)for(a=g[c],l[e++]=a.length>>8&255,l[e++]=a.length>>0&255,d=0;d<a.length;d++)l[e++]=a[d];for(l[e++]=h.length,c=0;c<h.length;c++){for(a=h[c],l[e++]=a.length>>8&255,l[e++]=a.length>>0&255,d=0;d<a.length;d++)l[e++]=a[d];for(a=i[c],l[e++]=a.length>>8&255,l[e++]=a.length>>0&255,d=0;d<a.length;d++)l[e++]=a[d]}for(c=0;c<b.length;c++)l[e++]=b[c];return k},d.Rumor.Message.deserialize=function(a){"undefined"!=typeof Buffer&&Buffer.isBuffer(a)&&(a=e(a));var b,c,f,g,h,i,j,k,l=0,m=8,n=new Uint8Array(a);l+=n[0]<<24,l+=n[1]<<16,l+=n[2]<<8,l+=n[3]<<0,b=n[6];var o=[];for(k=0;k<n[7];k++)j=n[m++]<<8,j+=n[m++],c=new Uint8Array(a,m,j),o[k]=new TextDecoder("utf-8").decode(c),m+=j;for(f=n[m++],g={},k=0;f>k;k++)j=n[m++]<<8,j+=n[m++],c=new Uint8Array(a,m,j),h=new TextDecoder("utf-8").decode(c),m+=j,j=n[m++]<<8,j+=n[m++],c=new Uint8Array(a,m,j),i=new TextDecoder("utf-8").decode(c),g[h]=i,m+=j;var p=new Uint8Array(a,m),q=new TextDecoder("utf-8").decode(p);return new d.Rumor.Message(b,o,g,q)},d.Rumor.Message.Connect=function(a,b){var c={uniqueId:a,notifyDisconnectAddress:b};return new d.Rumor.Message(d.Rumor.MessageType.CONNECT,[],c,"")},d.Rumor.Message.Disconnect=function(){return new d.Rumor.Message(d.Rumor.MessageType.DISCONNECT,[],{},"")},d.Rumor.Message.Subscribe=function(a){return new d.Rumor.Message(d.Rumor.MessageType.SUBSCRIBE,a,{},"")},d.Rumor.Message.Unsubscribe=function(a){return new d.Rumor.Message(d.Rumor.MessageType.UNSUBSCRIBE,a,{},"")},d.Rumor.Message.Publish=function(a,b,c){return new d.Rumor.Message(d.Rumor.MessageType.MESSAGE,a,c||{},b||"")},d.Rumor.Message.Ping=function(){return new d.Rumor.Message(d.Rumor.MessageType.PING,[],{},"")},!function(){var a=100,b=10;d.Rumor.NativeSocket=function(c,e,f){var g,h,i,j;g=new c(e),g.binaryType="arraybuffer",g.onopen=f.onOpen,g.onclose=f.onClose,g.onerror=f.onError,g.onmessage=function(a){if(d){var b=d.Rumor.Message.deserialize(a.data);f.onMessage(b)}},h=function k(c){g&&(void 0===c&&(c=0),i&&clearTimeout(i),g.bufferedAmount>0&&b>=c+1?i=setTimeout(k,a,c+1):j())},j=function(){g.close()},this.close=function(a){a?h():j()},this.send=function(a){g.send(a.serialize())},this.isClosed=function(){return 3===g.readyState}}}(this);var r,s,t=9e3,u=5*t-100;r={1002:"The endpoint is terminating the connection due to a protocol error. (CLOSE_PROTOCOL_ERROR)",1003:"The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data). (CLOSE_UNSUPPORTED)",1004:"The endpoint is terminating the connection because a data frame was received that is too large. (CLOSE_TOO_LARGE)",1005:"Indicates that no status code was provided even though one was expected. (CLOSE_NO_STATUS)",1006:"Used to indicate that a connection was closed abnormally (that is, with no close frame being sent) when a status code is expected. (CLOSE_ABNORMAL)",1007:"Indicates that an endpoint is terminating the connection because it has received data within a message that was not consistent with the type of the message (e.g., non-UTF-8 [RFC3629] data within a text message)",1008:"Indicates that an endpoint is terminating the connection because it has received a message that violates its policy.  This is a generic status code that can be returned when there is no other more suitable status code (e.g., 1003 or 1009) or if there is a need to hide specific details about the policy",1009:"Indicates that an endpoint is terminating the connection because it has received a message that is too big for it to process",1011:"Indicates that a server is terminating the connection because it encountered an unexpected condition that prevented it from fulfilling the request",4001:"Connectivity loss was detected as it was too long since the socket received the last PONG message",4010:"Timed out while waiting for the Rumor socket to connect.",4020:"Error code unavailable.",4030:"Exception was thrown during Rumor connection, possibly because of a blocked port."},s={CLOSE_PROTOCOL_ERROR:1002,CLOSE_UNSUPPORTED:1003,CLOSE_TOO_LARGE:1004,CLOSE_NO_STATUS:1005,CLOSE_ABNORMAL:1006,CLOSE_TIMEOUT:4010,CLOSE_FALLBACK_CODE:4020,CLOSE_CONNECT_EXCEPTION:4030},d.Rumor.SocketError=function(a,b){this.code=a,this.message=b},d.Rumor.Socket=function(b,c,e){var f,g,h,i,j,k,l,m,n,o,p=this,q=["disconnected","error","connected","connecting","disconnecting"],v=function(a){switch(a){case"disconnected":case"error":if(f=null,j){var b;z()&&(b=new Error(r[4001]),b.code=4001),j(b)}}},w=d.$.statable(this,q,"disconnected",v),x=function(a,b){if(null===b||!d.$.isFunction(b))throw new Error("The Rumor.Socket "+a+" callback must be a valid function or null")},y=function(a,b){a=a||s.CLOSE_FALLBACK_CODE;var c=r[a]||"No message available from code.",e=c+(b?" "+b:"");d.error("Rumor.Socket: "+e);var f=new d.Rumor.SocketError(a,e);m&&clearTimeout(m),w("error"),"connecting"===p.previousState&&l&&(l(f,void 0),l=null),i&&i(f)},z=function(){return n?d.$.now()-n>=u:!1},A=function(){p.is("connected")&&(z()?F({code:4001}):(f.send(d.Rumor.Message.Ping()),o=setTimeout(A,t)))},B=function(){return!a.OT},C=function(){return m&&clearTimeout(m),p.isNot("connecting")?void d.debug("webSocketConnected reached in state other than connecting"):(f.send(d.Rumor.Message.Connect(g,c)),w("connected"),l&&(l(void 0,g),l=null),h&&h(g),void(o=setTimeout(function(){n=d.$.now(),A()},t)))},D=function(){var a=f;y(s.CLOSE_TIMEOUT);try{a.close()}catch(b){}},E=function(){},F=function(a){m&&clearTimeout(m),o&&clearTimeout(o),B()||(1e3!==a.code&&1001!==a.code&&(a.code?y(a.code):y(s.CLOSE_FALLBACK_CODE,a.reason||a.message)),p.isNot("error")&&w("disconnected"))},G=function(a){n=d.$.now(),k&&a.type!==d.Rumor.MessageType.PONG&&k(a)};this.publish=function(a,b,c){f.send(d.Rumor.Message.Publish(a,b,c))},this.subscribe=function(a){f.send(d.Rumor.Message.Subscribe(a))},this.unsubscribe=function(a){f.send(d.Rumor.Message.Unsubscribe(a))},this.connect=function(c,h){if(this.is("connecting","connected"))return void h(new d.Rumor.SocketError(null,"Rumor.Socket cannot connect when it is already connecting or connected."));g=c,l=h,w("connecting");var i=e||a.WebSocket,j={onOpen:C,onClose:F,onError:E,onMessage:G};try{f="undefined"!=typeof i?new d.Rumor.NativeSocket(i,b,j):new d.Rumor.PluginSocket(b,j),m=setTimeout(D,d.Rumor.Socket.CONNECT_TIMEOUT)}catch(k){d.error(k),y(s.CLOSE_CONNECT_EXCEPTION)}},this.disconnect=function(a){return m&&clearTimeout(m),o&&clearTimeout(o),f?void(f.isClosed()?this.isNot("error")&&w("disconnected"):(this.is("connected")&&f.send(d.Rumor.Message.Disconnect()),f.close(a))):void(this.isNot("error")&&w("disconnected"))},d.$.defineProperties(this,{id:{get:function(){return g}},onOpen:{set:function(a){x("onOpen",a),h=a},get:function(){return h}},onError:{set:function(a){x("onError",a),i=a},get:function(){return i}},onClose:{set:function(a){x("onClose",a),j=a},get:function(){return j}},onMessage:{set:function(a){x("onMessage",a),k=a},get:function(){return k}}})},d.Rumor.Socket.CONNECT_TIMEOUT=15e3,d.Raptor={Actions:{CONNECT:100,CREATE:101,UPDATE:102,DELETE:103,STATE:104,FORCE_DISCONNECT:105,FORCE_UNPUBLISH:106,SIGNAL:107,CREATE_ARCHIVE:108,CLOSE_ARCHIVE:109,START_RECORDING_SESSION:110,STOP_RECORDING_SESSION:111,START_RECORDING_STREAM:112,STOP_RECORDING_STREAM:113,LOAD_ARCHIVE:114,START_PLAYBACK:115,STOP_PLAYBACK:116,APPSTATE_PUT:117,APPSTATE_DELETE:118,OFFER:119,ANSWER:120,PRANSWER:121,CANDIDATE:122,SUBSCRIBE:123,UNSUBSCRIBE:124,QUERY:125,SDP_ANSWER:126,PONG:127,REGISTER:128,QUALITY_CHANGED:129},Types:{RPC_REQUEST:100,RPC_RESPONSE:101,STREAM:102,ARCHIVE:103,CONNECTION:104,APPSTATE:105,CONNECTIONCOUNT:106,MODERATION:107,SIGNAL:108,SUBSCRIBER:110,JSEP:109}},d.Raptor.serializeMessage=function(a){return JSON.stringify(a)},d.Raptor.deserializeMessage=function(a){if(0===a.length)return{};var b=JSON.parse(a),c=b.uri.substr(1).split("/");c.shift(),""===c[c.length-1]&&c.pop(),b.params={};for(var d=0,e=c.length;e-1>d;d+=2)b.params[c[d]]=c[d+1];return c.length%2===0?"channel"===c[c.length-2]&&c.length>6?b.resource=c[c.length-4]+"_"+c[c.length-2]:b.resource=c[c.length-2]:"channel"===c[c.length-1]&&c.length>5?b.resource=c[c.length-3]+"_"+c[c.length-1]:b.resource=c[c.length-1],b.signature=b.resource+"#"+b.method,b},d.Raptor.unboxFromRumorMessage=function(a){var b=d.Raptor.deserializeMessage(a.data);return b.transactionId=a.transactionId,b.fromAddress=a.headers["X-TB-FROM-ADDRESS"],b},d.Raptor.parseIceServers=function(a){try{return JSON.parse(a.data).content.iceServers}catch(b){return[]}},d.Raptor.Message={},d.Raptor.Message.offer=function(a,b){return d.Raptor.serializeMessage({method:"offer",uri:a,content:{sdp:b}})},d.Raptor.Message.connections={},d.Raptor.Message.connections.create=function(a,b,c){return d.Raptor.serializeMessage({method:"create",uri:"/v2/partner/"+a+"/session/"+b+"/connection/"+c,content:{userAgent:d.$.env.userAgent}})},d.Raptor.Message.connections.destroy=function(a,b,c){return d.Raptor.serializeMessage({method:"delete",uri:"/v2/partner/"+a+"/session/"+b+"/connection/"+c,content:{}})},d.Raptor.Message.sessions={},d.Raptor.Message.sessions.get=function(a,b){return d.Raptor.serializeMessage({method:"read",uri:"/v2/partner/"+a+"/session/"+b,content:{}})},d.Raptor.Message.streams={},d.Raptor.Message.streams.get=function(a,b,c){return d.Raptor.serializeMessage({method:"read",uri:"/v2/partner/"+a+"/session/"+b+"/stream/"+c,content:{}})},d.Raptor.Message.streams.channelFromOTChannel=function(a){var b={id:a.id,type:a.type,active:a.active};return"video"===a.type&&(b.width=a.width,b.height=a.height,b.orientation=a.orientation,b.frameRate=a.frameRate,"default"!==a.source&&(b.source=a.source),b.fitMode=a.fitMode),b},d.Raptor.Message.streams.create=function(a,b,c,e,f,g,h,i){var j={id:c,name:e,audioFallbackEnabled:f,channel:d.$.map(g,function(a){return d.Raptor.Message.streams.channelFromOTChannel(a)})};return h&&(j.minBitrate=h),i&&(j.maxBitrate=i),d.Raptor.serializeMessage({method:"create",uri:"/v2/partner/"+a+"/session/"+b+"/stream/"+c,content:j})},d.Raptor.Message.streams.destroy=function(a,b,c){return d.Raptor.serializeMessage({method:"delete",uri:"/v2/partner/"+a+"/session/"+b+"/stream/"+c,content:{}})},d.Raptor.Message.streams.answer=function(a,b,c,e){return d.Raptor.serializeMessage({method:"answer",uri:"/v2/partner/"+a+"/session/"+b+"/stream/"+c,content:{sdp:e}})},d.Raptor.Message.streams.candidate=function(a,b,c,e){return d.Raptor.serializeMessage({method:"candidate",uri:"/v2/partner/"+a+"/session/"+b+"/stream/"+c,content:e})},d.Raptor.Message.streamChannels={},d.Raptor.Message.streamChannels.update=function(a,b,c,e,f){return d.Raptor.serializeMessage({method:"update",uri:"/v2/partner/"+a+"/session/"+b+"/stream/"+c+"/channel/"+e,content:f})},d.Raptor.Message.subscribers={},d.Raptor.Message.subscribers.create=function(a,b,c,e,f,g){var h={id:e,connection:f,keyManagementMethod:d.$.supportedCryptoScheme(),bundleSupport:d.$.hasCapabilities("bundle"),rtcpMuxSupport:d.$.hasCapabilities("RTCPMux")};return g&&(h.channel=g),d.Raptor.serializeMessage({method:"create",uri:"/v2/partner/"+a+"/session/"+b+"/stream/"+c+"/subscriber/"+e,content:h})},d.Raptor.Message.subscribers.destroy=function(a,b,c,e){return d.Raptor.serializeMessage({method:"delete",uri:"/v2/partner/"+a+"/session/"+b+"/stream/"+c+"/subscriber/"+e,content:{}})},d.Raptor.Message.subscribers.update=function(a,b,c,e,f){return d.Raptor.serializeMessage({method:"update",uri:"/v2/partner/"+a+"/session/"+b+"/stream/"+c+"/subscriber/"+e,content:f})},d.Raptor.Message.subscribers.candidate=function(a,b,c,e,f){return d.Raptor.serializeMessage({method:"candidate",uri:"/v2/partner/"+a+"/session/"+b+"/stream/"+c+"/subscriber/"+e,content:f})},d.Raptor.Message.subscribers.answer=function(a,b,c,e,f){return d.Raptor.serializeMessage({method:"answer",uri:"/v2/partner/"+a+"/session/"+b+"/stream/"+c+"/subscriber/"+e,content:{sdp:f}})},d.Raptor.Message.subscriberChannels={},d.Raptor.Message.subscriberChannels.update=function(a,b,c,e,f,g){return d.Raptor.serializeMessage({method:"update",uri:"/v2/partner/"+a+"/session/"+b+"/stream/"+c+"/subscriber/"+e+"/channel/"+f,content:g})},d.Raptor.Message.signals={},d.Raptor.Message.signals.create=function(a,b,c,e,f){var g={};return void 0!==e&&(g.type=e),void 0!==f&&(g.data=f),d.Raptor.serializeMessage({method:"signal",uri:"/v2/partner/"+a+"/session/"+b+(void 0!==c?"/connection/"+c:"")+"/signal/"+d.$.uuid(),content:g})},!function(){var a;a={409:"This P2P session already has 2 participants.",410:"The session already has four participants.",1004:"The token passed is invalid."},d.Raptor.Dispatcher=function(){d.$.eventing(this,!0),this.callbacks={}},d.Raptor.Dispatcher.prototype.registerCallback=function(a,b){this.callbacks[a]=b},d.Raptor.Dispatcher.prototype.triggerCallback=function(a){if(a){var b=this.callbacks[a];if(b&&d.$.isFunction(b)){var c=Array.prototype.slice.call(arguments);c.shift(),b.apply(null,c)}delete this.callbacks[a]}},d.Raptor.Dispatcher.prototype.onClose=function(a){this.emit("close",a)},d.Raptor.Dispatcher.prototype.dispatch=function(a){if(a.type===d.Rumor.MessageType.STATUS){d.debug("OT.Raptor.dispatch: STATUS"),d.debug(a);var b;return a.isError&&(b=new d.Error(a.status)),void this.triggerCallback(a.transactionId,b,a)}var c=d.Raptor.unboxFromRumorMessage(a);switch(d.debug("OT.Raptor.dispatch "+c.signature),d.debug(a.data),c.resource){case"session":this.dispatchSession(c);break;case"connection":this.dispatchConnection(c);break;case"stream":this.dispatchStream(c);break;case"stream_channel":this.dispatchStreamChannel(c);break;case"subscriber":this.dispatchSubscriber(c);break;case"subscriber_channel":this.dispatchSubscriberChannel(c);break;case"signal":this.dispatchSignal(c);break;case"archive":this.dispatchArchive(c);break;default:d.warn("OT.Raptor.dispatch: Type "+c.resource+" is not currently implemented")}},d.Raptor.Dispatcher.prototype.dispatchSession=function(a){switch(a.method){case"read":this.emit("session#read",a.content,a.transactionId);break;default:d.warn("OT.Raptor.dispatch: "+a.signature+" is not currently implemented")}},d.Raptor.Dispatcher.prototype.dispatchConnection=function(a){switch(a.method){case"created":this.emit("connection#created",a.content);break;case"deleted":this.emit("connection#deleted",a.params.connection,a.reason);break;default:d.warn("OT.Raptor.dispatch: "+a.signature+" is not currently implemented")}},d.Raptor.Dispatcher.prototype.dispatchStream=function(a){switch(a.method){case"created":this.emit("stream#created",a.content,a.transactionId);break;case"deleted":this.emit("stream#deleted",a.params.stream,a.reason);break;case"updated":this.emit("stream#updated",a.params.stream,a.content);break;case"generateoffer":case"answer":case"pranswer":case"offer":case"candidate":this.dispatchJsep(a.method,a);break;default:d.warn("OT.Raptor.dispatch: "+a.signature+" is not currently implemented")}},d.Raptor.Dispatcher.prototype.dispatchStreamChannel=function(a){switch(a.method){case"updated":this.emit("streamChannel#updated",a.params.stream,a.params.channel,a.content);break;default:d.warn("OT.Raptor.dispatch: "+a.signature+" is not currently implemented")}},d.Raptor.Dispatcher.prototype.dispatchJsep=function(a,b){this.emit("jsep#"+a,b.params.stream,b.fromAddress,b)},d.Raptor.Dispatcher.prototype.dispatchSubscriberChannel=function(a){switch(a.method){case"updated":this.emit("subscriberChannel#updated",a.params.stream,a.params.channel,a.content);break;case"update":this.emit("subscriberChannel#update",a.params.subscriber,a.params.stream,a.content);break;default:d.warn("OT.Raptor.dispatch: "+a.signature+" is not currently implemented")}},d.Raptor.Dispatcher.prototype.dispatchSubscriber=function(a){switch(a.method){case"created":this.emit("subscriber#created",a.params.stream,a.fromAddress,a.content.id);break;case"deleted":this.dispatchJsep("unsubscribe",a),this.emit("subscriber#deleted",a.params.stream,a.fromAddress);break;case"generateoffer":case"answer":case"pranswer":case"offer":case"candidate":this.dispatchJsep(a.method,a);break;default:d.warn("OT.Raptor.dispatch: "+a.signature+" is not currently implemented")}},d.Raptor.Dispatcher.prototype.dispatchSignal=function(a){return"signal"!==a.method?void d.warn("OT.Raptor.dispatch: "+a.signature+" is not currently implemented"):void this.emit("signal",a.fromAddress,a.content.type,a.content.data)},d.Raptor.Dispatcher.prototype.dispatchArchive=function(a){switch(a.method){case"created":this.emit("archive#created",a.content);break;case"updated":this.emit("archive#updated",a.params.archive,a.content)}}}(this),function(a){function b(a,b){var c=a.channel.map(function(a){return new d.StreamChannel(a)}),e=a.connectionId?a.connectionId:a.connection.id;return new d.Stream(a.id,a.name,a.creationTime,b.connections.get(e),b,c)}function c(a,c){if(!c.streams.has(a.id)){var d=b(a,c);return c.streams.add(d),d}}function e(a){return new d.Archive(a.id,a.name,a.status)}function f(a,b){if(!b.archives.has(a.id)){var c=e(a);return b.archives.add(c),c}}d.publishers=new d.$.Collection("guid"),d.subscribers=new d.$.Collection("widgetId"),d.sessions=new d.$.Collection;var g=function(a){var b=[];this.enqueue=function(){b.push(Array.prototype.slice.call(arguments))},this.triggerAll=function(){for(var c;c=b.shift();)a.trigger.apply(a,c)}},h=function(a){var b={};this.enqueue=function(){var c=arguments[0],d=Array.prototype.slice.call(arguments,1);b[c]||(b[c]=new g(a)),b[c].enqueue.apply(b[c],d)},this.triggerConnectionCreated=function(a){b["connectionCreated"+a.id]&&b["connectionCreated"+a.id].triggerAll()},this.triggerSessionConnected=function(a){b.sessionConnected&&b.sessionConnected.triggerAll(),d.$.forEach(a,function(a){this.triggerConnectionCreated(a)})}},i={};a.OT.SessionDispatcher=function(a){var b=new d.Raptor.Dispatcher,e=!1,g=new h(b);b.on("close",function(b){var c=a.connection;if(c)return c.destroyedReason()?void d.debug("OT.Raptor.Socket: Socket was closed but the connection had already been destroyed. Reason: "+c.destroyedReason()):void c.destroy(b)});var j=function(b,e){return b=d.Connection.fromHash(b),(e||a.connection&&b.id!==a.connection.id)&&(a.connections.add(b),g.triggerConnectionCreated(b)),d.$.forEach(d.$.keys(i),function(d){var f=i[d];if(f&&b.id===f.connection.id){c(f,a),delete i[f.id];var g={debug:e?"connection came in session#read":"connection came in connection#created",streamId:f.id,connectionId:b.id};a.logEvent("streamCreated","warning",g)}}),b};b.on("session#read",function(h,i){var k,l={};l.streams=[],l.connections=[],l.archives=[],d.$.forEach(h.connection,function(a){k=j(a,!0),l.connections.push(k)}),d.$.forEach(h.stream,function(b){l.streams.push(c(b,a))}),d.$.forEach(h.archive||h.archives,function(b){l.archives.push(f(b,a))}),a._.subscriberMap={},b.triggerCallback(i,null,l),e=!0,g.triggerSessionConnected(a.connections)}),b.on("connection#created",function(a){j(a)}),b.on("connection#deleted",function(b,c){b=a.connections.get(b),b.destroy(c)}),b.on("stream#created",function(d,e){var f=d.connectionId?d.connectionId:d.connection.id;if(a.connections.has(f))d=c(d,a);else{i[d.id]=d;var g={debug:"eventOrderError -- streamCreated event before connectionCreated",streamId:d.id};a.logEvent("streamCreated","warning",g)}d.publisher&&d.publisher.setStream(d),b.triggerCallback(e,null,d)}),b.on("stream#deleted",function(b,c){var e=a.streams.get(b);return e?void e.destroy(c):void d.error("OT.Raptor.dispatch: A stream does not exist with the id of "+b+", for stream#deleted message!")}),b.on("stream#updated",function(b,c){var e=a.streams.get(b);return e?void e._.update(c):void d.error("OT.Raptor.dispatch: A stream does not exist with the id of "+b+", for stream#updated message!")}),b.on("streamChannel#updated",function(b,c,e){var f;return b&&(f=a.streams.get(b))?void f._.updateChannel(c,e):void d.error("OT.Raptor.dispatch: Unable to determine streamId, or the stream does not exist, for streamChannel message!")});var k=function(a,b,c,e){var f,g;switch(a){case"offer":g=[];var h=d.subscribers.find({streamId:b});h&&g.push(h);break;case"answer":case"pranswer":case"generateoffer":case"unsubscribe":g=d.publishers.where({streamId:b});break;case"candidate":g=d.publishers.where({streamId:b}).concat(d.subscribers.where({streamId:b}));break;default:return void d.warn("OT.Raptor.dispatch: jsep#"+a+" is not currently implemented")}if(0!==g.length){if(f=g[0].session.connections.get(c),!f&&c.match(/^symphony\./))f=d.Connection.fromHash({id:c,creationTime:Math.floor(d.$.now())}),g[0].session.connections.add(f);else if(!f)return void d.warn("OT.Raptor.dispatch: Messsage comes from a connection ("+c+") that we do not know about. The message was ignored.");d.$.forEach(g,function(b){b.processMessage(a,f,e)})}};return b.on("jsep#offer",d.$.bind(k,null,"offer")),b.on("jsep#answer",d.$.bind(k,null,"answer")),b.on("jsep#pranswer",d.$.bind(k,null,"pranswer")),b.on("jsep#generateoffer",d.$.bind(k,null,"generateoffer")),b.on("jsep#unsubscribe",d.$.bind(k,null,"unsubscribe")),b.on("jsep#candidate",d.$.bind(k,null,"candidate")),b.on("subscriberChannel#updated",function(b,c,e){return b&&a.streams.has(b)?void a.streams.get(b)._.updateChannel(c,e):void d.error("OT.Raptor.dispatch: Unable to determine streamId, or the stream does not exist, for subscriberChannel#updated message!")}),b.on("subscriberChannel#update",function(b,c,e){return c&&a.streams.has(c)?d.subscribers.has(b)?void d.subscribers.get(b).disableVideo(e.active):void d.error("OT.Raptor.dispatch: Unable to determine subscriberId, or the subscriber does not exist, for subscriberChannel#update message!"):void d.error("OT.Raptor.dispatch: Unable to determine streamId, or the stream does not exist, for subscriberChannel#update message!")}),b.on("subscriber#created",function(b,c,e){var f=b?a.streams.get(b):null;return f?void(a._.subscriberMap[c+"_"+f.id]=e):void d.error("OT.Raptor.dispatch: Unable to determine streamId, or the stream does not exist, for subscriber#created message!")}),b.on("subscriber#deleted",function(b,c){var e=b?a.streams.get(b):null;return e?void delete a._.subscriberMap[c+"_"+e.id]:void d.error("OT.Raptor.dispatch: Unable to determine streamId, or the stream does not exist, for subscriber#created message!")}),b.on("signal",function(b,c,d){var f=a.connections.get(b);a.connection&&b===a.connection.connectionId?e?a._.dispatchSignal(f,c,d):g.enqueue("sessionConnected","signal",b,c,d):a.connections.get(b)?a._.dispatchSignal(f,c,d):g.enqueue("connectionCreated"+b,"signal",b,c,d)}),b.on("archive#created",function(b){f(b,a)}),b.on("archive#updated",function(b,c){var e=a.archives.get(b);return e?void e._.update(c):void d.error("OT.Raptor.dispatch: An archive does not exist with the id of "+b+", for archive#updated message!")}),b}}(a),d.httpTest=f;var v=1e4,w=2e4,x={};x.getMLineIndex=function(a,b){
var c="m="+b;return d.$.findIndex(a,function(a){return-1!==a.indexOf(c)?!0:!1})},x.getMLine=function(a,b){var c=x.getMLineIndex(a,b);return c>-1?a[c]:void 0},x.hasMLinePayloadType=function(a,b,c){var e=x.getMLine(a,b),f=x.getMLinePayloadTypes(e,b);return d.$.arrayIndexOf(f,c)>-1},x.getMLinePayloadTypes=function(a,b){var c=new RegExp("^m="+b+" \\d+(/\\d+)? [a-zA-Z0-9/]+(( [a-zA-Z0-9/]+)+)$","i"),e=a.match(c);return!e||e.length<2?[]:d.$.trim(e[2]).split(" ")},x.removeTypesFromMLine=function(a,b){return d.$.trim(a.replace(new RegExp(" "+b.join(" |"),"ig")," ").replace(/\s+/g," "))},x.removeMediaEncoding=function(a,b,c){var e,f,g=a.split("\r\n"),h=x.getMLineIndex(g,b),i=h>-1?g[h]:void 0,j=[];if(-1===h)return g.join("\r\n");if(e=x.getMLinePayloadTypes(i,b),0===e.length)return g.join("\r\n");var k=new RegExp("a=rtpmap:("+e.join("|")+") "+c+"\\/\\d+","i");return g=d.$.filter(g,function(a,b){return f=a.match(k),null===f?!0:(j.push(f[1]),h>b&&h--,!1)}),j.length>0&&h>-1&&(g[h]=x.removeTypesFromMLine(i,j)),g.join("\r\n")},x.removeComfortNoise=function(a){return x.removeMediaEncoding(a,"audio","CN")},x.removeVideoCodec=function(a,b){return x.removeMediaEncoding(a,"video",b)};var y=function(a,b){var c=b.filterByName("ssrc-group:FID"),d=0===c.length;if(c.length>1)throw new Error("WTF Simulcast?!");switch(c=d?[]:c[0].value.split(" "),c.length){case 0:case 1:var e=b.find(function(a){return 0===a.name.indexOf("rtpmap:")&&a.value.indexOf("rtx/90000")>-1});if(!e)return!1;var f=e.name.split(":")[1];return f.indexOf("/")>-1&&(f=f.split("/")[0]),x.hasMLinePayloadType(a,"video",f);default:return!0}};x.getAttributesForMediaType=function(a,b){for(var c,e,f,g,h,i,j,k=x.getMLineIndex(a,b),l=new RegExp("m=(^"+b+") ","i"),m=new RegExp("a=ssrc:\\d+ .*","i"),n=new RegExp("a=ssrc-group:FID (\\d+).*?","i"),o=new RegExp("a=([a-z0-9:/-]+) (.*)","i"),p=[],q=k+1;q<a.length&&!l.test(a[q]);q++){h=a[q].match(n),h&&(c=q,g=h[1]),i=a[q].match("a=ssrc:"+g+" msid:(.+)"),i&&(j=i[1]);var r=m.test(a[q]);(void 0!==c&&void 0===e&&!r||q===a.length-1)&&(e=q),f=o.exec(a[q]),f&&3===f.length&&p.push({name:f[1],value:f[2]})}return p.ssrcStartIndex=c,p.ssrcEndIndex=e,p.msid=j,Array.prototype.filter||(p.filter=d.$.bind(d.$.filter,d.$,p)),Array.prototype.find||(p.find=d.$.bind(d.$.find,d.$,p)),p.isUsingRTX=d.$.bind(y,null,a,p),p.filterByName=function(a){return this.filter(function(b){return b.name===a})},p},x.enableSimulcast=function(a,b){var c,d,e=a.split("\r\n"),f=x.getAttributesForMediaType(e,"video"),g=f.isUsingRTX(),h=[],i=[];for(d=0;b>d;++d)h.push(v+d),g&&i.push(w+d);if(c=["a=ssrc-group:SIM "+h.join(" ")],g)for(d=0;b>d;++d)c.push("a=ssrc-group:FID "+h[d]+" "+i[d]);for(d=0;b>d;++d)c.push("a=ssrc:"+h[d]+" cname:localCname","a=ssrc:"+h[d]+" msid:"+f.msid);if(g)for(d=0;b>d;++d)c.push("a=ssrc:"+i[d]+" cname:localCname","a=ssrc:"+i[d]+" msid:"+f.msid);return c.unshift(f.ssrcStartIndex,f.ssrcEndIndex-f.ssrcStartIndex),e.splice.apply(e,c),e.join("\r\n")};var z={};z.isVideoStat=g,z.isAudioStat=h,z.isInboundStat=i,z.parseStatCategory=j,z.normalizeTimestamp=k,d.getStatsHelpers=z,d.getStatsAdpater=l,d.webrtcTest=m,d.Chrome=function(a){var b=!1,c={},e=function(b,d){d.parent=this,d.appendTo(a.parent),c[b]=d,this[b]=d};a.parent&&(d.$.eventing(this),this.destroy=function(){this.off(),this.hideWhileLoading();for(var a in c)c[a].destroy()},this.showAfterLoading=function(){b=!0;for(var a in c)c[a].showAfterLoading()},this.hideWhileLoading=function(){b=!1;for(var a in c)c[a].hideWhileLoading()},this.set=function(a,b){if("string"==typeof a&&b)e.call(this,a,b);else for(var c in a)a.hasOwnProperty(c)&&e.call(this,c,a[c]);return this})},d.Chrome.Behaviour||(d.Chrome.Behaviour={}),d.Chrome.Behaviour.Widget=function(a,b){var c,e,f=b||{},g="auto";a.setDisplayMode=function(a){var b=a||"auto";c!==b&&(d.$.removeClass(this.domElement,"OT_mode-"+c),d.$.addClass(this.domElement,"OT_mode-"+b),"off"===b&&(g=c),c=b)},a.getDisplayMode=function(){return c},a.show=function(){return c!==g&&(this.setDisplayMode(g),f.onShow&&f.onShow()),this},a.showAfterLoading=function(){this.setDisplayMode(e)},a.hide=function(){return"off"!==c&&(this.setDisplayMode("off"),f.onHide&&f.onHide()),this},a.hideWhileLoading=function(){e=c,this.setDisplayMode("off")},a.destroy=function(){return f.onDestroy&&f.onDestroy(this.domElement),this.domElement&&d.$.removeElement(this.domElement),a},a.appendTo=function(b){return this.domElement=d.$.createElement(f.nodeName||"div",f.htmlAttributes,f.htmlContent),f.onCreate&&f.onCreate(this.domElement),a.setDisplayMode(f.mode),"auto"===f.mode&&(d.$.addClass(a.domElement,"OT_mode-on-hold"),setTimeout(function(){d.$.removeClass(a.domElement,"OT_mode-on-hold")},2e3)),b.appendChild(this.domElement),a}},d.Chrome.VideoDisabledIndicator=function(a){var b,c=!1,e=!1;b=d.$.bind(function(a){var b=["auto","on"].indexOf(this.getDisplayMode())>-1;d.$.removeClass(a,"OT_video-disabled OT_video-disabled-warning OT_active"),b&&(c?d.$.addClass(a,"OT_video-disabled"):e&&d.$.addClass(a,"OT_video-disabled-warning"),d.$.addClass(a,"OT_active"))},this),this.disableVideo=function(a){c=a,a===!0&&(e=!1),b(this.domElement)},this.setWarning=function(a){e=a,b(this.domElement)},d.Chrome.Behaviour.Widget(this,{mode:a.mode||"auto",nodeName:"div",htmlAttributes:{className:"OT_video-disabled-indicator"}});var f=d.$.bind(this.setDisplayMode,this);this.setDisplayMode=function(a){f(a),b(this.domElement)}},d.Chrome.NamePanel=function(a){var b=a.name;b&&""!==d.$.trim(b).length||(b=null,a.mode="off"),this.setName=d.$.bind(function(a){b||this.setDisplayMode("auto"),b=a,this.domElement.innerHTML=b}),d.Chrome.Behaviour.Widget(this,{mode:a.mode,nodeName:"h1",htmlContent:b,htmlAttributes:{className:"OT_name OT_edge-bar-item"}})},d.Chrome.MuteButton=function(a){var b,c,e,f,g,h=a.muted||!1;c=d.$.bind(function(){h?d.$.addClass(this.domElement,"OT_active"):d.$.removeClass(this.domElement,"OT_active ")},this),e=function(a){b=d.$.bind(g,this),d.$.on(a,"click",b)},f=function(a){b=null,d.$.off(a,"click",b)},g=function(){return h=!h,c(),h?this.parent.trigger("muted",this):this.parent.trigger("unmuted",this),!1},d.$.defineProperties(this,{muted:{get:function(){return h},set:function(a){h=a,c()}}});var i=h?"OT_edge-bar-item OT_mute OT_active":"OT_edge-bar-item OT_mute";d.Chrome.Behaviour.Widget(this,{mode:a.mode,nodeName:"button",htmlContent:"Mute",htmlAttributes:{className:i},onCreate:d.$.bind(e,this),onDestroy:d.$.bind(f,this)})},d.Chrome.BackingBar=function(a){function b(){return"on"===c||"on"===e?"on":"mini"===c||"mini"===e?"mini":"mini-auto"===c||"mini-auto"===e?"mini-auto":"auto"===c||"auto"===e?"auto":"off"}var c=a.nameMode,e=a.muteMode;d.Chrome.Behaviour.Widget(this,{mode:b(),nodeName:"div",htmlContent:"",htmlAttributes:{className:"OT_bar OT_edge-bar-item"}}),this.setNameMode=function(a){c=a,this.setDisplayMode(b())},this.setMuteMode=function(a){e=a,this.setDisplayMode(b())}},d.Chrome.AudioLevelMeter=function(a){function b(){e=d.$.createElement("div",{className:"OT_audio-level-meter__bar"},""),g=d.$.createElement("div",{className:"OT_audio-level-meter__value"},""),f=d.$.createElement("div",{className:"OT_audio-level-meter__audio-only-img"},""),i.domElement.appendChild(e),i.domElement.appendChild(f),i.domElement.appendChild(g)}function c(){var a=100*h/(j-k);g.style.width=g.style.height=2*a+"%",g.style.top=g.style.right=-a+"%"}var e,f,g,h,i=this,j=a.maxValue||1,k=a.minValue||0,l={mode:a?a.mode:"auto",nodeName:"div",htmlAttributes:{className:"OT_audio-level-meter"},onCreate:b};d.Chrome.Behaviour.Widget(this,l);var m=d.$.bind(i.setDisplayMode,i);i.setDisplayMode=function(b){m(b),"off"===b?a.onPassivate&&a.onPassivate():a.onActivate&&a.onActivate()},i.setValue=function(a){h=a,c()}},d.Chrome.Archiving=function(a){var b,c,e,f,g,h,i,j=a.archiving,k=a.archivingStarted||"Archiving on",l=a.archivingEnded||"Archiving off",m=!0;h=function(a){f.nodeValue=a,b.setAttribute("title",a)},i=d.$.bind(function(){g&&(clearTimeout(g),g=null),j?d.$.addClass(c,"OT_active"):d.$.removeClass(c,"OT_active"),d.$.removeClass(this.domElement,"OT_archiving-"+(j?"off":"on")),d.$.addClass(this.domElement,"OT_archiving-"+(j?"on":"off")),a.show&&j?(h(k),d.$.addClass(e,"OT_mode-on"),d.$.removeClass(e,"OT_mode-auto"),this.setDisplayMode("on"),g=setTimeout(function(){d.$.addClass(e,"OT_mode-auto"),d.$.removeClass(e,"OT_mode-on")},5e3)):a.show&&!m?(d.$.addClass(e,"OT_mode-on"),d.$.removeClass(e,"OT_mode-auto"),this.setDisplayMode("on"),h(l),g=setTimeout(d.$.bind(function(){this.setDisplayMode("off")},this),5e3)):this.setDisplayMode("off")},this),d.Chrome.Behaviour.Widget(this,{mode:j&&a.show&&"on"||"off",nodeName:"h1",htmlAttributes:{className:"OT_archiving OT_edge-bar-item OT_edge-bottom"},onCreate:d.$.bind(function(){b=d.$.createElement("div",{className:"OT_archiving-light-box"},""),c=d.$.createElement("div",{className:"OT_archiving-light"},""),b.appendChild(c),e=d.$.createElement("div",{className:"OT_archiving-status OT_mode-on OT_edge-bar-item OT_edge-bottom"},""),f=document.createTextNode(""),e.appendChild(f),this.domElement.appendChild(b),this.domElement.appendChild(e),i()},this)}),this.setShowArchiveStatus=d.$.bind(function(b){a.show=b,this.domElement&&i.call(this)},this),this.setArchiving=d.$.bind(function(a){j=a,m=!1,this.domElement&&i.call(this)},this)},!function(a){if(a&&"undefined"!=typeof navigator){var b=a.webkitRTCPeerConnection||a.mozRTCPeerConnection;navigator.webkitGetUserMedia?(webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks}),webkitMediaStream.prototype.getAudioTracks||(webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams}),webkitRTCPeerConnection.prototype.getRemoteStreams||(webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})):navigator.mozGetUserMedia&&(MediaStream.prototype.getVideoTracks||(MediaStream.prototype.getVideoTracks=function(){return[]}),MediaStream.prototype.getAudioTracks||(MediaStream.prototype.getAudioTracks=function(){return[]})),"undefined"!=typeof a.MediaStreamTrack&&(a.MediaStreamTrack.prototype.setEnabled||(a.MediaStreamTrack.prototype.setEnabled=function(a){this.enabled=d.$.castToBoolean(a)})),!a.URL&&a.webkitURL&&(a.URL=a.webkitURL),d.$.createPeerConnection=function(a,c,d,e){if(OTPlugin.isInstalled())OTPlugin.initPeerConnection(a,c,d,e);else{var f;try{f=new b(a,c)}catch(g){return void e(g.message)}e(null,f)}}}d.$.supportedCryptoScheme=function(){return"Chrome"===d.$.env.name&&d.$.env.version<25?"SDES_SRTP":"DTLS_SRTP"}}(a);var A,B=function(a,b,c,e){var f,g;f=function(a,b){return function(c){d.error(a),d.error(c),e&&e(a,c,b)}},g=function(d){d.sdp=x.removeComfortNoise(d.sdp),d.sdp=x.removeVideoCodec(d.sdp,"ulpfec"),d.sdp=x.removeVideoCodec(d.sdp,"red"),b>1&&(d.sdp=x.enableSimulcast(d.sdp,b)),a.setLocalDescription(d,function(){c(d)},f("Error while setting LocalDescription","SetLocalDescription"))},a.createOffer(g,f("Error while creating Offer","CreateOffer"),{})},C=function(a,b,c,e){var f,g,h;if(f=function(a,b){return function(c){d.error(a),d.error(c),e&&e(a,c,b)}},g=function(b){b.sdp=x.removeComfortNoise(b.sdp),b.sdp=x.removeVideoCodec(b.sdp,"ulpfec"),b.sdp=x.removeVideoCodec(b.sdp,"red"),a.setLocalDescription(b,function(){c(b)},f("Error while setting LocalDescription","SetLocalDescription"))},h=function(){a.createAnswer(g,f("Error while setting createAnswer","CreateAnswer"),null,!1)},-1===b.sdp.indexOf("a=rtcp-fb")){var i="a=rtcp-fb:* ccm fir\r\na=rtcp-fb:* nack ";b.sdp=b.sdp.replace(/^m=video(.*)$/gim,"m=video$1\r\n"+i)}a.setRemoteDescription(b,h,f("Error while setting RemoteDescription","SetRemoteDescription"))};A=OTPlugin.isInstalled()?OTPlugin.RTCIceCandidate:a.mozRTCIceCandidate||a.RTCIceCandidate;var D,E=function(){var a=[],b=null;this.setPeerConnection=function(a){b=a},this.process=function(c){var d=new A(c.content);b?b.addIceCandidate(d):a.push(d)},this.processPending=function(){for(;a.length;)b.addIceCandidate(a.shift())}},F=function(a){this.data=a.data,this.source=a.source,this.lastEventId=a.lastEventId,this.origin=a.origin,this.timeStamp=a.timeStamp,this.type=a.type,this.ports=a.ports,this.path=a.path},G=function(a){var b={},c=[],e={sentMessages:0,recvMessages:0},f=function(a){return c.push(a),b},g=function(c){return a.send(c),e.sentMessages++,b},h=function(){for(var a;a=c.shift();)b.send(a)},i=function(){b.send=g,h()},j=function(a){b.send=f,b.trigger("close",a)},k=function(a){d.error("Data Channel Error:",a)},l=function(a){var c=new F(a);e.recvMessages++,b.trigger("message",c)};return d.$.eventing(b,!0),b.label=a.label,b.id=a.id,b.reliable=a.reliable,b.negotiated=a.negotiated,b.ordered=a.ordered,b.protocol=a.protocol,b._channel=a,b.close=function(){a.close()},b.equals=function(a,c){if(b.label!==a)return!1;for(var d in c)if(c.hasOwnProperty(d)&&b[d]!==c[d])return!1;return!0},b.getQosData=function(){return e},b.send=f,a.addEventListener("open",i,!1),a.addEventListener("close",j,!1),a.addEventListener("error",k,!1),a.addEventListener("message",l,!1),b},H=function(a){var b=[],c={},e={sentMessages:0,recvMessages:0},f=function(a){d.$.filter(b,function(b){return a!==b})},g=function(a){var c=new G(a);return b.push(c),c.on("close",function(){f(c)}),c};return c.add=function(b,c){return g(a.createDataChannel(b,c))},c.addMany=function(a){for(var b in a)a.hasOwnProperty(b)&&c.add(b,a[b])},c.get=function(a,c){return d.$.find(b,function(b){return b.equals(a,c)})},c.getOrAdd=function(a,b){var d=c.get(a,b);return d||(d=c.add(a,b)),d},c.getQosData=function(){var a={sentMessages:0,recvMessages:0};return d.$.forEach(b,function(b){a.sentMessages+=b.getQosData().sentMessages,a.recvMessages+=b.getQosData().recvMessages}),a},c.sampleQos=function(){var a=c.getQosData(),b={sentMessages:a.sentMessages-e.sentMessages,recvMessages:a.recvMessages-e.recvMessages};return e=a,b},c.destroy=function(){d.$.forEach(b,function(a){a.close()}),b=[]},a.addEventListener("datachannel",function(a){g(a.channel)},!1),c},I=function(a){var b,c,e=d.$.now(),f=[],g=function(){var c=d.$.now(),e=f[f.length-1],g={delta:b?c-b:0};e&&e.iceConnection===a.iceConnectionState||(g.iceConnectionState=a.iceConnectionState),e&&e.signalingState===a.signalingState||(g.signalingState=a.signalingState),e&&e.iceGatheringState===a.iceGatheringState||(g.iceGathering=a.iceGatheringState),d.debug(g),f.push(g),b=c};return a.addEventListener("iceconnectionstatechange",g,!1),a.addEventListener("signalingstatechange",g,!1),a.addEventListener("icegatheringstatechange",g,!1),{stop:function(){a.removeEventListener("iceconnectionstatechange",g,!1),a.removeEventListener("signalingstatechange",g,!1),a.removeEventListener("icegatheringstatechange",g,!1),c=!0;var h={type:"PeerConnectionWorkflow",success:c,startTime:e,finishTime:b,states:f};d.debug(h)}}};D=OTPlugin.isInstalled()?OTPlugin.RTCSessionDescription:a.mozRTCSessionDescription||a.RTCSessionDescription;var J=function(a){return function(b){b.candidate?a(d.Raptor.Actions.CANDIDATE,{candidate:b.candidate.candidate,sdpMid:b.candidate.sdpMid||"",sdpMLineIndex:b.candidate.sdpMLineIndex||0}):d.debug("IceCandidateForwarder: No more ICE candidates.")}};if(d.PeerConnection=function(a){var b,c,e,f,g,h=[],i=new E,j=d.getStatsAdpater(),k="new",l=[],m={};d.$.eventing(m),a.iceServers||(a.iceServers=[]);var n=function(a,b,c){l.length&&l[0](a,b,c)},o=function(c,e){if(b)return void c.call(null,null,b);if(h.push(c),!(h.length>1)){var f={optional:[{DtlsSrtpKeyAgreement:!0},{googIPv6:!1}]};d.debug('Creating peer connection config "'+JSON.stringify(a)+'".'),a.iceServers&&0!==a.iceServers.length||(d.error("No ice servers present"),d.analytics.logEvent({action:"Error",variation:"noIceServers"})),d.$.createPeerConnection(a,f,e,p)}},p=function(f,g){if(f)return F("Failed to create PeerConnection, exception: "+f.toString(),"NewPeerConnection"),void(h=[]);if(d.debug("OT attachEventsToPeerConnection"),b=g,e=I(b),c=new H(b),a.channels&&c.addMany(a.channels),b.addEventListener("icecandidate",J(n),!1),b.addEventListener("addstream",v,!1),b.addEventListener("removestream",w,!1),b.addEventListener("signalingstatechange",s,!1),void 0!==b.oniceconnectionstatechange){var i;b.addEventListener("iceconnectionstatechange",function(a){"failed"===a.target.iceConnectionState?(i&&clearTimeout(i),i=setTimeout(function(){"failed"===a.target.iceConnectionState&&F("The stream was unable to connect due to a network error. Make sure your connection isn't blocked by a firewall.","ICEWorkflow")},5e3)):"disconnected"===a.target.iceConnectionState&&d.analytics.logEvent({action:"attachEventsToPeerConnection",variation:"iceconnectionstatechange",payload:"disconnected"})},!1)}q(null)},q=function(){for(;h.length;)h.shift().call(null)},r=function(){i&&i.setPeerConnection(null),e&&e.stop(),K.stopCollecting(),null!==b&&(b.destroy&&b.destroy(),b=null,m.trigger("close"))},s=function(){var a=b.signalingState;if(a&&a!==k)switch(k=a,d.debug("PeerConnection.stateChange: "+k),k){case"closed":r()}},t=function(a){a.dataChannels=c.sampleQos(),m.trigger("qos",a)},u=function(){var a;if(b.getRemoteStreams)a=b.getRemoteStreams();else{if(!b.remoteStreams)throw new Error("Invalid Peer Connection object implements no method for retrieving remote streams");a=b.remoteStreams}return Array.prototype.slice.call(a)},v=function(a){m.trigger("streamAdded",a.stream)},w=function(a){m.trigger("streamRemoved",a.stream)},x=function(a,b,c){n(a,b,c)},y=function(a){var c=new D({type:"offer",sdp:a.content.sdp}),e=function(a){i.setPeerConnection(b),i.processPending(),x(d.Raptor.Actions.ANSWER,a),K.startCollecting(b)},f=function(a,b,c){F("PeerConnection.offerProcessor "+a+": "+b,c)};o(function(){C(b,c,e,f)})},z=function(a){return a.content.sdp?(g=new D({type:"answer",sdp:a.content.sdp}),b.setRemoteDescription(g,function(){d.debug("setRemoteDescription Success")},function(a){F("Error while setting RemoteDescription "+a,"SetRemoteDescription")}),i.setPeerConnection(b),i.processPending(),void K.startCollecting(b)):void d.error("PeerConnection.processMessage: Weird answer message, no SDP.")},A=function(c){if(d.debug("PeerConnection.processSubscribe: Sending offer to subscriber."),!b)throw new Error("PeerConnection broke!");o(function(){B(b,a.numberOfSimulcastStreams,function(a){f=a,x(d.Raptor.Actions.OFFER,f,c.uri)},function(a,b,c){F("PeerConnection.subscribeProcessor "+a+": "+b,c)})})},F=function(a,b){d.error(a),m.trigger("error",a,b)};m.addLocalStream=function(a){o(function(){b.addStream(a)},a)},m.getSenders=function(){return b.getSenders()},m.disconnect=function(){i=null,b&&b.signalingState&&"closed"!==b.signalingState.toLowerCase()&&(b.close(),"Firefox"===d.$.env.name&&d.$.callAsync(r)),m.off()},m.processMessage=function(a,b){switch(d.debug("PeerConnection.processMessage: Received "+a+" from "+b.fromAddress),d.debug(b),a){case"generateoffer":A(b);break;case"offer":y(b);break;case"answer":case"pranswer":z(b);break;case"candidate":i.process(b);break;default:d.debug("PeerConnection.processMessage: Received an unexpected message of type "+a+" from "+b.fromAddress+": "+JSON.stringify(b))}return m},m.setIceServers=function(b){b&&(a.iceServers=b)},m.registerMessageDelegate=function(a){return l.push(a)},m.unregisterMessageDelegate=function(a){var b=d.$.arrayIndexOf(l,a);return-1!==b&&l.splice(b,1),l.length},m.remoteStreams=function(){return b?u():[]},m.getStats=function(a){return b?void j(b,a):void a(new d.$.Error("Cannot call getStats before there is a connection.",1015))};var G=function L(a,b,e,f){var g,h=c.get(b,e);if(!h){if(a>0)return void setTimeout(d.$.bind(L,null,a-1,b,e,f),200);g=new d.$.Error("A channel with that label and options could not be found. Label:"+b+". Options: "+JSON.stringify(e))}f(g,h)};m.getDataChannel=function(a,c,e){return b?void G(100,a,c,e):void e(new d.$.Error("Cannot create a DataChannel before there is a connection."))};var K=new d.PeerConnection.QOS(t);return m},!function(){var a=function(a,b,c,d){var e=function(a){return a.stat("googFrameRateSent")?(c.videoSentBytes=Number(a.stat("bytesSent")),c.videoSentPackets=Number(a.stat("packetsSent")),c.videoSentPacketsLost=Number(a.stat("packetsLost")),c.videoRtt=Number(a.stat("googRtt")),c.videoFrameRate=Number(a.stat("googFrameRateInput")),c.videoWidth=Number(a.stat("googFrameWidthSent")),c.videoHeight=Number(a.stat("googFrameHeightSent")),c.videoFrameRateSent=Number(a.stat("googFrameRateSent")),c.videoWidthInput=Number(a.stat("googFrameWidthInput")),c.videoHeightInput=Number(a.stat("googFrameHeightInput")),c.videoCodec=a.stat("googCodecName")):a.stat("googFrameRateReceived")&&(c.videoRecvBytes=Number(a.stat("bytesReceived")),c.videoRecvPackets=Number(a.stat("packetsReceived")),c.videoRecvPacketsLost=Number(a.stat("packetsLost")),c.videoFrameRate=Number(a.stat("googFrameRateOutput")),c.videoFrameRateReceived=Number(a.stat("googFrameRateReceived")),c.videoFrameRateDecoded=Number(a.stat("googFrameRateDecoded")),c.videoWidth=Number(a.stat("googFrameWidthReceived")),c.videoHeight=Number(a.stat("googFrameHeightReceived")),c.videoCodec=a.stat("googCodecName")),null},f=function(a){a.stat("audioInputLevel")?(c.audioSentPackets=Number(a.stat("packetsSent")),c.audioSentPacketsLost=Number(a.stat("packetsLost")),c.audioSentBytes=Number(a.stat("bytesSent")),c.audioCodec=a.stat("googCodecName"),c.audioRtt=Number(a.stat("googRtt"))):a.stat("audioOutputLevel")&&(c.audioRecvPackets=Number(a.stat("packetsReceived")),c.audioRecvPacketsLost=Number(a.stat("packetsLost")),c.audioRecvBytes=Number(a.stat("bytesReceived")),c.audioCodec=a.stat("googCodecName"))},g=function(a){if(a.result)for(var b=a.result(),g=0;g<b.length;g++){var h=b[g];h.stat&&("true"===h.stat("googActiveConnection")&&(c.localCandidateType=h.stat("googLocalCandidateType"),c.remoteCandidateType=h.stat("googRemoteCandidateType"),c.transportType=h.stat("googTransportType")),f(h),e(h))}d(null,c)};a.getStats(g)},b=function(a,b,c,d){var e=function(a){d(a)},f=function(a){var d,e=b.audioBytesTransferred||0;a.audioInputLevel?(c.audioSentBytes=Number(a.bytesSent),c.audioSentPackets=Number(a.packetsSent),c.audioSentPacketsLost=Number(a.packetsLost),c.audioRtt=Number(a.googRtt),c.audioCodec=a.googCodecName):a.audioOutputLevel&&(c.audioBytesTransferred=Number(a.bytesReceived),c.audioCodec=a.googCodecName),c.audioBytesTransferred&&(d=c.audioBytesTransferred-e,c.avgAudioBitrate=Math.round(8*d/(c.period/1e3)))},g=function(a){var d,e=b.videoBytesTransferred||0;a.googFrameHeightSent?(c.videoSentBytes=Number(a.bytesSent),c.videoSentPackets=Number(a.packetsSent),c.videoSentPacketsLost=Number(a.packetsLost),c.videoRtt=Number(a.googRtt),c.videoCodec=a.googCodecName,c.videoWidth=Number(a.googFrameWidthSent),c.videoHeight=Number(a.googFrameHeightSent),c.videoFrameRateSent=Number(a.googFrameRateSent),c.videoWidthInput=Number(a.googFrameWidthInput),c.videoHeightInput=Number(a.googFrameHeightInput)):a.googFrameHeightReceived&&(c.videoRecvBytes=Number(a.bytesReceived),c.videoRecvPackets=Number(a.packetsReceived),c.videoRecvPacketsLost=Number(a.packetsLost),c.videoRtt=Number(a.googRtt),c.videoCodec=a.googCodecName,c.videoFrameRateReceived=Number(a.googFrameRateReceived),c.videoFrameRateDecoded=Number(a.googFrameRateDecoded),c.videoWidth=Number(a.googFrameWidthReceived),c.videoHeight=Number(a.googFrameHeightReceived)),c.videoBytesTransferred&&(d=c.videoBytesTransferred-e,c.avgVideoBitrate=Math.round(8*d/(c.period/1e3))),a.googFrameRateInput?c.videoFrameRate=Number(a.googFrameRateInput):a.googFrameRateOutput&&(c.videoFrameRate=Number(a.googFrameRateOutput))},h=function(a){return void 0!==a.googFrameHeightSent||void 0!==a.googFrameHeightReceived||void 0!==c.videoBytesTransferred||void 0!==a.googFrameRateSent},i=function(a){return"true"===a.googActiveConnection};a.getStats(null,function(a){a.forEach(function(a){i(a)?(c.localCandidateType=a.googLocalCandidateType,c.remoteCandidateType=a.googRemoteCandidateType,c.transportType=a.googTransportType):h(a)?g(a):f(a)}),d(null,c)},e)},c=function(a,b,c,d){var e=function(a){d(a)},f=function(a){"outboundrtp"===a.type?(c.audioSentPackets=a.packetsSent,c.audioSentPacketsLost=a.packetsLost,c.audioSentBytes=a.bytesSent):"inboundrtp"===a.type&&(c.audioRecvPackets=a.packetsReceived,c.audioRecvPacketsLost=a.packetsLost,c.audioRecvBytes=a.bytesReceived)},g=function(a){"outboundrtp"===a.type?(c.videoSentPackets=a.packetsSent,c.videoSentPacketsLost=a.packetsLost,c.videoSentBytes=a.bytesSent):"inboundrtp"===a.type&&(c.videoRecvPackets=a.packetsReceived,c.videoRecvPacketsLost=a.packetsLost,c.videoRecvBytes=a.bytesReceived)};a.getStats(null,function(a){for(var b in a)if(a.hasOwnProperty(b)&&("outboundrtp"===a[b].type||"inboundrtp"===a[b].type)){var e=a[b];-1!==e.id.indexOf("rtp")&&(-1!==e.id.indexOf("audio")?f(e):-1!==e.id.indexOf("video")&&g(e))}d(null,c)},e)},e=function(f,g,h,i){return OTPlugin.isInstalled()?(e=b,b(f,g,h,i)):"Firefox"===d.$.env.name&&d.$.env.version>=27?(e=c,c(f,g,h,i)):(e=a,a(f,g,h,i))};d.PeerConnection.QOS=function(a){var b,c=d.$.now(),f=d.$.bind(function g(f,h){if(b){var i=d.$.now(),j={timeStamp:i,duration:Math.round(i-c),period:Math.round(i-f.timeStamp)},k=function(b,c){if(b)return void d.error("Failed to Parse QOS Stats: "+JSON.stringify(b));a(c,f);var e=h===d.PeerConnection.QOS.INITIAL_INTERVAL?d.PeerConnection.QOS.INTERVAL-d.PeerConnection.QOS.INITIAL_INTERVAL:d.PeerConnection.QOS.INTERVAL;setTimeout(d.$.bind(g,null,c,e),h)};e(b,f,j,k)}},this);this.startCollecting=function(a){a&&a.getStats&&(b=a,f({timeStamp:d.$.now()},d.PeerConnection.QOS.INITIAL_INTERVAL))},this.stopCollecting=function(){b=null}},d.PeerConnection.QOS.INITIAL_INTERVAL=1e3,d.PeerConnection.QOS.INTERVAL=3e4}(),d.PeerConnections=function(){var a={};return{add:function(b,c,e){var f=b.id+"_"+c,g=a[f];return g||(g=a[f]={count:0,pc:new d.PeerConnection(e)}),g.count+=1,g.pc},remove:function(b,c){var d=b.id+"_"+c,e=a[d];e&&(e.count-=1,0===e.count&&(e.pc.disconnect(),delete a[d]))}}}(),d.SubscriberPeerConnection=function(a,c,e,f,g){var h,i,j,k,l,m,n,o,p=this,q=!1,r=!1;i=function(){this.destroy(),this.trigger("disconnected",this)},j=function(a){this.trigger("remoteStreamAdded",a,this)},k=function(a){this.trigger("remoteStreamRemoved",a,this)},l=function(a,b){this.trigger("error",null,a,this,b)},m=d.$.bind(function(a,b){if(!r){var g=a===d.Raptor.Actions.CANDIDATE||a===d.Raptor.Actions.OFFER||a===d.Raptor.Actions.ANSWER||a===d.Raptor.Actions.PRANSWER;if(g){var h=a===d.Raptor.Actions.CANDIDATE?b.candidate:b.sdp;r=-1!==h.indexOf("typ relay")}}switch(a){case d.Raptor.Actions.ANSWER:case d.Raptor.Actions.PRANSWER:this.trigger("connected"),c._.jsepAnswerP2p(e.id,f.widgetId,b.sdp);break;case d.Raptor.Actions.OFFER:c._.jsepOfferP2p(e.id,f.widgetId,b.sdp);break;case d.Raptor.Actions.CANDIDATE:c._.jsepCandidateP2p(e.id,f.widgetId,b)}},this),n=function(a){var b="get"+(a?"Video":"Audio")+"Tracks";return function(a){if(h){var c,d,e=h.remoteStreams();if(0!==e.length&&e[0][b])for(var f=0,g=e.length;g>f;++f){d=e[f],c=d[b]();for(var i=0,j=c.length;j>i;++i)c[i].enabled!==a&&c[i].setEnabled(a)}}}},o=d.$.bind(function(a,b){this.trigger("qos",a,b)},this),d.$.eventing(this),this.destroy=function(){if(!q){if(q=!0,h){var b=h.unregisterMessageDelegate(m);0===b&&(c&&c.isConnected()&&e&&!e.destroyed&&c._.subscriberDestroy(e,f),this.subscribeToAudio(!1)),d.PeerConnections.remove(a,e.id)}h=null,this.off()}},this.getDataChannel=function(a,b,c){h.getDataChannel(a,b,c)},this.processMessage=function(a,b){h.processMessage(a,b)},this.getStats=function(a){h?h.getStats(a):a(new d.$.Error("Subscriber is not connected cannot getStats",1015))},this.subscribeToAudio=n(!1),this.subscribeToVideo=n(!0),this.hasRelayCandidates=function(){return r},this.init=function(n){var q={};b(q,function(b,q){if(b)return void n(b);h=d.PeerConnections.add(a,e.streamId,q),h.on({close:i,streamAdded:j,streamRemoved:k,error:l,qos:o},p);var r=h.registerMessageDelegate(m);if(h.remoteStreams().length>0)d.$.forEach(h.remoteStreams(),j,p);else if(1===r){var s;if(g.subscribeToVideo||g.subscribeToAudio){var t=e.getChannelsOfType("audio"),u=e.getChannelsOfType("video");s=d.$.map(t,function(a){return{id:a.id,type:a.type,active:g.subscribeToAudio}}).concat(d.$.map(u,function(a){var b={id:a.id,type:a.type,active:g.subscribeToVideo,restrictFrameRate:void 0!==g.restrictFrameRate?g.restrictFrameRate:!1};return void 0!==g.maxFrameRate&&(b.maxFrameRate=parseFloat(g.maxFrameRate)),void 0!==g.maxHeight&&(b.maxHeight=parseInt(g.maxHeight,10)),void 0!==g.maxWidth&&(b.maxWidth=parseInt(g.maxWidth,10)),b}))}c._.subscriberCreate(e,f,s,function(a,b){a&&p.trigger("error",a.message,p,"Subscribe"),h&&h.setIceServers(d.Raptor.parseIceServers(b))}),n(void 0,p)}})}},d.PublisherPeerConnection=function(a,c,e,f,g,h){var i,j,k,l,m,n=this,o=!1,p=c._.subscriberMap[a.id+"_"+e];j=function(){this.destroy(),this.trigger("disconnected",this)},k=function(a,b){this.trigger("error",null,a,this,b),this.destroy()},l=d.$.bind(function(a,b,f){if(!o){var g=a===d.Raptor.Actions.CANDIDATE||a===d.Raptor.Actions.OFFER||a===d.Raptor.Actions.ANSWER||a===d.Raptor.Actions.PRANSWER;if(g){var h=a===d.Raptor.Actions.CANDIDATE?b.candidate:b.sdp;o=-1!==h.indexOf("typ relay")}}switch(a){case d.Raptor.Actions.ANSWER:case d.Raptor.Actions.PRANSWER:c.sessionInfo.p2pEnabled?c._.jsepAnswerP2p(e,p,b.sdp):c._.jsepAnswer(e,b.sdp);break;case d.Raptor.Actions.OFFER:this.trigger("connected"),c._.jsepOffer(f,b.sdp);break;case d.Raptor.Actions.CANDIDATE:c.sessionInfo.p2pEnabled?c._.jsepCandidateP2p(e,p,b):c._.jsepCandidate(e,b)}},this),m=d.$.bind(function(b,c){this.trigger("qos",a,b,c)},this),d.$.eventing(this),this.getDataChannel=function(a,b,c){i.getDataChannel(a,b,c)},this.destroy=function(){i&&(i.off(),d.PeerConnections.remove(a,e)),i=null},this.processMessage=function(a,b){i.processMessage(a,b)},this.init=function(c,p){var q={iceServers:c,channels:g,numberOfSimulcastStreams:h};b(q,function(b,c){return b?void p(b):(i=d.PeerConnections.add(a,e,c),i.on({close:j,error:k,qos:m},n),i.registerMessageDelegate(l),i.addLocalStream(f),void p(void 0,n))}),this.remoteConnection=function(){return a},this.hasRelayCandidates=function(){return o}},this.getSenders=function(){return i.getSenders()}},function(a){function b(a,b){var c=document.createElement("video");if(c.setAttribute("autoplay",""),c.innerHTML=a,b){b.muted===!0&&(delete b.muted,c.muted="true");for(var d in b)b.hasOwnProperty(d)&&c.setAttribute(d,b[d])}return c}function e(a){return n[parseInt(a,10)]||"An unknown error occurred."}function f(b,c,f){var h,i="Chrome"===d.$.env.name?1:0,j=c.getVideoTracks().length>i?"timeupdate":"loadedmetadata",k=function(){clearTimeout(h),b.removeEventListener(j,l,!1),b.removeEventListener("error",m,!1),c.onended=null,b.onended=null},l=function(){k(),f(null)},m=function(a){k(),g(b),f("There was an unexpected problem with the Video Stream: "+e(a.target.error.code))},n=function(){k(),g(b),f("Stream ended while trying to bind it to a video element.")};void 0!==b.srcObject?b.srcObject=c:void 0!==b.mozSrcObject?b.mozSrcObject=c:b.src=a.URL.createObjectURL(c),b.addEventListener(j,l,!1),b.addEventListener("error",m,!1),c.onended=n,b.onended=n}function g(b){b.onended=null,void 0!==b.srcObject?b.srcObject=null:void 0!==b.mozSrcObject?b.mozSrcObject=null:a.URL.revokeObjectURL(b.src)}var h={0:"rotate(0deg)",270:"rotate(90deg)",90:"rotate(-90deg)",180:"rotate(180deg)"};d.VideoOrientation={ROTATED_NORMAL:0,ROTATED_LEFT:270,ROTATED_RIGHT:90,ROTATED_UPSIDE_DOWN:180};var i=50,j=2*Math.PI/360;d.VideoElement=function(a){var b,c,e=d.$.defaults(a&&!d.$.isFunction(a)?a:{},{fallbackText:"Sorry, Web RTC is not available in your browser"}),f=d.$.isFunction(arguments[arguments.length-1])?arguments[arguments.length-1]:void 0,g=d.$.bind(function(a){this.trigger("orientationChanged",a)},this),h=OTPlugin.isInstalled()?new k(e,f,g):new l(e,f,g),i=!1;d.$.eventing(this),h.on("videoDimensionsChanged",d.$.bind(function(a,b){this.trigger("videoDimensionsChanged",a,b);
},this)),h.on("mediaStopped",d.$.bind(function(){this.trigger("mediaStopped")},this)),d.$.defineProperties(this,{domElement:{get:function(){return h.domElement()}},videoWidth:{get:function(){return h["video"+(this.isRotated()?"Height":"Width")]()}},videoHeight:{get:function(){return h["video"+(this.isRotated()?"Width":"Height")]()}},aspectRatio:{get:function(){return(this.videoWidth()+0)/this.videoHeight()}},isRotated:{get:function(){return h.isRotated()}},orientation:{get:function(){return h.orientation()},set:function(a){h.orientation(a)}},audioChannelType:{get:function(){return h.audioChannelType()},set:function(a){h.audioChannelType(a)}}}),this.imgData=function(){return h.imgData()},this.appendTo=function(a){return h.appendTo(a),this},this.bindToStream=function(a,e){return i=!1,b=a,h.bindToStream(a,d.$.bind(function(a){return a?void e(a):(i=!0,"undefined"!=typeof c&&(this.setAudioVolume(c),c=void 0),h.on("aspectRatioAvailable",d.$.bind(this.trigger,this,"aspectRatioAvailable")),void e(null))},this)),this},this.unbindStream=function(){return b?(b.onended=null,b=null,h.unbindStream(),this):this},this.setAudioVolume=function(a){return i?h.setAudioVolume(d.$.roundFloat(a/100,2)):c=parseFloat(a),this},this.getAudioVolume=function(){return i?parseInt(100*h.getAudioVolume(),10):"undefined"!=typeof c?c:50},this.whenTimeIncrements=function(a,b){return h.whenTimeIncrements(a,b),this},this.onRatioAvailable=function(a){return h.onRatioAvailable(a),this},this.destroy=function(){return this.off(),void h.destroy()}};var k=function(a,b,c){var e,f,g=!1,h=[];d.$.eventing(this),m(this,function(){return e.domElement},c),this.domElement=function(){return e?e.domElement:void 0},this.videoWidth=function(){return e?e.videoWidth():void 0},this.videoHeight=function(){return e?e.videoHeight():void 0},this.imgData=function(){return e?e.getImgData():null},this.appendTo=function(a){return f=a,this},this.bindToStream=function(a,b){return f?(e=a._.render(),e.appendTo(f),e.show(function(a){if(!a){g=!0;for(var c;c=h.shift();)c()}b(a)}),this):void b("The VideoElement must attached to a DOM node before a stream can be bound")},this.unbindStream=function(){return e&&(e.destroy(),f=null,e=null),this},this.setAudioVolume=function(a){e&&e.volume(a)},this.getAudioVolume=function(){return e?e.volume():i},this.audioChannelType=function(){return"unknown"},this.whenTimeIncrements=function(a,b){d.$.callAsync(d.$.bind(a,b))},this.onRatioAvailable=function(a){g?a():h.push(a)},this.destroy=function(){return void this.unbindStream()}},l=function(a,h,j){var k,l=!1;d.$.eventing(this);var n=d.$.bind(function(a){var b="There was an unexpected problem with the Video Stream: "+e(a.target.error.code);h(b,this,"VideoElement")},this),o=function(){l||(d.warn("Video element paused, auto-resuming. If you intended to do this, use publishVideo(false) or subscribeToVideo(false) instead."),l=!0),k.play()};k=b(a.fallbackText,a.attributes);var p=!1,q=[];k.addEventListener("timeupdate",function r(){if(!k)return void event.target.removeEventListener("timeupdate",r);var a=k.videoWidth/k.videoHeight;if(!isNaN(a)){k.removeEventListener("timeupdate",r),p=!0;for(var b;b=q.shift();)b()}}),k.addEventListener("pause",o),c(this,k),m(this,function(){return k},j),this.domElement=function(){return k},this.videoWidth=function(){return k?k.videoWidth:0},this.videoHeight=function(){return k?k.videoHeight:0},this.imgData=function(){var a=d.$.createElement("canvas",{width:k.videoWidth,height:k.videoHeight,style:{display:"none"}});document.body.appendChild(a);try{a.getContext("2d").drawImage(k,0,0,a.width,a.height)}catch(b){return d.warn("Cannot get image data yet"),null}var c=a.toDataURL("image/png");return d.$.removeElement(a),d.$.trim(c.replace("data:image/png;base64,",""))},this.appendTo=function(a){return a.appendChild(k),this},this.bindToStream=function(a,b){var c=this;return f(k,a,function(d){function e(){a.onended=null,k&&(k.onended=null),c.trigger("mediaStopped",this)}return d?void b(d):k?(c.startObservingSize(),a.onended=e,k.onended=e,k.addEventListener("error",n,!1),void b(null)):void b("Can't bind because _domElement no longer exists")}),this},this.unbindStream=function(){return k&&g(k),this.stopObservingSize(),this},this.setAudioVolume=function(a){k&&(k.volume=a)},this.getAudioVolume=function(){return k?k.volume:i},this.audioChannelType=function(a){return void 0!==a&&(k.mozAudioChannelType=a),"mozAudioChannelType"in k?k.mozAudioChannelType:"unknown"},this.whenTimeIncrements=function(a,b){if(k){var c,e;e=d.$.bind(function(){k&&(!c||c>=k.currentTime?c=k.currentTime:(k.removeEventListener("timeupdate",e,!1),a.call(b,this)))},this),k.addEventListener("timeupdate",e,!1)}},this.destroy=function(){return this.unbindStream(),void(k&&(k.removeEventListener("pause",o),d.$.removeElement(k),k=null))},this.onRatioAvailable=function(a){p?a():q.push(a)}},m=function(a,b,c,e){var f=e;d.$.defineProperties(a,{isRotated:{get:function(){return this.orientation()&&(270===this.orientation().videoOrientation||90===this.orientation().videoOrientation)}},orientation:{get:function(){return f},set:function(a){f=a;var e=h[a.videoOrientation]||h.ROTATED_NORMAL;switch(d.$.env.name){case"Chrome":case"Safari":b().style.webkitTransform=e;break;case"IE":if(d.$.env.version>=9)b().style.msTransform=e;else{var g=a.videoOrientation*j,i=b(),k=Math.cos(g),l=Math.sin(g);i.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+k+",M12="+-l+",M21="+l+",M22="+k+",SizingMethod='auto expand')"}break;default:b().style.transform=e}c(f)}},audioChannelType:{get:function(){return"mozAudioChannelType"in this.domElement?this.domElement.mozAudioChannelType:"unknown"},set:function(a){"mozAudioChannelType"in this.domElement&&(this.domElement.mozAudioChannelType=a)}}})},n={};a.MediaError&&(n[a.MediaError.MEDIA_ERR_ABORTED]="The fetching process for the media resource was aborted by the user agent at the user's request.",n[a.MediaError.MEDIA_ERR_NETWORK]="A network error of some description caused the user agent to stop fetching the media resource, after the resource was established to be usable.",n[a.MediaError.MEDIA_ERR_DECODE]="An error of some description occurred while decoding the media resource, after the resource was established to be  usable.",n[a.MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED]="The media resource indicated by the src attribute was not suitable.")}(a),!function(){function a(a,b,c,f,g){var h=d.$(".OT_video-element",a);if(h.length>0){var i={left:"",top:""};if(OTPlugin.isInstalled())i.width="100%",i.height="100%";else{f=f||e,f=g?1/f:f;var j,k,l=b/c;g?(k=b,j=k*f,i.width=j+"px",i.height=k+"px",i.top=(j+c)/2+"px"):l>f?(j=b,k=j/f,i.width=j+"px",i.height=k+"px",i.top=(-k+c)/2+"px"):(k=c,j=k*f,i.width=j+"px",i.height=k+"px",i.left=(-j+b)/2+"px")}h.css(i)}}function b(a,b,c,f,g){var h=d.$(".OT_video-element",a);if(h.length>0){var i={left:"",top:""};if(OTPlugin.isInstalled()){f=f||e;var j,k,l=b/c;l>f?(k=c,j=c*f,i.width=j+"px",i.height=k+"px",i.left=(b-j)/2+"px"):(j=b,k=j/f,i.width=j+"px",i.height=k+"px",i.top=(c-k)/2+"px")}else g?(i.width=c+"px",i.height=b+"px",i.top=c+"px"):(i.width="100%",i.height="100%");h.css(i)}}function c(a,b,c){var e=parseInt(b,10),j=parseInt(c,10);h>e||i>j?d.$.addClass(a,"OT_micro"):d.$.removeClass(a,"OT_micro"),f>e||g>j?d.$.addClass(a,"OT_mini"):d.$.removeClass(a,"OT_mini")}var e=4/3,f=128,g=128,h=64,i=64,j=function(a,b){var c,e;if(a&&a.nodeName?(c=a,c.getAttribute("id")&&0!==c.getAttribute("id").length||c.setAttribute("id","OT_"+d.$.uuid()),e=c.getAttribute("id")):a&&(c=d.$("#"+a).get(0),c&&(e=a)),e||(e="OT_"+d.$.uuid().replace(/-/g,"_")),c)if(null!=b&&"replace"!==b){var f=document.createElement("div");f.id="OT_"+d.$.uuid(),"append"===b?(c.appendChild(f),c=f):"before"===b?(c.parentNode.insertBefore(f,c),c=f):"after"===b&&(c.parentNode.insertBefore(f,c.nextSibling),c=f)}else d.$.emptyElement(c);else c=d.$.createElement("div",{id:e}),c.style.backgroundColor="#000000",document.body.appendChild(c);return c};d.WidgetView=function(e,f){var g,h,i,k,l,m,n,o={},p=j(e,f&&f.insertMode),q=document.createElement("div"),r={},s=!0,t=!1,u="cover",v=a;d.$.eventing(o),f&&(m=f.width,n=f.height,m&&"number"==typeof m&&(m+="px"),n&&"number"==typeof n&&(n+="px"),p.style.width=m?m:"264px",p.style.height=n?n:"198px",p.style.overflow="hidden",c(p,m||"264px",n||"198px"),(void 0===f.mirror||f.mirror)&&d.$.addClass(p,"OT_mirrored"),"contain"===f.fitMode?(u="contain",v=b):"cover"!==f.fitMode&&d.warn('Invalid fit value "'+f.fitMode+'" passed. Only "contain" and "cover" can be used.')),f.classNames&&d.$.addClass(p,f.classNames),d.$(p).addClass("OT_loading OT_fit-mode-"+u),d.$.addClass(q,"OT_widget-container"),q.style.width="100%",q.style.height="100%",p.appendChild(q),l=document.createElement("div"),d.$.addClass(l,"OT_video-loading"),q.appendChild(l),k=document.createElement("div"),d.$.addClass(k,"OT_video-poster"),q.appendChild(k),r.width=p.offsetWidth,r.height=p.offsetHeight,OTPlugin.isInstalled()||(g=d.$(p).observeSize(function(a){var b=a.width,d=a.height;c(p,b,d),h&&v(q,b,d,h.aspectRatio(),h.isRotated())})[0],i=d.$.observeNodeOrChildNodeRemoval(p,function(a){if(h){var b=d.$.some(a,function(a){return a===q||"VIDEO"===a.nodeName});b&&(h.destroy(),h=null),q&&(d.$.removeElement(q),q=null),g&&(g.disconnect(),g=null),i&&(i.disconnect(),i=null)}}));var w=function(){h&&v(q,p.offsetWidth,p.offsetHeight,h.aspectRatio(),h.isRotated())};return o.destroy=function(){g&&(g.disconnect(),g=null),i&&(i.disconnect(),i=null),h&&(h.destroy(),h=null),p&&(d.$.removeElement(p),p=null)},o.setBackgroundImageURI=function(a){"http:"!==a.substr(0,5)&&"https:"!==a.substr(0,6)&&"data:image/png;base64,"!==a.substr(0,22)&&(a="data:image/png;base64,"+a),d.$.css(k,"backgroundImage","url("+a+")"),d.$.css(k,"backgroundSize","contain"),d.$.css(k,"opacity","1.0")},f&&f.style&&f.style.backgroundImageURI&&o.setBackgroundImageURI(f.style.backgroundImageURI),o.bindVideo=function(a,b,c){"undefined"!=typeof b.audioVolume&&(b.audioVolume=parseFloat(b.audioVolume)),h&&(h.destroy(),h=null);var e=b&&b.error?b.error:void 0;delete b.error;var f=new d.VideoElement({attributes:b},e);return"undefined"!=typeof b.audioVolume&&f.setAudioVolume(b.audioVolume),f.audioChannelType("telephony"),f.appendTo(q).bindToStream(a,function(a){return a?(f.destroy(),void c(a)):(h=f,f.domElement()&&d.$.css(f.domElement(),"height",""),f.on({orientationChanged:w,videoDimensionsChanged:function(a,b){w(),o.trigger("videoDimensionsChanged",a,b)},mediaStopped:function(){o.trigger("mediaStopped")}}),f.onRatioAvailable(w),void c(null,f))}),d.$.addClass(f.domElement(),"OT_video-element"),d.$.css(f.domElement(),"height","1px"),f},d.$.defineProperties(o,{video:{get:function(){return h}},showPoster:{get:function(){return!d.$.isDisplayNone(k)},set:function(a){a?d.$.show(k):d.$.hide(k)}},poster:{get:function(){return d.$.css(k,"backgroundImage")},set:function(a){d.$.css(k,"backgroundImage","url("+a+")")}},loading:{get:function(){return s},set:function(a){s=a,s?d.$.addClass(p,"OT_loading"):d.$.removeClass(p,"OT_loading")}},audioOnly:{get:function(){return t},set:function(a){t=a,t?d.$.addClass(p,"OT_audio-only"):d.$.removeClass(p,"OT_audio-only"),OTPlugin.isInstalled()&&setTimeout(w,0)}},domId:{get:function(){return p.getAttribute("id")}}}),o.domElement=p,o.addError=function(a,b,c){p.innerHTML="<p>"+a+(b?' <span class="ot-help-message">'+b+"</span>":"")+"</p>",d.$.addClass(p,c||"OT_subscriber_error"),p.querySelector("p").offsetHeight>p.offsetHeight&&(p.querySelector("span").style.display="none")},o}}(a),!d.properties)throw new Error("OT.properties does not exist, please ensure that you include a valid properties file.");d.properties=function(b){var c=d.$.clone(b);c.debug="true"===b.debug||b.debug===!0,c.supportSSL="true"===b.supportSSL||b.supportSSL===!0,a.OTProperties&&(a.OTProperties.cdnURL&&(c.cdnURL=a.OTProperties.cdnURL),a.OTProperties.cdnURLSSL&&(c.cdnURLSSL=a.OTProperties.cdnURLSSL),a.OTProperties.configURL&&(c.configURL=a.OTProperties.configURL),a.OTProperties.assetURL&&(c.assetURL=a.OTProperties.assetURL),a.OTProperties.cssURL&&(c.cssURL=a.OTProperties.cssURL)),c.assetURL||(d.properties.supportSSL?c.assetURL=c.cdnURLSSL+"/webrtc/"+c.version:c.assetURL=c.cdnURL+"/webrtc/"+c.version);var e="IE"===d.$.env.name&&d.$.env.version<=9;return e&&a.location.protocol.indexOf("https")<0||(c.apiURL=c.apiURLSSL,c.loggingURL=c.loggingURLSSL),c.configURL||(c.configURL=c.assetURL+"/js/dynamic_config.min.js"),c.cssURL||(c.cssURL=c.assetURL+"/css/TB.min.css"),c}(d.properties),!function(){var a,b,c=function(a){return!(d.$.isFunction(a.get)&&d.$.isFunction(a.set))},e=function(c){return b?void c(null,b):void a.get(c)};d.overrideGuidStorage=function(e){if(c(e))throw new Error("The storageInterface argument does not seem to be valid, it must implement get and set methods");a!==e&&(a=e,b&&a.set(b,function(a){a&&d.error("Failed to send initial Guid value ("+b+") to the newly assigned Guid Storage. The error was: "+a)}))},d._||(d._={}),d._.getClientGuid=function(c){e(function(e,f){return e?void c(e):(f?b||(b=f):(f=d.$.uuid(),a.set(f,function(a){return a?void c(a):void(b=f)})),void c(null,b))})},d.overrideGuidStorage({get:function(a){a(null,d.$.getCookie("opentok_client_id"))},set:function(a,b){d.$.setCookie("opentok_client_id",a),b(null)}})}(a),!function(){var a,b,c,e,f,g;a=function(){return navigator.getUserMedia?d.$.bind(navigator.getUserMedia,navigator):navigator.mozGetUserMedia?d.$.bind(navigator.mozGetUserMedia,navigator):navigator.webkitGetUserMedia?d.$.bind(navigator.webkitGetUserMedia,navigator):OTPlugin.isInstalled()?d.$.bind(OTPlugin.getUserMedia,OTPlugin):void 0}(),b={PERMISSION_DENIED:"PermissionDeniedError",NOT_SUPPORTED_ERROR:"NotSupportedError",MANDATORY_UNSATISFIED_ERROR:" ConstraintNotSatisfiedError",NO_DEVICES_FOUND:"NoDevicesFoundError",HARDWARE_UNAVAILABLE:"HardwareUnavailableError",TrackStartError:"HardwareUnavailableError"},c={PermissionDeniedError:"End-user denied permission to hardware devices",PermissionDismissedError:"End-user dismissed permission to hardware devices",NotSupportedError:"A constraint specified is not supported by the browser.",ConstraintNotSatisfiedError:"It's not possible to satisfy one or more constraints passed into the getUserMedia function",OverconstrainedError:"Due to changes in the environment, one or more mandatory constraints can no longer be satisfied.",NoDevicesFoundError:"No voice or video input devices are available on this machine.",HardwareUnavailableError:"The selected voice or video devices are unavailable. Verify that the chosen devices are not in use by another application."},e=function(a,b){var d,e;return d=b.hasOwnProperty(a)?b[a]:a,e=c.hasOwnProperty(d)?c[d]:"Unknown Error while getting user media",{name:d,message:e}},f=function(a){var c;return d.$.isObject(a)&&a.name?(c=e(a.name,b),c.constraintName=a.constraintName):c="string"==typeof a?e(a,b):{message:"Unknown Error type while getting media"},c},g=function(a){if(!a||!d.$.isObject(a))return!0;for(var b in a)if(a.hasOwnProperty(b)&&a[b])return!1;return!0},d.$.getUserMedia=function(b,c,e,h,i,j,k){var l=a;if(d.$.isFunction(k)&&(l=k),g(b))return d.error("Couldn't get UserMedia: All constraints were false"),void e.call(null,{name:"NO_VALID_CONSTRAINTS",message:"Video and Audio was disabled, you need to enabled at least one"});var m=null,n=!1,o=function(){m&&clearTimeout(m),n&&i&&i()},p=function(){m=null,n=!0,h&&h()},q=function(a){o(),c.call(null,a)},r=function(a){o();var b=f(a);"PermissionDeniedError"===b.name||"PermissionDismissedError"===b.name?j.call(null,b):e.call(null,b)};try{l(b,q,r)}catch(s){return d.error("Couldn't get UserMedia: "+s.toString()),void r()}m=-1===location.protocol.indexOf("https")?setTimeout(p,100):setTimeout(p,500)}}(),!function(){var a=function(a){return function(b,c){c.querySelector("html").style.height=c.body.style.height="100%",a(b,c)}},b=function(a,b,c){var e=a.head||a.getElementsByTagName("head")[0],f=d.$.createElement("link",{type:"text/css",media:"screen",rel:"stylesheet",href:b});e.appendChild(f),d.$.on(f,"error",function(a){d.error("Could not load CSS for dialog",b,a&&a.message||a)}),d.$.on(f,"load",c)},c=function(a,c,e){var f=["//fonts.googleapis.com/css?family=Didact+Gothic",d.properties.cssURL].concat(c),g=f.length;d.$.forEach(f,function(c){b(a,c,function(){--g<=0&&e()})})},e=function(a,b,c){var e=d.$.createElement(c||"div",{"class":a},b,this);return e.on=d.$.bind(d.$.on,d.$,e),e.off=d.$.bind(d.$.off,d.$,e),e},f=function(a,b,c){var f=e.call(this,"",null,"input");return f=d.$(f).on("change",c),"IE"===d.$.env.name&&d.$.env.version<=8&&f.on("click",function(){f.first.blur(),f.first.focus()}),f.attr({name:b,id:b,type:"checkbox"}),f.first},g=function(a,b,c){var d=e.call(this,c||"",a,"a");return d.setAttribute("href",b),d};d.Dialogs={},d.Dialogs.Plugin={},d.Dialogs.Plugin.promptToInstall=function(){var b=new d.$.Modal(a(function(a,h){function i(){b.trigger("download"),setTimeout(function(){q.querySelector(".OT_dialog-messages-main").innerHTML="Plugin installation successful";var a=q.querySelectorAll(".OT_dialog-section");d.$.addClass(a[0],"OT_dialog-hidden"),d.$.removeClass(a[1],"OT_dialog-hidden")},3e3)}function j(){b.trigger("refresh")}function k(){o.checked?l():m()}function l(){t.enable(),t.on("click",i),v.enable(),v.on("click",j)}function m(){t.disable(),t.off("click",i),v.disable(),v.off("click",j)}var n,o,p,q,r=d.$.bind(e,h),s=function(a,b){var c="OT_dialog-button "+(b?"OT_dialog-button-"+b:"OT_dialog-button-large"),e=r(c,a);return e.enable=function(){return d.$.removeClass(this,"OT_dialog-button-disabled"),this},e.disable=function(){return d.$.addClass(this,"OT_dialog-button-disabled"),this},e},t=s("Download plugin"),u=s("cancel","small"),v=s("Refresh browser");d.$.addClass(u,"OT_dialog-no-natural-margin OT_dialog-button-block"),d.$.addClass(v,"OT_dialog-no-natural-margin"),t.disable(),v.disable(),u.on("click",function(){b.trigger("cancelButtonClicked"),b.close()}),p=r("OT_closeButton","&times;").on("click",function(){b.trigger("closeButtonClicked"),b.close()}).first;var w=a.location.protocol.indexOf("https")>=0?"https":"http";n=g.call(h,"end-user license agreement",w+"://tokbox.com/support/ie-eula"),o=f.call(h,null,"acceptEULA",k),q=r("OT_dialog-centering",[r("OT_dialog-centering-child",[r("OT_root OT_dialog OT_dialog-plugin-prompt",[p,r("OT_dialog-messages",[r("OT_dialog-messages-main","This app requires real-time communication")]),r("OT_dialog-section",[r("OT_dialog-single-button-with-title",[r("OT_dialog-button-title",[o,function(){var a=r("","accept","label");return a.setAttribute("for",o.id),a.style.margin="0 5px",a}(),n]),r("OT_dialog-actions-card",[t,u])])]),r("OT_dialog-section OT_dialog-hidden",[r("OT_dialog-button-title",["You can now enjoy webRTC enabled video via Internet Explorer."]),v])])])]),c(h,[],function(){h.body.appendChild(q)})}));return b},d.Dialogs.Plugin.promptToReinstall=function(){var b=new d.$.Modal(a(function(a,f){var g,h,i,j=d.$.bind(e,f);g=j("OT_closeButton","&times;").on("click",function(){b.trigger("closeButtonClicked"),b.close()}).first,h=j("OT_dialog-button OT_dialog-button-large OT_dialog-no-natural-margin","Okay").on("click",function(){b.trigger("okay")}).first,i=j("OT_dialog-centering",[j("OT_dialog-centering-child",[j("OT_ROOT OT_dialog OT_dialog-plugin-reinstall",[g,j("OT_dialog-messages",[j("OT_dialog-messages-main","Reinstall Opentok Plugin"),j("OT_dialog-messages-minor","Uh oh! Try reinstalling the OpenTok plugin again to enable real-time video communication for Internet Explorer.")]),j("OT_dialog-section",[j("OT_dialog-single-button",h)])])])]),c(f,[],function(){f.body.appendChild(i)})}));return b},d.Dialogs.Plugin.updateInProgress=function(){var b,f,g=0,h=new d.$.Modal(a(function(a,i){var j,k=d.$.bind(e,i);f=k("OT_dialog-plugin-upgrade-percentage","0%","strong"),b=k("OT_dialog-progress-bar-fill"),j=k("OT_dialog-centering",[k("OT_dialog-centering-child",[k("OT_ROOT OT_dialog OT_dialog-plugin-upgrading",[k("OT_dialog-messages",[k("OT_dialog-messages-main",["One moment please... ",f]),k("OT_dialog-progress-bar",b),k("OT_dialog-messages-minor OT_dialog-no-natural-margin","Please wait while the OpenTok plugin is updated")])])])]),c(i,[],function(){i.body.appendChild(j),null!=g&&h.setUpdateProgress(g)})}));return h.setUpdateProgress=function(a){b&&f?a>99?(d.$.css(b,"width",""),f.innerHTML="100%"):1>a?(d.$.css(b,"width","0%"),f.innerHTML="0%"):(d.$.css(b,"width",a+"%"),f.innerHTML=a+"%"):g=a},h},d.Dialogs.Plugin.updateComplete=function(b){var f=new d.$.Modal(a(function(a,g){var h,i,j=d.$.bind(e,g);h=j("OT_dialog-button OT_dialog-button-large OT_dialog-no-natural-margin","Reload").on("click",function(){f.trigger("reload")}).first;var k;k=b?["Update Failed.",b+""||"NO ERROR"]:["Update Complete.","The OpenTok plugin has been succesfully updated. Please reload your browser."],i=j("OT_dialog-centering",[j("OT_dialog-centering-child",[j("OT_root OT_dialog OT_dialog-plugin-upgraded",[j("OT_dialog-messages",[j("OT_dialog-messages-main",k[0]),j("OT_dialog-messages-minor",k[1])]),j("OT_dialog-single-button",h)])])]),c(g,[],function(){g.body.appendChild(i)})}));return f}}(),!function(a){var b={audio:"audioInput",video:"videoInput",audioinput:"audioInput",videoinput:"videoInput",audioInput:"audioInput",videoInput:"videoInput"},c=function(){return navigator.mediaDevices?navigator.mediaDevices.enumerateDevices:d.$.hasCapabilities("otplugin")?OTPlugin.mediaDevices.enumerateDevices:a.MediaStreamTrack&&a.MediaStreamTrack.getSources?a.MediaStreamTrack.getSources:void 0},e=function(b){var e=c();return navigator.mediaDevices&&d.$.isFunction(e)?e=function(a){navigator.mediaDevices.enumerateDevices().then(function(b){a(void 0,b)})["catch"](function(b){a(b)})}:a.MediaStreamTrack&&a.MediaStreamTrack.getSources&&(e=function(b){a.MediaStreamTrack.getSources(function(a){b(void 0,a.map(function(a){return d.$.clone(a)}))})}),e(b)},f=function(a){setTimeout(d.$.bind(a,null,{video:!0,audio:!0}))};d.$.registerCapability("enumerateDevices",function(){return d.$.isFunction(c())}),d.$.getMediaDevices=function(a,c){if(!d.$.hasCapabilities("enumerateDevices"))return void a(new Error("This browser does not support enumerateDevices APIs"));var f=d.$.isFunction(c)?c:e;f(function(c,e){if(c)return void a(c);var f=d.$(e).map(function(a){return{deviceId:a.deviceId||a.id,label:a.label,kind:b[a.kind]}}).filter(function(a){return"audioInput"===a.kind||"videoInput"===a.kind});a(void 0,f.get())})},d.$.shouldAskForDevices=function(a){d.$.hasCapabilities("enumerateDevices")?d.$.getMediaDevices(function(b,c){if(b)return void f(a);var e=d.$.some(c,function(a){return"audioInput"===a.kind}),g=d.$.some(c,function(a){return"videoInput"===a.kind});a.call(null,{video:g,audio:e})}):(d.$.shouldAskForDevices=f,d.$.shouldAskForDevices(a))}}(a);var K=function(a){var b=document.createElement("link");b.type="text/css",b.media="screen",b.rel="stylesheet",b.href=a;var c=document.head||document.getElementsByTagName("head")[0];c.appendChild(b)};d.Config=function(){var a,b,c,e=!1,f={},g={},h=document.head||document.getElementsByTagName("head")[0],i=function(){b&&(clearTimeout(b),b=null)},j=function(){i(),a&&(a.onload=a.onreadystatechange=null,h&&a.parentNode&&h.removeChild(a),a=void 0)},k=function(){(!a.readyState||/loaded|complete/.test(a.readyState))&&(i(),e||c._onLoadTimeout())},l=function(){j(),d.warn("TB DynamicConfig failed to load due to an error"),this.trigger("dynamicConfigLoadFailed")},m=function(a,b){return b&&g[b]&&g[b][a]?g[b][a]:f[a]};return c={loadTimeout:4e3,_onLoadTimeout:function(){j(),d.warn("TB DynamicConfig failed to load in "+c.loadTimeout+" ms"),this.trigger("dynamicConfigLoadFailed")},load:function(f){if(!f)throw new Error("You must pass a valid configUrl to Config.load");e=!1,setTimeout(function(){a=document.createElement("script"),a.async="async",a.src=f,a.onload=a.onreadystatechange=d.$.bind(k,c),a.onerror=d.$.bind(l,c),h.appendChild(a)},1),b=setTimeout(function(){c._onLoadTimeout()},this.loadTimeout)},isLoaded:function(){return e},reset:function(){this.off(),j(),e=!1,f={},g={}},replaceWith:function(a){j(),a||(a={}),f=a.global||{},g=a.partners||{},e||(e=!0),this.trigger("dynamicConfigChanged")},get:function(a,b,c){var d=m(a,c);return d?d[b]:null}},d.$.eventing(c),c}(),d.$.registerCapability("getUserMedia",function(){return"Node"===d.$.env?!1:!!(navigator.webkitGetUserMedia||navigator.mozGetUserMedia||OTPlugin.isInstalled())}),d.$.registerCapability("PeerConnection",function(){return"Node"===d.$.env?!1:"function"==typeof a.webkitRTCPeerConnection&&a.webkitRTCPeerConnection.prototype.addStream?!0:"function"==typeof a.mozRTCPeerConnection&&d.$.env.version>20?!0:OTPlugin.isInstalled()}),d.$.registerCapability("webrtc",function(){if(d.properties){var a=d.properties.minimumVersion||{},b=a[d.$.env.name.toLowerCase()];if(b&&d.$.env.versionGreaterThan(b))return d.debug("Support for",d.$.env.name,"is disabled because we require",b,"but this is",d.$.env.version),!1}return"Node"===d.$.env?!0:d.$.hasCapabilities("getUserMedia","PeerConnection")}),d.$.registerCapability("bundle",function(){return d.$.hasCapabilities("webrtc")&&("Chrome"===d.$.env.name||"Node"===d.$.env.name||OTPlugin.isInstalled())}),d.$.registerCapability("RTCPMux",function(){return d.$.hasCapabilities("webrtc")&&("Chrome"===d.$.env.name||"Node"===d.$.env.name||OTPlugin.isInstalled())}),d.$.registerCapability("audioOutputLevelStat",function(){return"Chrome"===d.$.env.name||"IE"===d.$.env.name||"Opera"===d.$.env.name}),d.$.registerCapability("webAudioCapableRemoteStream",function(){return"Firefox"===d.$.env.name}),d.$.registerCapability("webAudio",function(){return"AudioContext"in a}),d.Analytics=function(b){var c="1",e=new d.$.Analytics(b,d.debug,d._.getClientGuid);this.logError=function(b,f,g,h,i){i||(i={});var j=i.partnerId;d.Config.get("exceptionLogging","enabled",j)===!0&&d._.getClientGuid(function(k,l){if(!k){var m=d.$.extend({clientVersion:"js-"+d.properties.version.replace("v",""),guid:l,partnerId:j,source:a.location.href,logVersion:c,clientSystemTime:(new Date).getTime()},i);e.logError(b,f,g,h,m)}})},this.logEvent=function(b,f,g){var h=b.partnerId;b||(b={}),d._.getClientGuid(function(i,j){if(!i){var k=d.$.extend({clientVersion:"js-"+d.properties.version.replace("v",""),guid:j,partnerId:h,source:a.location.href,logVersion:c,clientSystemTime:(new Date).getTime()},b);e.logEvent(k,!1,f,g)}})},this.logQOS=function(b){var f=b.partnerId;b||(b={}),d._.getClientGuid(function(g,h){if(!g){var i=d.$.extend({clientVersion:"js-"+d.properties.version.replace("v",""),guid:h,partnerId:f,source:a.location.href,logVersion:c,clientSystemTime:(new Date).getTime(),duration:0},b);e.logQOS(i)}})}},d.ConnectivityAttemptPinger=function(a){var b,c,e,f="Initial",g=["Initial","Attempt","Success","Failure"],h=5e3,i=6,j=function(c){f=c;var e=!1;switch(f){case"Attempt":"Initial"!==b&&(e=!0),l();break;case"Success":"Attempt"!==b&&(e=!0),m();break;case"Failure":"Attempt"!==b&&(e=!0),m()}if(e){var g=a?d.$.clone(a):{};g.action="Internal Error",g.variation="Non-fatal",g.payload={debug:"Invalid sequence: "+a.action+" "+b+" -> "+f},d.analytics.logEvent(g)}},k=d.$.statable(this,g,"Failure",j),l=function(){e=0,c=setInterval(function(){if(i>e){var b=d.$.extend(a,{variation:"Attempting"});d.analytics.logEvent(b)}else m();e++},h)},m=function(){clearInterval(c)};this.setVariation=function(a){b=f,k(a)},this.stop=function(){m()}},d.StylableComponent=function(a,b,c,e){if(!a.trigger)throw new Error("OT.StylableComponent is dependent on the mixin OT.$.eventing. Ensure that this is included in the object before StylableComponent.");var f=!1,g=function(b,c,d){d?a.trigger("styleValueChanged",b,c,d):a.trigger("styleValueChanged",b,c)};c===!1&&(b={buttonDisplayMode:"off",nameDisplayMode:"off",audioLevelDisplayMode:"off"},f=!0,e({showControls:!1}));var h=new L(b,g);a.getStyle=function(a){return h.get(a)},f?a.setStyle=function(){return d.warn("Calling setStyle() has no effect because theshowControls option was set to false"),this}:a.setStyle=function(a,b,c){var d={};return"string"!=typeof a?(h.setAll(a,c),d=a):(h.set(a,b),d[a]=b),e&&e(d),this}};var L=function(a,b){var c,e,f,g,h={};c=["showMicButton","showSpeakerButton","nameDisplayMode","buttonDisplayMode","backgroundImageURI","audioLevelDisplayMode"],e={buttonDisplayMode:["auto","mini","mini-auto","off","on"],nameDisplayMode:["auto","off","on"],audioLevelDisplayMode:["auto","off","on"],showSettingsButton:[!0,!1],showMicButton:[!0,!1],backgroundImageURI:null,showControlBar:[!0,!1],showArchiveStatus:[!0,!1],videoDisabledDisplayMode:["auto","off","on"]},f=function(a,b){return"backgroundImageURI"===a||e.hasOwnProperty(a)&&-1!==d.$.arrayIndexOf(e[a],b)},g=function(a){switch(a){case"true":return!0;case"false":return!1;default:return a}},this.getAll=function(){var a=d.$.clone(h);for(var b in a)a.hasOwnProperty(b)&&d.$.arrayIndexOf(c,b)<0&&delete a[b];return a},this.get=function(a){return a?h[a]:this.getAll()},this.setAll=function(a,c){var e,i;for(var j in a)a.hasOwnProperty(j)&&(i=g(a[j]),f(j,i)?(e=h[j],i!==e&&(h[j]=i,c||b(j,i,e))):d.warn("Style.setAll::Invalid style property passed "+j+" : "+i));return this},this.set=function(a,c){d.debug("setStyle: "+a.toString());var e,i=g(c);return f(a,i)?(e=h[a],i!==e&&(h[a]=i,b(a,c,e)),this):(d.warn("Style.set::Invalid style property passed "+a+" : "+i),this)},a&&this.setAll(a,!0)};d.generateSimpleStateMachine=function(a,b,c){var e=b.slice(),f=d.$.clone(c),g=function(a){return-1!==d.$.arrayIndexOf(e,a)},h=function(a,b){return f[a]&&-1!==d.$.arrayIndexOf(f[a],b)};return function(b){function c(a,c){b({message:a,newState:c,currentState:e,previousState:f})}function d(a){return g(a)?h(e,a)?!0:(c("'"+e+"' cannot transition to '"+a+"'",a),!1):(c("'"+a+"' is not a valid state",a),!1)}var e=a,f=null;this.current=e,this.set=function(a){d(a)&&(f=e,this.current=e=a)}}},!function(){var a,b,c="NotSubscribing";a=["NotSubscribing","Init","ConnectingToPeer","BindingRemoteStream","Subscribing","Failed","Destroyed"],b={NotSubscribing:["NotSubscribing","Init","Destroyed"],Init:["NotSubscribing","ConnectingToPeer","BindingRemoteStream","Destroyed"],ConnectingToPeer:["NotSubscribing","BindingRemoteStream","Failed","Destroyed"],BindingRemoteStream:["NotSubscribing","Subscribing","Failed","Destroyed"],Subscribing:["NotSubscribing","Failed","Destroyed"],Failed:["Destroyed"],Destroyed:[]},d.SubscribingState=d.generateSimpleStateMachine(c,a,b),d.SubscribingState.prototype.isDestroyed=function(){return"Destroyed"===this.current},d.SubscribingState.prototype.isFailed=function(){return"Failed"===this.current},d.SubscribingState.prototype.isSubscribing=function(){return"Subscribing"===this.current},d.SubscribingState.prototype.isAttemptingToSubscribe=function(){return-1!==d.$.arrayIndexOf(["Init","ConnectingToPeer","BindingRemoteStream"],this.current)}}(a),!function(){var a=["NotPublishing","GetUserMedia","BindingMedia","MediaBound","PublishingToSession","Publishing","Failed","Destroyed"],b={NotPublishing:["NotPublishing","GetUserMedia","Destroyed"],GetUserMedia:["BindingMedia","Failed","NotPublishing","Destroyed"],BindingMedia:["MediaBound","Failed","NotPublishing","Destroyed"],MediaBound:["NotPublishing","PublishingToSession","Failed","Destroyed"],PublishingToSession:["NotPublishing","Publishing","Failed","Destroyed"],Publishing:["NotPublishing","MediaBound","Failed","Destroyed"],Failed:["Destroyed"],Destroyed:[]},c="NotPublishing";d.PublishingState=d.generateSimpleStateMachine(c,a,b),d.PublishingState.prototype.isDestroyed=function(){return"Destroyed"===this.current},d.PublishingState.prototype.isAttemptingToPublish=function(){return-1!==d.$.arrayIndexOf(["GetUserMedia","BindingMedia","MediaBound","PublishingToSession"],this.current)},d.PublishingState.prototype.isPublishing=function(){return"Publishing"===this.current}}(a),!function(){d.Microphone=function(a,b){var c;d.$.defineProperties(this,{muted:{get:function(){return c},set:function(b){if(c!==b){c=b;for(var d=a.getAudioTracks(),e=0,f=d.length;f>e;++e)d[e].setEnabled(!c);
}}}}),void 0!==b?this.muted(b===!0):a.getAudioTracks().length?this.muted(!a.getAudioTracks()[0].enabled):this.muted(!1)}}(a),!function(){d.Event=d.$.Event(),d.Event.names={ACTIVE:"active",INACTIVE:"inactive",UNKNOWN:"unknown",PER_SESSION:"perSession",PER_STREAM:"perStream",EXCEPTION:"exception",ISSUE_REPORTED:"issueReported",SESSION_CONNECTED:"sessionConnected",SESSION_DISCONNECTED:"sessionDisconnected",STREAM_CREATED:"streamCreated",STREAM_DESTROYED:"streamDestroyed",CONNECTION_CREATED:"connectionCreated",CONNECTION_DESTROYED:"connectionDestroyed",SIGNAL:"signal",STREAM_PROPERTY_CHANGED:"streamPropertyChanged",MICROPHONE_LEVEL_CHANGED:"microphoneLevelChanged",RESIZE:"resize",SETTINGS_BUTTON_CLICK:"settingsButtonClick",DEVICE_INACTIVE:"deviceInactive",INVALID_DEVICE_NAME:"invalidDeviceName",ACCESS_ALLOWED:"accessAllowed",ACCESS_DENIED:"accessDenied",ACCESS_DIALOG_OPENED:"accessDialogOpened",ACCESS_DIALOG_CLOSED:"accessDialogClosed",ECHO_CANCELLATION_MODE_CHANGED:"echoCancellationModeChanged",MEDIA_STOPPED:"mediaStopped",PUBLISHER_DESTROYED:"destroyed",SUBSCRIBER_DESTROYED:"destroyed",DEVICES_DETECTED:"devicesDetected",DEVICES_SELECTED:"devicesSelected",CLOSE_BUTTON_CLICK:"closeButtonClick",MICLEVEL:"microphoneActivityLevel",MICGAINCHANGED:"microphoneGainChanged",ENV_LOADED:"envLoaded",ENV_UNLOADED:"envUnloaded",AUDIO_LEVEL_UPDATED:"audioLevelUpdated"},d.ExceptionCodes={JS_EXCEPTION:2e3,AUTHENTICATION_ERROR:1004,INVALID_SESSION_ID:1005,CONNECT_FAILED:1006,CONNECT_REJECTED:1007,CONNECTION_TIMEOUT:1008,NOT_CONNECTED:1010,INVALID_PARAMETER:1011,P2P_CONNECTION_FAILED:1013,API_RESPONSE_FAILURE:1014,TERMS_OF_SERVICE_FAILURE:1026,UNABLE_TO_PUBLISH:1500,UNABLE_TO_SUBSCRIBE:1501,UNABLE_TO_FORCE_DISCONNECT:1520,UNABLE_TO_FORCE_UNPUBLISH:1530,PUBLISHER_ICE_WORKFLOW_FAILED:1553,SUBSCRIBER_ICE_WORKFLOW_FAILED:1554,UNEXPECTED_SERVER_RESPONSE:2001,REPORT_ISSUE_ERROR:2011},d.ExceptionEvent=function(a,b,c,e,f,g){d.Event.call(this,a),this.message=b,this.title=c,this.code=e,this.component=f,this.target=g},d.IssueReportedEvent=function(a,b){d.Event.call(this,a),this.issueId=b},d.EnvLoadedEvent=function(a){d.Event.call(this,a)};var a=!1;d.ConnectionEvent=function(b,c,e){d.Event.call(this,b,!1),d.$.canDefineProperty?Object.defineProperty(this,"connections",{get:function(){return a||(d.warn("OT.ConnectionEvent connections property is deprecated, use connection instead."),a=!0),[c]}}):this.connections=[c],this.connection=c,this.reason=e};var b=!1;d.StreamEvent=function(a,c,e,f){d.Event.call(this,a,f),d.$.canDefineProperty?Object.defineProperty(this,"streams",{get:function(){return b||(d.warn("OT.StreamEvent streams property is deprecated, use stream instead."),b=!0),[c]}}):this.streams=[c],this.stream=c,this.reason=e};var c=!1,e=!1,f=!1;d.SessionConnectEvent=function(a){d.Event.call(this,a,!1),d.$.canDefineProperty?Object.defineProperties(this,{connections:{get:function(){return c||(d.warn("OT.SessionConnectedEvent no longer includes connections. Listen for connectionCreated events instead."),c=!0),[]}},streams:{get:function(){return e||(d.warn("OT.SessionConnectedEvent no longer includes streams. Listen for streamCreated events instead."),c=!0),[]}},archives:{get:function(){return f||(d.warn("OT.SessionConnectedEvent no longer includes archives. Listen for archiveStarted events instead."),f=!0),[]}}}):(this.connections=[],this.streams=[],this.archives=[])},d.SessionDisconnectEvent=function(a,b,c){d.Event.call(this,a,c),this.reason=b},d.StreamPropertyChangedEvent=function(a,b,c,e,f){d.Event.call(this,a,!1),this.type=a,this.stream=b,this.changedProperty=c,this.oldValue=e,this.newValue=f},d.VideoDimensionsChangedEvent=function(a,b,c){d.Event.call(this,"videoDimensionsChanged",!1),this.type="videoDimensionsChanged",this.target=a,this.oldValue=b,this.newValue=c},d.ArchiveEvent=function(a,b){d.Event.call(this,a,!1),this.type=a,this.id=b.id,this.name=b.name,this.status=b.status,this.archive=b},d.ArchiveUpdatedEvent=function(a,b,c,e){d.Event.call(this,"updated",!1),this.target=a,this.changedProperty=b,this.oldValue=c,this.newValue=e},d.SignalEvent=function(a,b,c){d.Event.call(this,a?"signal:"+a:d.Event.names.SIGNAL,!1),this.data=b,this.from=c},d.StreamUpdatedEvent=function(a,b,c,e){d.Event.call(this,"updated",!1),this.target=a,this.changedProperty=b,this.oldValue=c,this.newValue=e},d.DestroyedEvent=function(a,b,c){d.Event.call(this,a,!1),this.target=b,this.reason=c},d.VideoEnabledChangedEvent=function(a,b){d.Event.call(this,a,!1),this.reason=b.reason},d.VideoDisableWarningEvent=function(a){d.Event.call(this,a,!1)},d.AudioLevelUpdatedEvent=function(a){d.Event.call(this,d.Event.names.AUDIO_LEVEL_UPDATED,!1),this.audioLevel=a},d.MediaStoppedEvent=function(a){d.Event.call(this,d.Event.names.MEDIA_STOPPED,!0),this.target=a}}(a);var M={},N={};d.registerScreenSharingExtensionHelper=function(a,b){N[a]=b,b.autoRegisters&&b.isSupportedInThisBrowser&&d.registerScreenSharingExtension(a)},d.registerScreenSharingExtension=function(a){var b=Array.prototype.slice.call(arguments,1);if(null==N[a])throw new Error("Unsupported kind passed to OT.registerScreenSharingExtension");var c=N[a].register.apply(N[a],b);M[a]=c};var O=function(){var a=d.$.find(d.$.keys(N),function(a){return N[a].isSupportedInThisBrowser});return void 0===a?{}:{name:a,proto:N[a],instance:M[a]}};d.pickScreenSharingHelper=function(){return O()},d.checkScreenSharingCapability=function(a){var b={supported:!1,extensionRequired:void 0,extensionRegistered:void 0,extensionInstalled:void 0,supportedSources:{}},c=O();return void 0===c.name?void setTimeout(a.bind(null,b)):(b.supported=!0,b.extensionRequired=c.proto.extensionRequired?c.name:void 0,b.supportedSources={screen:c.proto.sources.screen,application:c.proto.sources.application,window:c.proto.sources.window,browser:c.proto.sources.browser},c.instance?(b.extensionRegistered=b.extensionRequired?!0:void 0,void c.instance.isInstalled(function(c){b.extensionInstalled=b.extensionRequired?c:void 0,a(b)})):(b.extensionRegistered=!1,b.extensionRequired&&(b.extensionInstalled=!1),void setTimeout(a.bind(null,b))))},d.registerScreenSharingExtensionHelper("firefox",{isSupportedInThisBrowser:"Firefox"===d.$.env.name,autoRegisters:!0,extensionRequired:!1,getConstraintsShowsPermissionUI:!1,sources:{screen:!0,application:"Firefox"===d.$.env.name&&d.$.env.version>=34,window:"Firefox"===d.$.env.name&&d.$.env.version>=34,browser:"Firefox"===d.$.env.name&&d.$.env.version>=38},register:function(){return{isInstalled:function(a){a(!0)},getConstraints:function(a,b,c){b.video={mediaSource:a},b.browserWindow&&(b.video.browserWindow=b.browserWindow,delete b.browserWindow),"undefined"!=typeof b.scrollWithPage&&(b.video.scrollWithPage=b.scrollWithPage,delete b.scrollWithPage),c(void 0,b)}}}}),d.registerScreenSharingExtensionHelper("chrome",{isSupportedInThisBrowser:!!navigator.webkitGetUserMedia&&"undefined"!=typeof chrome,autoRegisters:!1,extensionRequired:!0,getConstraintsShowsPermissionUI:!0,sources:{screen:!0,application:!1,window:!1,browser:!1},register:function(b){if(!b)throw new Error("initChromeScreenSharingExtensionHelper: extensionID is required.");var c=!!navigator.webkitGetUserMedia&&"undefined"!=typeof chrome,e={},f=void 0,g="com.tokbox.screenSharing."+b,h=function(a,b){var c={payload:b,from:"jsapi"};return c[g]=a,c},i=function(a,b){var c,f=d.$.uuid();return e[f]=function(){clearTimeout(c),c=null,a.apply(null,arguments)},b&&(c=setTimeout(function(){delete e[f],a(new Error("Timeout waiting for response to request."))},b)),f},j=function(b){if(!b)throw new Error("isAvailable: callback is required.");if(c||setTimeout(b.bind(null,!1)),void 0!==f)setTimeout(b.bind(null,f));else{var d=i(function(a,c){f!==!0&&(f="extensionLoaded"===c),b(f)},2e3),e=h("isExtensionInstalled",{requestId:d});a.postMessage(e,"*")}},k=function(b,c,d){if(!d)throw new Error("getSourceId: callback is required");j(function(e){if(e){var f=i(function(a,b,e){"permissionDenied"===b?d(new Error("PermissionDeniedError")):(c.video||(c.video={}),c.video.mandatory||(c.video.mandatory={}),c.video.mandatory.chromeMediaSource="desktop",c.video.mandatory.chromeMediaSourceId=e.sourceId,d(void 0,c))});a.postMessage(h("getSourceId",{requestId:f,source:b}),"*")}else d(new Error("Extension is not installed"))})};return a.addEventListener("message",function(b){if(b.origin===a.location.origin&&null!=b.data&&"object"==typeof b.data&&"extension"===b.data.from){var c=b.data[g],d=b.data.payload;if(d&&d.requestId){var h=e[d.requestId];delete e[d.requestId],h&&h(null,c,d)}"extensionLoaded"===c&&(f=!0)}}),{isInstalled:j,getConstraints:k}}}),d.StreamChannel=function(a){this.id=a.id,this.type=a.type,this.active=d.$.castToBoolean(a.active),this.orientation=a.orientation||d.VideoOrientation.ROTATED_NORMAL,a.frameRate&&(this.frameRate=parseFloat(a.frameRate)),a.maxFrameRate&&(this.maxFrameRate=parseFloat(a.maxFrameRate)),a.maxWidth&&(this.maxWidth=parseInt(a.maxWidth,10)),a.maxHeight&&(this.maxHeight=parseInt(a.maxHeight,10)),this.width=parseInt(a.width,10),this.height=parseInt(a.height,10),this.source=a.source||"camera",this.fitMode=a.fitMode||"cover",d.$.eventing(this,!0),this.update=function(a){var b={},c={};for(var e in a)if(a.hasOwnProperty(e)){var f=this[e];switch(e){case"active":this.active=d.$.castToBoolean(a[e]);break;case"disableWarning":this.disableWarning=d.$.castToBoolean(a[e]);break;case"frameRate":this.frameRate=parseFloat(a[e],10);break;case"width":case"height":this[e]=parseInt(a[e],10),b[e]=this[e],c[e]=f;break;case"orientation":this[e]=a[e],b[e]=this[e],c[e]=f;break;case"fitMode":this[e]=a[e];break;case"source":this[e]=a[e];break;default:return void d.warn("Tried to update unknown key "+e+" on "+this.type+" channel "+this.id)}this.trigger("update",this,e,f,this[e])}return d.$.keys(b).length&&this.trigger("update",this,"videoDimensions",c,b),!0}},!function(){var a=["name","archiving"];d.Stream=function(b,c,e,f,g,h){var i;this.id=this.streamId=b,this.name=c,this.creationTime=Number(e),this.connection=f,this.channel=h,this.publisher=d.publishers.find({streamId:this.id}),d.$.eventing(this);var j=d.$.bind(function(a,b,c,e){var f=b;switch(f){case"active":f="audio"===a.type?"hasAudio":"hasVideo",this[f]=e;break;case"disableWarning":if(f="audio"===a.type?"audioDisableWarning":"videoDisableWarning",this[f]=e,!this["audio"===a.type?"hasAudio":"hasVideo"])return;break;case"fitMode":f="defaultFitMode",this[f]=e;break;case"source":f="audio"===a.type?"audioType":"videoType",this[f]=e;break;case"videoDimensions":this.videoDimensions=e;break;case"orientation":case"width":case"height":return}this.dispatchEvent(new d.StreamUpdatedEvent(this,f,c,e))},this),k=d.$.bind(function(){return this.publisher?this.publisher:d.subscribers.find(function(a){return a.stream&&a.stream.id===this.id&&a.session.id===g.id},this)},this),l=d.$.bind(function(){return!this.publisher},this);this.getChannelsOfType=function(a){return d.$.filter(this.channel,function(b){return b.type===a})},this.getChannel=function(a){for(var b=0;b<this.channel.length;++b)if(this.channel[b].id===a)return this.channel[b];return null};var m=this.getChannelsOfType("audio")[0],n=this.getChannelsOfType("video")[0];this.hasAudio=null!=m&&m.active,this.hasVideo=null!=n&&n.active,this.videoType=n&&n.source,this.defaultFitMode=n&&n.fitMode,this.videoDimensions={},n&&(this.videoDimensions.width=n.width,this.videoDimensions.height=n.height,this.videoDimensions.orientation=n.orientation,n.on("update",j),this.frameRate=n.frameRate),m&&m.on("update",j),this.setChannelActiveState=function(a,b,c){var d={active:b};c&&(d.activeReason=c),o(a,d)},this.setVideoDimensions=function(a,b){o("video",{width:a,height:b,orientation:0})},this.setRestrictFrameRate=function(a){o("video",{restrictFrameRate:a})},this.setPreferredResolution=function(a){if(!l())return void d.warn("setPreferredResolution has no affect when called by a publisher");if(g.sessionInfo.p2pEnabled)return void d.warn("Stream.setPreferredResolution will not work in a P2P Session");if(!a||void 0!==a.width||void 0!==a.height){var b=this.getChannelsOfType("video")[0];if(b){if(a&&a.width){if(isNaN(parseInt(a.width,10)))throw new d.$.Error("stream preferred width must be an integer","Subscriber");b.maxWidth=parseInt(a.width,10)}else b.maxWidth=void 0;if(a&&a.height){if(isNaN(parseInt(a.height,10)))throw new d.$.Error("stream preferred height must be an integer","Subscriber");b.maxHeight=parseInt(a.height,10)}else b.maxHeight=void 0;g._.subscriberChannelUpdate(this,k(),b,{maxWidth:b.maxWidth||0,maxHeight:b.maxHeight||0})}}},this.getPreferredResolution=function(){var a=this.getChannelsOfType("video")[0];return a&&(a.maxWidth||a.maxHeight)?{width:a.maxWidth,height:a.maxHeight}:void 0},this.setPreferredFrameRate=function(a){if(!l())return void d.warn("setPreferredFrameRate has no affect when called by a publisher");if(g.sessionInfo.p2pEnabled)return void d.warn("Stream.setPreferredFrameRate will not work in a P2P Session");if(a&&isNaN(parseFloat(a)))throw new d.$.Error("stream preferred frameRate must be a number","Subscriber");var b=this.getChannelsOfType("video")[0];b&&(b.maxFrameRate=a?parseFloat(a):void 0,g._.subscriberChannelUpdate(this,k(),b,{maxFrameRate:b.maxFrameRate||0}))},this.getPreferredFrameRate=function(){var a=this.getChannelsOfType("video")[0];return a?a.maxFrameRate:void 0};var o=d.$.bind(function(a,b){var c;if(this.publisher)c=function(a){g._.streamChannelUpdate(this,a,b)};else{var e=k();c=function(a){g._.subscriberChannelUpdate(this,e,a,b)}}d.$.forEach(this.getChannelsOfType(a),d.$.bind(c,this))},this);this.destroyed=!1,this.destroyedReason=void 0,this.destroy=function(a,b){i=a||"clientDisconnected",this.destroyed=!0,this.destroyedReason=i,b!==!0&&this.dispatchEvent(new d.DestroyedEvent("destroyed",this,i))},this._={},this._.updateProperty=d.$.bind(function(b,c){if(-1===d.$.arrayIndexOf(a,b))return void d.warn('Unknown stream property "'+b+'" was modified to "'+c+'".');var e=this[b],f=c;switch(b){case"name":this[b]=f;break;case"archiving":var g=k();g&&g._.archivingStatus(f),this[b]=f}var h=new d.StreamUpdatedEvent(this,b,e,f);this.dispatchEvent(h)},this),this._.update=d.$.bind(function(a){for(var b in a)a.hasOwnProperty(b)&&this._.updateProperty(b,a[b])},this),this._.updateChannel=d.$.bind(function(a,b){this.getChannel(a).update(b)},this)}}(a),d.IntervalRunner=function(b,c){var d=b,e=c,f=null;this.start=function(){f=a.setInterval(d,1e3/e)},this.stop=function(){a.clearInterval(f),f=null}},!function(){function a(a,b,c,e){var f=d.getErrorTitleByCode(c),g=e?d.$.clone(e):{};d.error("OT.exception :: title: "+f+" ("+c+") msg: "+b),g.partnerId||(g.partnerId=d.APIKEY);try{d.analytics.logError(c,"tb.exception",f,{details:b},g),d.dispatchEvent(new d.ExceptionEvent(d.Event.names.EXCEPTION,b,f,c,a,a))}catch(h){d.error("OT.exception :: Failed to dispatch exception - "+h.toString())}}d.Error=function(a,b){this.code=a,this.message=b};var b={1004:"Authentication error",1005:"Invalid Session ID",1006:"Connect Failed",1007:"Connect Rejected",1008:"Connect Time-out",1009:"Security Error",1010:"Not Connected",1011:"Invalid Parameter",1012:"Peer-to-peer Stream Play Failed",1013:"Connection Failed",1014:"API Response Failure",1015:"Session connected, cannot test network",1021:"Request Timeout",1026:"Terms of Service Violation: Export Compliance",1500:"Unable to Publish",1503:"No TURN server found",1520:"Unable to Force Disconnect",1530:"Unable to Force Unpublish",1553:"ICEWorkflow failed",1600:"createOffer, createAnswer, setLocalDescription, setRemoteDescription",2e3:"Internal Error",2001:"Unexpected Server Response",4e3:"WebSocket Connection Failed",4001:"WebSocket Network Disconnected"};d.getErrorTitleByCode=function(a){return b[+a]},d.handleJsException=function(b,c,d){d=d||{};var e,f=d.session;f?(e={sessionId:f.sessionId},f.isConnected()&&(e.connectionId=f.connection.connectionId),d.target||(d.target=f)):d.sessionId&&(e={sessionId:d.sessionId},d.target||(d.target=null)),a(d.target,b,c,e)}}(a),!function(){function a(){var a=!1,b=OTPlugin.isSupported(),c=b?OTPlugin.isReady():!0,e=function(){return!d.$.isDOMUnloaded()&&d.$.isReady()&&a&&c},f=function(){e()&&d.dispatchEvent(new d.EnvLoadedEvent(d.Event.names.ENV_LOADED))},g=function(){d.$.onDOMUnload(h),d.Config.load(d.properties.configURL),f()},h=function(){d.dispatchEvent(new d.EnvLoadedEvent(d.Event.names.ENV_UNLOADED))},i=function(a){c=!0,a&&d.debug("TB Plugin failed to load or was not installed"),f()},j=function(){a=!0,d.Config.off("dynamicConfigChanged",j),d.Config.off("dynamicConfigLoadFailed",k),f()},k=function(){j()};d.Config.on("dynamicConfigChanged",j),d.Config.on("dynamicConfigLoadFailed",k),d.$.onDOMLoad(g),b&&OTPlugin.ready(i),this.onLoad=function(a,b){return e()?void a.call(b):void d.on(d.Event.names.ENV_LOADED,a,b)},this.onUnload=function(a,b){return this.isUnloaded()?void a.call(b):void d.on(d.Event.names.ENV_UNLOADED,a,b)},this.isUnloaded=function(){return d.$.isDOMUnloaded()}}var b=new a;d.onLoad=function(a,c){b.onLoad(a,c)},d.onUnload=function(a,c){b.onUnload(a,c)},d.isUnloaded=function(){return b.isUnloaded()}}();var P,Q=document.location.hash;d.HAS_REQUIREMENTS=1,d.NOT_HAS_REQUIREMENTS=0,d.checkSystemRequirements=function(){d.debug("OT.checkSystemRequirements()");var a=d.$.hasCapabilities("websockets","webrtc")||OTPlugin.isInstalled();return a=a?this.HAS_REQUIREMENTS:this.NOT_HAS_REQUIREMENTS,d.checkSystemRequirements=function(){return d.debug("OT.checkSystemRequirements()"),a},a===this.NOT_HAS_REQUIREMENTS&&d.analytics.logEvent({action:"checkSystemRequirements",variation:"notHasRequirements",partnerId:d.APIKEY,payload:{userAgent:d.$.env.userAgent}}),a},d.upgradeSystemRequirements=function(){d.onLoad(function(){if(OTPlugin.isSupported())return void d.Dialogs.Plugin.promptToInstall().on({download:function(){a.location=OTPlugin.pathToInstaller()},refresh:function(){location.reload()},closed:function(){}});var b="_upgradeFlash";document.body.appendChild(function(){var a=document.createElement("iframe");a.id=b,a.style.position="absolute",a.style.position="fixed",a.style.height="100%",a.style.width="100%",a.style.top="0px",a.style.left="0px",a.style.right="0px",a.style.bottom="0px",a.style.zIndex=1e3;try{a.style.backgroundColor="rgba(0,0,0,0.2)"}catch(c){a.style.backgroundColor="transparent",a.setAttribute("allowTransparency","true")}a.setAttribute("frameBorder","0"),a.frameBorder="0",a.scrolling="no",a.setAttribute("scrolling","no");var e=d.properties.minimumVersion[d.$.env.name.toLowerCase()],f=e>d.$.env.version;return a.src=d.properties.assetURL+"/html/upgrade.html#"+encodeURIComponent(f?"true":"false")+","+encodeURIComponent(JSON.stringify(d.properties.minimumVersion))+"|"+encodeURIComponent(document.location.href),a}()),P&&clearInterval(P),P=setInterval(function(){var a=document.location.hash,c=/^#?\d+&/;a!==Q&&c.test(a)&&(Q=a,"close_window"===a.replace(c,"")&&(document.body.removeChild(document.getElementById(b)),document.location.hash=""))},100)})},d.ConnectionCapabilities=function(a){var b=function(a){return a.supportsWebRTC=d.$.castToBoolean(a.supportsWebRTC),a},c=b(a);this.supportsWebRTC=c.supportsWebRTC},d.Capabilities=function(a){this.publish=-1!==d.$.arrayIndexOf(a,"publish")?1:0,this.subscribe=-1!==d.$.arrayIndexOf(a,"subscribe")?1:0,this.forceUnpublish=-1!==d.$.arrayIndexOf(a,"forceunpublish")?1:0,this.forceDisconnect=-1!==d.$.arrayIndexOf(a,"forcedisconnect")?1:0,this.supportsWebRTC=d.$.hasCapabilities("webrtc")?1:0,this.permittedTo=function(a){return this.hasOwnProperty(a)&&1===this[a]}},d.Connection=function(a,b,c,e,f){var g;this.id=this.connectionId=a,this.creationTime=b?Number(b):null,this.data=c,this.capabilities=new d.ConnectionCapabilities(e),this.permissions=new d.Capabilities(f),this.quality=null,d.$.eventing(this),this.destroy=d.$.bind(function(a,b){g=a||"clientDisconnected",b!==!0&&this.dispatchEvent(new d.DestroyedEvent("destroyed",this,g))},this),this.destroyed=function(){return void 0!==g},this.destroyedReason=function(){return g}},d.Connection.fromHash=function(a){return new d.Connection(a.id,a.creationTime,a.data,d.$.extend(a.capablities||{},{supportsWebRTC:!0}),a.permissions||[])},!function(){var a=8192,b=128;d.Signal=function(c,e,f){var g=function(a){return!/^[a-zA-Z0-9\-\._~]+$/.exec(a)},h=function(a){return a?a instanceof d.Connection||a instanceof d.Session?null:{code:400,reason:"The To field was invalid"}:{code:400,reason:"The signal to field was invalid. Either set it to a OT.Connection, OT.Session, or omit it entirely"}},i=function(a){var c=null;return null===a||void 0===a?c={code:400,reason:"The signal type was null or undefined. Either set it to a String value or omit it"}:a.length>b?c={code:413,reason:"The signal type was too long, the maximum length of it is "+b+" characters"}:g(a)&&(c={code:400,reason:"The signal type was invalid, it can only contain letters, numbers, '-', '_', and '~'."}),c},j=function(b){var c=null;if(null===b||void 0===b)c={code:400,reason:"The signal data was null or undefined. Either set it to a String value or omit it"};else try{JSON.stringify(b).length>a&&(c={code:413,reason:"The data field was too long, the maximum size of it is "+a+" characters"})}catch(d){c={code:400,reason:"The data field was not valid JSON"}}return c};this.toRaptorMessage=function(){var a=this.to;return a&&"string"!=typeof a&&(a=a.id),d.Raptor.Message.signals.create(d.APIKEY,c,a,this.type,this.data)},this.toHash=function(){return f},this.error=null,f&&(f.hasOwnProperty("data")&&(this.data=d.$.clone(f.data),this.error=j(this.data)),f.hasOwnProperty("to")&&(this.to=f.to,this.error||(this.error=h(this.to))),f.hasOwnProperty("type")&&(this.error||(this.error=i(f.type)),this.type=f.type)),this.valid=null===this.error}}(this),d.Raptor.Socket=function(a,b,c,e,f){var g,h,i,j,k,l=["disconnected","connecting","connected","error","disconnecting"],m=d.$.statable(this,l,"disconnected"),o=function(a){m(a?"error":"connected"),k.apply(null,arguments)},p=d.$.bind(function(a){var b="clientDisconnected";!this.is("disconnecting")&&i.is("error")&&(b="networkDisconnected"),a&&4001===a.code&&(b="networkTimedout"),m("disconnected"),j.onClose(b)},this),q=function(){};this.connect=function(b,f,l){if(!this.is("disconnected","error"))return void d.warn("Cannot connect the Raptor Socket as it is currently connected. You should disconnect first.");m("connecting"),g=f.sessionId,h=b,k=l;var n="/v2/partner/"+d.APIKEY+"/session/"+g;i=new d.Rumor.Socket(c,e),i.onClose(p),i.onMessage(d.$.bind(j.dispatch,j)),i.connect(a,d.$.bind(function(b){if(b)return void o({reason:"WebSocketConnection",code:b.code,message:b.message});i.onError(q),d.debug("Raptor Socket connected. Subscribing to "+n+" on "+c),i.subscribe([n]);var e=d.Raptor.Message.connections.create(d.APIKEY,g,i.id());this.publish(e,{"X-TB-TOKEN-AUTH":h},d.$.bind(function(b){if(b){var c,e,f=[400,403,409];b.code===d.ExceptionCodes.CONNECT_FAILED?(c=b.code,e=d.getErrorTitleByCode(b.code)):b.code&&d.$.arrayIndexOf(f,b.code)>-1?(c=d.ExceptionCodes.CONNECT_FAILED,e="Received error response to connection create message."):(c=d.ExceptionCodes.UNEXPECTED_SERVER_RESPONSE,e="Unexpected server response. Try this operation again later."),b.message="ConnectToSession:"+b.code+":Received error response to connection create message.";var h={reason:"ConnectToSession",code:c,message:e},i={action:"Connect",variation:"Failure",payload:h,sessionId:g,partnerId:d.APIKEY,connectionId:a};return d.analytics.logEvent(i),void o(h)}this.publish(d.Raptor.Message.sessions.get(d.APIKEY,g),function(b){if(b){var c,e,f=[400,403,409];b.code&&d.$.arrayIndexOf(f,b.code)>-1?(c=d.ExceptionCodes.CONNECT_FAILED,e="Received error response to session read"):(c=d.ExceptionCodes.UNEXPECTED_SERVER_RESPONSE,e="Unexpected server response. Try this operation again later.");var h={reason:"GetSessionState",code:b.code,message:e},i={action:"Connect",variation:"Failure",payload:h,sessionId:g,partnerId:d.APIKEY,connectionId:a};d.analytics.logEvent(i),o(h)}else o.apply(null,arguments)})},this))},this))},this.disconnect=function(a){this.is("disconnected")||(m("disconnecting"),i.disconnect(a))},this.publish=function(a,b,c){if(i.isNot("connected"))return void d.error("OT.Raptor.Socket: cannot publish until the socket is connected."+a);var f,g=d.$.uuid(),h={};return b&&(d.$.isFunction(b)?(h={},f=b):h=b),!f&&c&&d.$.isFunction(c)&&(f=c),f&&j.registerCallback(g,f),d.debug("OT.Raptor.Socket Publish (ID:"+g+") "),d.debug(a),i.publish([e],a,d.$.extend(h,{"Content-Type":"application/x-raptor+v2","TRANSACTION-ID":g,"X-TB-FROM-ADDRESS":i.id()})),g},this.streamCreate=function(a,b,c,e,f,h,i){var j=d.Raptor.Message.streams.create(d.APIKEY,g,b,a,c,e,f,h);this.publish(j,function(a,c){i(a,b,c)})},this.streamDestroy=function(a){this.publish(d.Raptor.Message.streams.destroy(d.APIKEY,g,a))},this.streamChannelUpdate=function(a,b,c){this.publish(d.Raptor.Message.streamChannels.update(d.APIKEY,g,a,b,c))},this.subscriberCreate=function(a,b,c,e){this.publish(d.Raptor.Message.subscribers.create(d.APIKEY,g,a,b,i.id(),c),e)},this.subscriberDestroy=function(a,b){this.publish(d.Raptor.Message.subscribers.destroy(d.APIKEY,g,a,b))},this.subscriberUpdate=function(a,b,c){this.publish(d.Raptor.Message.subscribers.update(d.APIKEY,g,a,b,c))},this.subscriberChannelUpdate=function(a,b,c,e){this.publish(d.Raptor.Message.subscriberChannels.update(d.APIKEY,g,a,b,c,e))},this.forceDisconnect=function(a,b){this.publish(d.Raptor.Message.connections.destroy(d.APIKEY,g,a),b)},this.forceUnpublish=function(a,b){this.publish(d.Raptor.Message.streams.destroy(d.APIKEY,g,a),b)},this.jsepCandidate=function(a,b){this.publish(d.Raptor.Message.streams.candidate(d.APIKEY,g,a,b))},this.jsepCandidateP2p=function(a,b,c){this.publish(d.Raptor.Message.subscribers.candidate(d.APIKEY,g,a,b,c))},this.jsepOffer=function(a,b){this.publish(d.Raptor.Message.offer(a,b))},this.jsepAnswer=function(a,b){this.publish(d.Raptor.Message.streams.answer(d.APIKEY,g,a,b))},this.jsepAnswerP2p=function(a,b,c){this.publish(d.Raptor.Message.subscribers.answer(d.APIKEY,g,a,b,c))},this.signal=function(a,b,c){var e=new d.Signal(g,i.id(),a||{});return e.valid?void this.publish(e.toRaptorMessage(),function(a){var f,g,h,i=[400,403,404,413];if(a)a.code&&d.$.arrayIndexOf(i,f.code)>-1?(g=a.code,h=a.message):(g=d.ExceptionCodes.UNEXPECTED_SERVER_RESPONSE,h="Unexpected server response. Try this operation again later."),f=new d.SignalError(g,h);else{var j=e.data?typeof e.data:null;c("signal","send",{type:j})}b&&d.$.isFunction(b)&&b(f,e.toHash())}):void(b&&d.$.isFunction(b)&&b(new n(e.error.code,e.error.reason),e.toHash()))},this.id=function(){return i&&i.id()},null==f&&(f=new d.Raptor.Dispatcher),j=f},d.GetStatsAudioLevelSampler=function(a){if(!d.$.hasCapabilities("audioOutputLevelStat"))throw new Error("The current platform does not provide the required capabilities");var b=a,c="audioOutputLevel";this.sample=function(a){b.getStats(function(b,d){if(!b)for(var e=0;e<d.length;e++){var f=d[e],g=parseFloat(f[c]);if(!isNaN(g))return void a(g/32768)}a(null)})}},d.AnalyserAudioLevelSampler=function(a){var b=this,c=null,e=null,f=null,g=function(b){var c=a.createMediaStreamSource(b),d=a.createAnalyser();return c.connect(d),d};d.$.defineProperties(b,{webRTCStream:{get:function(){return f},set:function(a){f=a,c=g(f),e=new Uint8Array(c.frequencyBinCount)}}}),this.sample=function(a){if(c){c.getByteTimeDomainData(e);for(var b=0,d=0;d<e.length;d++)b=Math.max(b,Math.abs(e[d]-128));a(b/128)}else a(null)}},d.AudioLevelTransformer=function(){var a=null;this.transform=function(b){a=null===a||b>=a?b:.3*b+.7*a;var c=Math.log(a)/Math.LN10/1.5+1;return Math.min(Math.max(c,0),1)}},d.audioContext=function(){var b=new a.AudioContext;return d.audioContext=function(){return b},b},d.Archive=function(a,b,c){this.id=a,this.name=b,this.status=c,this._={},d.$.eventing(this),this._.update=d.$.bind(function(a){for(var b in a)if(a.hasOwnProperty(b)){var c=this[b];this[b]=a[b];var e=new d.ArchiveUpdatedEvent(this,b,c,this[b]);this.dispatchEvent(e)}},this),this.destroy=function(){}},!function(){var a={},b={400:d.ExceptionCodes.INVALID_SESSION_ID,403:d.ExceptionCodes.AUTHENTICATION_ERROR,404:d.ExceptionCodes.INVALID_SESSION_ID,409:d.ExceptionCodes.TERMS_OF_SERVICE_FAILURE},c={RESPONSE_BADLY_FORMED:{code:null,message:"Unknown error: JSON response was badly formed"},UNEXPECTED_SERVER_RESPONSE:{code:d.ExceptionCodes.UNEXPECTED_SERVER_RESPONSE,message:"Unexpected server response. Try this operation again later."}},e=function(a){var b=d.$.clone(c.UNEXPECTED_SERVER_RESPONSE);return b.details={originalCode:a.code.toString(),originalMessage:a.message},b};a.getRequestParams=function(a,b){var c,e=d.properties.apiURL+"/"+a;return"IE"===d.$.env.name&&d.$.env.version<10?(e=e+"&format=json&token="+encodeURIComponent(b)+"&version=1&cache="+d.$.uuid(),c={xdomainrequest:!0}):c={headers:{"X-TB-TOKEN-AUTH":b,"X-TB-VERSION":1}},{url:e,options:c}},a.getErrorsFromHTTP=function(a){if(!a)return!1;var b={code:a.target&&a.target.status};return b},a.getErrorsFromResponse=function(a){if(!d.$.isArray(a))return c.RESPONSE_BADLY_FORMED;var b=d.$.find(a,function(a){return void 0!==a.error&&null!==a.error});return b?(b=b.error,b.message=b.errorMessage&&b.errorMessage.message,b):!1};var f=function(a,c){return a.code&&!b[a.code]?a=e(a):a.code=b[a.code],0===c.length?(a.code=d.ExceptionCodes.CONNECT_FAILED,c="Response body was empty, probably due to connectivity loss"):a.code||(a=e(a)),a.details||(a.details={}),a.details.responseText=c,a};a.get=function(b,c){var e=a.getRequestParams(b,c);return new d.$.RSVP.Promise(function(b,c){d.$.getJSON(e.url,e.options,function(e,g){var h,i=a.getErrorsFromHTTP(e)||a.getErrorsFromResponse(g);return i?(h=g&&!d.$.isEmpty(g)?JSON.stringify(g):"",i=f(i,h),void c(new d.$.Error(i.message,"AnvilError",{code:i.code,details:i.details}))):void b(g[0])})})},d.Anvil=a}(a),!function(){var a=[0,600,1200],b=[d.ExceptionCodes.CONNECT_FAILED,d.ExceptionCodes.UNEXPECTED_SERVER_RESPONSE];d.SessionInfo=function(a){d.log("SessionInfo Response:"),d.log(a),this.sessionId=a.session_id,this.partnerId=a.partner_id,this.sessionStatus=a.session_status,this.messagingServer=a.messaging_server_url,this.messagingURL=a.messaging_url,this.symphonyAddress=a.symphony_address,a.properties?(this.simulcast=a.properties.simulcast,this.p2pEnabled=!(!a.properties.p2p||!a.properties.p2p.preference||"enabled"!==a.properties.p2p.preference.value)):this.p2pEnabled=!1},d.SessionInfo.get=function(c,e){var f=a.slice(),g=function(a,h,i){return 0===f.length?void i(a):void d.Anvil.get("session/"+c+"?extended=true",e).then(function(a){h(new d.SessionInfo(a))},function(a){d.$.arrayIndexOf(b,a.code)>-1?setTimeout(function(){g(a,h,i)},f.shift()):i(a)})};return new d.$.RSVP.Promise(function(a,b){g(void 0,a,b)})}}(a),d.analytics=new d.Analytics(d.properties.loggingURL),d.Subscriber=function(a,b,c){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=d.$.uuid(),v=a||u,w=b.session,x=b.stream,y=100,z=d.$.hasCapabilities("audioOutputLevelStat")||d.$.hasCapabilities("webAudioCapableRemoteStream"),A=!1,B=this;if(m=d.$.defaults({},b,{showControls:!0,testNetwork:!1,fitMode:x.defaultFitMode||"cover"}),this.id=v,this.widgetId=u,this.session=w,this.stream=x=m.stream,this.streamId=x.id,o={timeStamp:d.$.now()},!w)return void d.handleJsException("Subscriber must be passed a session option",2e3,{session:w,target:this});d.$.eventing(this,!1),"function"==typeof c&&this.once("subscribeComplete",c),z&&this.on({"audioLevelUpdated:added":function(a){1===a&&r&&r.start()},"audioLevelUpdated:removed":function(a){0===a&&r&&r.stop()}});var C=function(a,b,c,e){var f=[{action:a,variation:b,payload:c,streamId:x?x.id:null,sessionId:w?w.sessionId:null,connectionId:w&&w.isConnected()?w.connection.connectionId:null,partnerId:w&&w.isConnected()?w.sessionInfo.partnerId:null,subscriberId:u}];e&&f.push(e),d.analytics.logEvent.apply(d.analytics,f)},D=function(a,b){"Attempt"!==a&&s||(s=new d.ConnectivityAttemptPinger({action:"Subscribe",sessionId:w?w.sessionId:null,connectionId:w&&w.isConnected()?w.connection.connectionId:null,
partnerId:w.isConnected()?w.sessionInfo.partnerId:null,streamId:x?x.id:null})),s.setVariation(a),C("Subscribe",a,b)},E=d.$.bind(function(a){var b={streamType:"WebRTC",width:e?Number(d.$.width(e.domElement).replace("px","")):null,height:e?Number(d.$.height(e.domElement).replace("px","")):null,sessionId:w?w.sessionId:null,connectionId:w?w.connection.connectionId:null,mediaServerName:w?w.sessionInfo.messagingServer:null,p2pFlag:w?w.sessionInfo.p2pEnabled:!1,partnerId:w?w.apiKey:null,streamId:x.id,subscriberId:u,version:d.properties.version,duration:parseInt(d.$.now()-k,10),remoteConnectionId:x.connection.connectionId};d.analytics.logQOS(d.$.extend(b,a)),this.trigger("qos",a)},this),F=function(a){d.error("Subscriber State Change Failed: ",a.message),d.debug(a)},G=function(){if(!n.isSubscribing()&&f){d.debug("OT.Subscriber.onLoaded"),n.set("Subscribing"),k=d.$.now();var a={pcc:parseInt(k-l,10),hasRelayCandidates:j&&j.hasRelayCandidates()};C("createPeerConnection","Success",a),e.loading(!1),g.showAfterLoading(),A&&x.setRestrictFrameRate(!0),h&&"auto"===B.getStyle("audioLevelDisplayMode")&&h[e.audioOnly()?"show":"hide"](),this.trigger("subscribeComplete",null,this),this.trigger("loaded",this),D("Success",{streamId:x.id})}},H=function(){d.debug("OT.Subscriber has been disconnected from the Publisher's PeerConnection"),n.isAttemptingToSubscribe()?(n.set("Failed"),this.trigger("subscribeComplete",new d.Error(null,"ClientDisconnected"))):n.isSubscribing()&&n.set("Failed"),this.disconnect()},I=d.$.bind(function(a,b,c,e){var f;n.isAttemptingToSubscribe()?(f={reason:e?e:"PeerConnectionError",message:"Subscriber PeerConnection Error: "+b,hasRelayCandidates:j&&j.hasRelayCandidates()},C("createPeerConnection","Failure",f),n.set("Failed"),this.trigger("subscribeComplete",new d.Error(null,b))):n.isSubscribing()&&(n.set("Failed"),this.trigger("error",b)),this.disconnect();var g;g="ICEWorkflow"===e?d.ExceptionCodes.SUBSCRIBER_ICE_WORKFLOW_FAILED:d.ExceptionCodes.P2P_CONNECTION_FAILED,f={reason:e?e:"PeerConnectionError",message:"Subscriber PeerConnection Error: "+b,code:g},D("Failure",f),d.handleJsException("Subscriber PeerConnection Error: "+b,g,{session:w,target:this}),Q.call(this,b)},this),J=function(a){d.debug("OT.Subscriber.onRemoteStreamAdded"),n.set("BindingRemoteStream"),this.subscribeToAudio(m.subscribeToAudio),p="loading",this.subscribeToVideo(m.subscribeToVideo,"loading"),this.setPreferredResolution(m.preferredResolution),this.setPreferredFrameRate(m.preferredFrameRate);var b={error:I,audioVolume:y},c=a.getVideoTracks();c.length>0&&d.$.forEach(c,function(a){a.setEnabled(x.hasVideo&&m.subscribeToVideo)}),f=e.bindVideo(a,b,d.$.bind(function(a){return a?void I(null,a.message||a,j,"VideoElement"):(f&&f.orientation({width:x.videoDimensions.width,height:x.videoDimensions.height,videoOrientation:x.videoDimensions.orientation}),void G.call(this,null))},this)),d.$.hasCapabilities("webAudioCapableRemoteStream")&&q&&a.getAudioTracks().length>0&&q.webRTCStream(a),C("createPeerConnection","StreamAdded"),this.trigger("streamAdded",this)},K=function(a){d.debug("OT.Subscriber.onStreamRemoved"),f.stream===a&&(f.destroy(),f=null),this.trigger("streamRemoved",this)},L=function(){this.disconnect()},M=function(a){switch(a.changedProperty){case"videoDimensions":if(!f)break;f.orientation({width:a.newValue.width,height:a.newValue.height,videoOrientation:a.newValue.orientation}),this.dispatchEvent(new d.VideoDimensionsChangedEvent(this,a.oldValue,a.newValue));break;case"videoDisableWarning":g.videoDisabledIndicator.setWarning(a.newValue),this.dispatchEvent(new d.VideoDisableWarningEvent(a.newValue?"videoDisableWarning":"videoDisableWarningLifted"));break;case"hasVideo":R(!(x.hasVideo&&m.subscribeToVideo)),this.dispatchEvent(new d.VideoEnabledChangedEvent(x.hasVideo?"videoEnabled":"videoDisabled",{reason:"publishVideo"}));break;case"hasAudio":}},N=function(a){if(a===!1)return"off";var b=this.getStyle("buttonDisplayMode");return b===!1?"on":b},O=function(a,b){if(g)switch(a){case"nameDisplayMode":g.name.setDisplayMode(b),g.backingBar.setNameMode(b);break;case"videoDisabledDisplayMode":g.videoDisabledIndicator.setDisplayMode(b);break;case"showArchiveStatus":g.archive.setShowArchiveStatus(b);break;case"buttonDisplayMode":g.muteButton.setDisplayMode(b),g.backingBar.setMuteMode(b);break;case"audioLevelDisplayMode":g.audioLevel.setDisplayMode(b);break;case"bugDisplayMode":case"backgroundImageURI":e.setBackgroundImageURI(b)}},P=function(){var a={backingBar:new d.Chrome.BackingBar({nameMode:m.name?this.getStyle("nameDisplayMode"):"off",muteMode:N.call(this,this.getStyle("showMuteButton"))}),name:new d.Chrome.NamePanel({name:m.name,mode:this.getStyle("nameDisplayMode")}),muteButton:new d.Chrome.MuteButton({muted:m.muted,mode:N.call(this,this.getStyle("showMuteButton"))}),archive:new d.Chrome.Archiving({show:this.getStyle("showArchiveStatus"),archiving:!1})};if(z){var b=new d.AudioLevelTransformer,c=function(a){h.setValue(b.transform(a.audioLevel))};h=new d.Chrome.AudioLevelMeter({mode:this.getStyle("audioLevelDisplayMode"),onActivate:function(){B.on("audioLevelUpdated",c)},onPassivate:function(){B.off("audioLevelUpdated",c)}}),a.audioLevel=h}a.videoDisabledIndicator=new d.Chrome.VideoDisabledIndicator({mode:this.getStyle("videoDisabledDisplayMode")}),g=new d.Chrome({parent:e.domElement}).set(a).on({muted:function(){T.call(this,!0)},unmuted:function(){T.call(this,!1)}},this),g.hideWhileLoading()},Q=function(){e&&e.addError("The stream was unable to connect due to a network error.","Make sure your connection isn't blocked by a firewall.")};d.StylableComponent(this,{nameDisplayMode:"auto",buttonDisplayMode:"auto",audioLevelDisplayMode:"auto",videoDisabledDisplayMode:"auto",backgroundImageURI:null,showArchiveStatus:!0,showMicButton:!0},m.showControls,function(a){C("SetStyle","Subscriber",a,.1)});var R=function(a){j&&j.subscribeToVideo(!a),e&&(e.audioOnly(a),e.showPoster(a)),h&&"auto"===B.getStyle("audioLevelDisplayMode")&&h[a?"show":"hide"]()},S=function(){var a=0;return function(){0===a&&C("GetStats","Called"),a++}}();this.destroy=function(a,b){return n.isDestroyed()?void 0:(n.isAttemptingToSubscribe()&&("streamDestroyed"===a?this.trigger("subscribeComplete",new d.Error(null,"InvalidStreamID")):(D("Canceled",{streamId:x.id}),s.stop())),n.set("Destroyed"),r&&r.stop(),this.disconnect(),g&&(g.destroy(),g=null),e&&(e.destroy(),e=null,this.element=null),x&&!x.destroyed&&C("unsubscribe",null,{streamId:x.id}),this.id=v=null,this.stream=x=null,this.streamId=null,this.session=w=null,m=null,b!==!0&&this.dispatchEvent(new d.DestroyedEvent(d.Event.names.SUBSCRIBER_DESTROYED,this,a),d.$.bind(this.off,this)),this)},this.disconnect=function(){n.isDestroyed()||n.isFailed()||n.set("NotSubscribing"),f&&(f.destroy(),f=null),j&&(j.destroy(),j=null,C("disconnect","PeerConnection",{streamId:x.id}))},this.processMessage=function(a,b,c){d.debug("OT.Subscriber.processMessage: Received "+a+" message from "+b.id),d.debug(c),i!==b.id&&(i=b.id),j&&j.processMessage(a,c)},this.disableVideo=function(a){if(a){if("auto"!==p)return void d.info("Video was not re-enabled because it was manually disabled");d.info("Video has been re-enabled"),g.videoDisabledIndicator.disableVideo(!1)}else d.warn("Due to high packet loss and low bandwidth, video has been disabled");this.subscribeToVideo(a,"auto"),a||g.videoDisabledIndicator.disableVideo(!0);var b=a?{videoEnabled:!0}:{videoDisabled:!0};C("updateQuality","video",b)},this.getImgData=function(){return this.isSubscribing()?f.imgData():(d.error("OT.Subscriber.getImgData: Cannot getImgData before the Subscriber is subscribing."),null)},this.getStats=function(a){return j?(S(),void j.getStats(function(b,c){if(b)return void a(b);var e={timestamp:0};d.$.forEach(c,function(a){if(d.getStatsHelpers.isInboundStat(a)){var b=d.getStatsHelpers.isVideoStat(a),c=d.getStatsHelpers.isAudioStat(a);(c||b)&&(e.timestamp=d.getStatsHelpers.normalizeTimestamp(a.timestamp)),b?e.video=d.getStatsHelpers.parseStatCategory(a):c&&(e.audio=d.getStatsHelpers.parseStatCategory(a))}}),a(null,e)})):void a(new d.$.Error("Subscriber is not connected cannot getStats",1015))},this.setAudioVolume=function(a){return a=parseInt(a,10),isNaN(a)?(d.error("OT.Subscriber.setAudioVolume: value should be an integer between 0 and 100"),this):(y=Math.max(0,Math.min(100,a)),y!==a&&d.warn("OT.Subscriber.setAudioVolume: value should be an integer between 0 and 100"),m.muted&&y>0&&(m.premuteVolume=a,T.call(this,!1)),f&&f.setAudioVolume(y),this)},this.getAudioVolume=function(){return m.muted?0:f?f.getAudioVolume():y},this.subscribeToAudio=function(a){var b=d.$.castToBoolean(a,!0);return j&&(j.subscribeToAudio(b&&!m.subscribeMute),w&&x&&b!==m.subscribeToAudio&&x.setChannelActiveState("audio",b&&!m.subscribeMute)),m.subscribeToAudio=b,this};var T=function(a){g.muteButton.muted(a),a!==m.mute&&("Chrome"===d.$.env.name||OTPlugin.isInstalled()?(m.subscribeMute=m.muted=a,this.subscribeToAudio(m.subscribeToAudio)):a?(m.premuteVolume=this.getAudioVolume(),m.muted=!0,this.setAudioVolume(0)):(m.premuteVolume||m.audioVolume)&&(m.muted=!1,this.setAudioVolume(m.premuteVolume||m.audioVolume)),m.mute=m.mute)},U={auto:"quality",publishVideo:"publishVideo",subscribeToVideo:"subscribeToVideo"};if(this.subscribeToVideo=function(a,b){var c=d.$.castToBoolean(a,!0);return R(!(c&&x.hasVideo)),c&&e&&e.video()&&x.hasVideo&&(e.loading(c),e.video().whenTimeIncrements(function(){e.loading(!1)},this)),g&&g.videoDisabledIndicator&&g.videoDisabledIndicator.disableVideo(!1),j&&w&&x&&(c!==m.subscribeToVideo||b!==p)&&x.setChannelActiveState("video",c,b),m.subscribeToVideo=c,p=b,"loading"!==b&&this.dispatchEvent(new d.VideoEnabledChangedEvent(c?"videoEnabled":"videoDisabled",{reason:U[b]||"subscribeToVideo"})),this},this.setPreferredResolution=function(a){if(n.isDestroyed()||!j)return void d.warn("Cannot set the max Resolution when not subscribing to a publisher");if(m.preferredResolution=a,w.sessionInfo.p2pEnabled)return void d.warn("Subscriber.setPreferredResolution will not work in a P2P Session");var b=x.getPreferredResolution(),c=b&&a&&b.width===a.width&&b.height===a.height||!b&&!a;c||x.setPreferredResolution(a)},this.setPreferredFrameRate=function(a){return n.isDestroyed()||!j?void d.warn("Cannot set the max frameRate when not subscribing to a publisher"):(m.preferredFrameRate=a,w.sessionInfo.p2pEnabled?void d.warn("Subscriber.setPreferredFrameRate will not work in a P2P Session"):void(x.getPreferredFrameRate()!=a&&x.setPreferredFrameRate(a)))},this.isSubscribing=function(){return n.isSubscribing()},this.isWebRTC=!0,this.isLoading=function(){return e&&e.loading()},this.videoElement=function(){return f.domElement()},this.videoWidth=function(){return f.videoWidth()},this.videoHeight=function(){return f.videoHeight()},this.restrictFrameRate=function(a){return d.debug("OT.Subscriber.restrictFrameRate("+a+")"),C("restrictFrameRate",a.toString(),{streamId:x.id}),w.sessionInfo.p2pEnabled&&d.warn("OT.Subscriber.restrictFrameRate: Cannot restrictFrameRate on a P2P session"),"boolean"!=typeof a?d.error("OT.Subscriber.restrictFrameRate: expected a boolean value got a "+typeof a):(A=a,x.setRestrictFrameRate(a)),this},this.on("styleValueChanged",O,this),this._={archivingStatus:function(a){g&&g.archive.setArchiving(a)},getDataChannel:function(a,b,c){return j?void j.getDataChannel(a,b,c):void c(new d.$.Error("Cannot create a DataChannel before there is a publisher connection."))}},n=new d.SubscribingState(F),d.debug("OT.Subscriber: subscribe to "+x.id),n.set("Init"),!x)return d.error("OT.Subscriber: No stream parameter."),!1;if(x.on({updated:M,destroyed:L},this),i=x.connection.id,m.name=m.name||x.name,m.classNames="OT_root OT_subscriber",m.style&&this.setStyle(m.style,null,!0),m.audioVolume&&this.setAudioVolume(m.audioVolume),m.subscribeToAudio=d.$.castToBoolean(m.subscribeToAudio,!0),m.subscribeToVideo=d.$.castToBoolean(m.subscribeToVideo,!0),e=new d.WidgetView(a,m),this.id=v=e.domId(),this.element=e.domElement,P.call(this),l=d.$.now(),C("createPeerConnection","Attempt",""),t=x.connection.id===w.connection.id,!m.testNetwork&&t){var V=w.getPublisherForStream(x);if(!V||!V._.webRtcStream())return this.trigger("subscribeComplete",new d.Error(null,"InvalidStreamID")),this;J.call(this,V._.webRtcStream())}else if(m.testNetwork&&this.setAudioVolume(0),n.set("ConnectingToPeer"),j=new d.SubscriberPeerConnection(x.connection,w,x,this,m),j.on({disconnected:H,error:I,remoteStreamAdded:J,remoteStreamRemoved:K,qos:E},this),j.init(function(a){if(a)throw a}),d.$.hasCapabilities("audioOutputLevelStat")?q=new d.GetStatsAudioLevelSampler(j,"out"):d.$.hasCapabilities("webAudioCapableRemoteStream")&&(q=new d.AnalyserAudioLevelSampler(d.audioContext())),q){var W=this;r=new d.IntervalRunner(function(){q.sample(function(a){null!==a&&d.$.requestAnimationFrame(function(){W.dispatchEvent(new d.AudioLevelUpdatedEvent(a))})})},60)}D("Attempt",{streamId:x.id})},d.Session=function(a,b){function c(a){return new d.$.RSVP.Promise(function(b,c){d.$.getJSON([d.properties.apiURL,"/v2/partner/",C,"/session/",E,"/connection/",G,"/testNetworkConfig"].join(""),{headers:{"X-TB-TOKEN-AUTH":a}},function(a,e){if(a){var f=JSON.parse(a.target.responseText);c(-1===f.code?new d.$.Error("Unexpected HTTP error codes "+a.target.status,"2001"):10001===f.code||10002===f.code?new d.$.Error(f.message,"1004"):new d.$.Error(f.message,f.code))}else b(e)})})}if(d.$.eventing(this),!d.checkSystemRequirements())return void d.upgradeSystemRequirements();null==b&&(b=a,a=null),this.id=this.sessionId=b;var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B=!0,C=a,D=this,E=b,F=d.$.uuid(),G=d.$.uuid(),H=d.$.statable(this,["disconnected","connecting","connected","disconnecting"],"disconnected");this.connection=null,this.connections=new d.$.Collection,this.streams=new d.$.Collection,this.archives=new d.$.Collection,g=function(a,b){H("disconnected"),d.error(a),this.trigger("sessionConnectFailed",new d.Error(b||d.ExceptionCodes.CONNECT_FAILED,a)),d.handleJsException(a,b||d.ExceptionCodes.CONNECT_FAILED,{session:this})},h=function(a){var b=a.reason;"networkTimedout"===b?(b="networkDisconnected",this.logEvent("Connect","TimeOutDisconnect",{reason:a.reason})):this.logEvent("Connect","Disconnected",{reason:a.reason});var c=new d.SessionDisconnectEvent("sessionDisconnected",b);r(),s.call(this,b);var e=d.$.bind(function(){t.call(this,c.reason),c.isDefaultPrevented()||u.call(this,c.reason)},this);this.dispatchEvent(c,e)},i=function(a){a.id.match(/^symphony\./)||this.dispatchEvent(new d.ConnectionEvent(d.Event.names.CONNECTION_CREATED,a))},j=function(a,b){a.id.match(/^symphony\./)||a.id!==f.id()&&this.dispatchEvent(new d.ConnectionEvent(d.Event.names.CONNECTION_DESTROYED,a,b))},k=function(a){a.connection.id!==this.connection.id&&this.dispatchEvent(new d.StreamEvent(d.Event.names.STREAM_CREATED,a,null,!1))},l=function(a){var b=a.target,c=a.changedProperty,e=a.newValue;"videoDisableWarning"!==c&&"audioDisableWarning"!==c&&("videoDimensions"===c&&(e={width:e.width,height:e.height}),this.dispatchEvent(new d.StreamPropertyChangedEvent(d.Event.names.STREAM_PROPERTY_CHANGED,b,c,a.oldValue,e)))},m=function(a,b){if(a.connection.id===this.connection.id)return void d.$.forEach(d.publishers.where({streamId:a.id}),d.$.bind(function(a){a._.unpublishFromSession(this,b)},this));var c=new d.StreamEvent("streamDestroyed",a,b,!0),e=d.$.bind(function(){c.isDefaultPrevented()||d.$.forEach(d.subscribers.where({streamId:a.id}),function(a){a.session.id===this.id&&a.stream&&a.destroy("streamDestroyed")},this)},this);this.dispatchEvent(c,e)},n=function(a){this.dispatchEvent(new d.ArchiveEvent("archiveStarted",a))},o=function(a){this.dispatchEvent(new d.ArchiveEvent("archiveDestroyed",a))},p=function(a){var b=a.target,c=a.changedProperty,e=a.newValue;"status"===c&&"stopped"===e?this.dispatchEvent(new d.ArchiveEvent("archiveStopped",b)):this.dispatchEvent(new d.ArchiveEvent("archiveUpdated",b))},q=function(){D.token=e=null,H("disconnected"),D.connection=null,D.capabilities=new d.Capabilities([]),D.connections.destroy(),D.streams.destroy(),D.archives.destroy()},r=function(){G=d.$.uuid(),q()},s=function(a){d.$.forEach(d.publishers.where({session:this}),function(b){b.disconnect(a)}),d.$.forEach(d.subscribers.where({session:this}),function(a){a.disconnect()})},t=function(a){d.$.forEach(d.publishers.where({session:this}),function(b){b._.streamDestroyed(a)})},u=function(a){d.$.forEach(d.subscribers.where({session:this}),function(b){b.destroy(a)})},v=function(){d.debug("OT.Session: connecting to Raptor");var a=this.sessionInfo.messagingURL,b=d.properties.symphonyAddresss||this.sessionInfo.symphonyAddress;f=new d.Raptor.Socket(G,F,a,b,d.SessionDispatcher(this)),f.connect(e,this.sessionInfo,d.$.bind(function(a,b){return a?(f=void 0,this.logConnectivityEvent("Failure",a),void g.call(this,a.message,a.code)):(d.debug("OT.Session: Received session state from Raptor",b),this.connection=this.connections.get(f.id()),this.connection&&(this.capabilities=this.connection.permissions),H("connected"),this.logConnectivityEvent("Success",null,{connectionId:this.connection.id}),this.connection.on("destroyed",h,this),this.connections.on({add:i,remove:j},this),this.streams.on({add:k,remove:m,update:l},this),this.archives.on({add:n,remove:o,update:p},this),void this.dispatchEvent(new d.SessionConnectEvent(d.Event.names.SESSION_CONNECTED),d.$.bind(function(){this.connections._triggerAddEvents(),this.streams._triggerAddEvents(),this.archives._triggerAddEvents()},this)))},this))},w=function(){if(this.is("connecting")){var a=this;this.logEvent("SessionInfo","Attempt"),d.SessionInfo.get(b,e).then(x,function(b){a.logConnectivityEvent("Failure",{reason:"GetSessionInfo",code:b.code||"No code",message:b.message}),g.call(a,b.message+(b.code?" ("+b.code+")":""),b.code)})}},x=d.$.bind(function(a){if(this.is("connecting")){this.logEvent("SessionInfo","Success",{messagingServer:a.messagingServer});var b=d.properties.sessionInfoOverrides;if(this.sessionInfo=a,null!=b&&"object"==typeof b&&(this.sessionInfo=d.$.defaults(b,this.sessionInfo)),this.sessionInfo.partnerId&&this.sessionInfo.partnerId!==C){this.apiKey=C=this.sessionInfo.partnerId;var c="Authentication Error: The API key does not match the token or session.",e={code:d.ExceptionCodes.AUTHENTICATION_ERROR,message:c};this.logEvent("Failure","SessionInfo",e),g.call(this,c,d.ExceptionCodes.AUTHENTICATION_ERROR)}else v.call(this)}},this),y=d.$.bind(function(a){return this.capabilities.permittedTo(a)},this),A=d.$.bind(function(a,b,c){d.error(a,b),c&&d.$.isFunction(c)&&c.call(null,new d.Error(a,b)),d.handleJsException(b,a,{session:this})},this),this.logEvent=function(a,b,c,e){var f={action:a,variation:b,payload:c,sessionId:E,partnerId:C};f.connectionId=G,e&&(f=d.$.extend(e,f)),d.analytics.logEvent(f)},this.testNetwork=function(a,b,e){var f=e;if(e=function(a,b){a?D.logEvent("TestNetwork","Failure",{failureCode:a.name||a.message||"unknown"}):D.logEvent("TestNetwork","Success",b),f(a,b)},D.logEvent("TestNetwork","Attempt",{}),this.isConnected())return void e(new d.$.Error("Session connected, cannot test network",1015));var g,h,i=new d.$.RSVP.Promise(function(a,c){var d=b._.webRtcStream();if(d)a(d);else{var e=function(){g(),a(b._.webRtcStream())},f=function(a){a&&(g(),c(a))},g=function(){b.off("publishComplete",f),b.off("accessAllowed",e)};b.on("publishComplete",f),b.on("accessAllowed",e)}});d.$.RSVP.Promise.all([c(a),i]).then(function(a){var b=a[1];return g=a[0],d.webrtcTest({mediaConfig:g.media,localStream:b})}).then(function(a){return d.debug("Received stats from webrtcTest: ",a),a.bandwidth<g.media.thresholdBitsPerSecond?d.$.RSVP.Promise.reject(new d.$.Error("The detect bandwidth from the WebRTC stage of the test was not sufficient to run the HTTP stage of the test",1553)):void(h=a)}).then(function(){return h.extended?void 0:d.httpTest({httpConfig:g.http})}).then(function(a){var b={uploadBitsPerSecond:a?a.uploadBandwidth:h.bandwidth,downloadBitsPerSecond:a?a.downloadBandwidth:h.bandwidth,packetLossRatio:h.packetLostRatio,roundTripTimeMilliseconds:h.roundTripTime};e(null,b)})["catch"](function(a){e(a)})},this.logConnectivityEvent=function(a,b,c){if("Attempt"===a||!z){var e={action:"Connect",sessionId:E,partnerId:C};this.connection&&this.connection.id?e=event.connectionId=this.connection.id:G&&(e.connectionId=G),z=new d.ConnectivityAttemptPinger(e)}z.setVariation(a),this.logEvent("Connect",a,b,c)},this.connect=function(b){arguments.length>1&&("string"==typeof arguments[0]||"number"==typeof arguments[0])&&"string"==typeof arguments[1]&&(null==a&&(C=b.toString()),b=arguments[1]);var c=arguments[arguments.length-1];if(this.is("connecting","connected"))return d.warn("OT.Session: Cannot connect, the session is already "+this.state),this;if(q(),H("connecting"),this.token=e=!d.$.isFunction(b)&&b,B?B=!1:F=d.$.uuid(),c&&d.$.isFunction(c)&&(this.once("sessionConnected",d.$.bind(c,null,null)),this.once("sessionConnectFailed",c)),null==C||d.$.isFunction(C))return setTimeout(d.$.bind(g,this,"API Key is undefined. You must pass an API Key to initSession.",d.ExceptionCodes.AUTHENTICATION_ERROR)),this;if(this.logConnectivityEvent("Attempt"),!E||d.$.isObject(E)||d.$.isArray(E)){var f;return E?(f="SessionID is not a string. You must use string as the session ID passed into OT.initSession().",E=E.toString()):f="SessionID is undefined. You must pass a sessionID to initSession.",setTimeout(d.$.bind(g,this,f,d.ExceptionCodes.INVALID_SESSION_ID)),this.logConnectivityEvent("Failure",{reason:"ConnectToSession",code:d.ExceptionCodes.INVALID_SESSION_ID,message:f}),this}return this.apiKey=C=C.toString(),0===d.APIKEY.length&&(d.APIKEY=C),w.call(this),this};var I=d.$.bind(function(a){f&&f.isNot("disconnected")?f.isNot("disconnecting")&&(H("disconnecting"),f.disconnect(a)):r()},this);this.disconnect=function(a){I(void 0!==a?a:!0)},this.destroy=function(a){this.streams.destroy(),this.connections.destroy(),this.archives.destroy(),I("unloaded"!==a)},this.publish=function(a,b,c){if("function"==typeof a&&(c=a,a=void 0),"function"==typeof b&&(c=b,b=void 0),this.isNot("connected"))return d.analytics.logError(1010,"OT.exception","We need to be connected before you can publish",null,{action:"Publish",variation:"Failure",payload:{reason:"unconnected",code:d.ExceptionCodes.NOT_CONNECTED,message:"We need to be connected before you can publish"},sessionId:E,streamId:a&&a.stream?a.stream.id:null,partnerId:C}),c&&d.$.isFunction(c)&&A(d.ExceptionCodes.NOT_CONNECTED,"We need to be connected before you can publish",c),null;if(!y("publish")){var e="This token does not allow publishing. The role must be at least `publisher` to enable this functionality",f={reason:"permission",code:d.ExceptionCodes.UNABLE_TO_PUBLISH,message:e};return this.logEvent("publish","Failure",f),A(d.ExceptionCodes.UNABLE_TO_PUBLISH,e,c),null}if(!a||"string"==typeof a||d.$.isElementNode(a))a=d.initPublisher(a,b);else{if(!(a instanceof d.Publisher))return void A(d.ExceptionCodes.UNABLE_TO_PUBLISH,"Session.publish :: First parameter passed in is neither a string nor an instance of the Publisher",c);"session"in a&&a.session&&"sessionId"in a.session&&(a.session.sessionId===this.sessionId?d.warn("Cannot publish "+a.guid()+" again to "+this.sessionId+". Please call session.unpublish(publisher) first."):d.warn("Cannot publish "+a.guid()+" publisher already attached to "+a.session.sessionId+". Please call session.unpublish(publisher) first."))}return a.once("publishComplete",function(){var a=Array.prototype.slice.call(arguments),b=a[0];b&&(b.message="Session.publish :: "+b.message,a[0]=b,d.error(b.code,b.message)),c&&d.$.isFunction(c)&&c.apply(null,a)}),a._.publishToSession(this),a},this.unpublish=function(a){return a?void a._.unpublishFromSession(this,"unpublished"):void d.error("OT.Session.unpublish: publisher parameter missing.")},this.subscribe=function(a,b,c,e){if("function"==typeof b&&(e=b,b=void 0,c=void 0),"function"==typeof c&&(e=c,c=void 0),!this.connection||!this.connection.connectionId)return void A(d.ExceptionCodes.UNABLE_TO_SUBSCRIBE,"Session.subscribe :: Connection required to subscribe",e);if(!a)return void A(d.ExceptionCodes.UNABLE_TO_SUBSCRIBE,"Session.subscribe :: stream cannot be null",e);if(!a.hasOwnProperty("streamId"))return void A(d.ExceptionCodes.UNABLE_TO_SUBSCRIBE,"Session.subscribe :: invalid stream object",e);var f=new d.Subscriber(b,d.$.extend(c||{},{stream:a,session:this}),function(a){if(a){var b,c,f=[400,403];!a.code&&d.$.arrayIndexOf(f,a.code)>-1?(b=d.OT.ExceptionCodes.UNABLE_TO_SUBSCRIBE,c="Session.subscribe :: "+a.message):(b=d.ExceptionCodes.UNEXPECTED_SERVER_RESPONSE,c="Unexpected server response. Try this operation again later."),A(b,c,e)}else e&&d.$.isFunction(e)&&e.apply(null,arguments)});return d.subscribers.add(f),f},this.unsubscribe=function(a){if(!a){var b="OT.Session.unsubscribe: subscriber cannot be null";throw d.error(b),new Error(b)}return a.stream?(d.debug("OT.Session.unsubscribe: subscriber "+a.id),a.destroy(),!0):(d.warn("OT.Session.unsubscribe:: tried to unsubscribe a subscriber that had no stream"),!1)},this.getSubscribersForStream=function(a){return d.subscribers.where({streamId:a.id})},this.getPublisherForStream=function(a){var b,c;if("string"==typeof a)b=a;else{if("object"!=typeof a||!a||!a.hasOwnProperty("id"))throw c="Session.getPublisherForStream :: Invalid stream type",d.error(c),new Error(c);b=a.id}return d.publishers.where({streamId:b})[0]},this._={jsepCandidateP2p:function(a,b,c){return f.jsepCandidateP2p(a,b,c)},jsepCandidate:function(a,b){return f.jsepCandidate(a,b)},jsepOffer:function(a,b){return f.jsepOffer(a,b)},jsepOfferP2p:function(a,b,c){return f.jsepOfferP2p(a,b,c)},jsepAnswer:function(a,b){return f.jsepAnswer(a,b)},jsepAnswerP2p:function(a,b,c){return f.jsepAnswerP2p(a,b,c)},dispatchSignal:d.$.bind(function(a,b,c){var e=new d.SignalEvent(b,c,a);e.target=this,this.trigger(d.Event.names.SIGNAL,e),b&&this.dispatchEvent(e)},this),subscriberCreate:function(a,b,c,d){return f.subscriberCreate(a.id,b.widgetId,c,d)},subscriberDestroy:function(a,b){return f.subscriberDestroy(a.id,b.widgetId)},subscriberUpdate:function(a,b,c){return f.subscriberUpdate(a.id,b.widgetId,c)},subscriberChannelUpdate:function(a,b,c,d){return f.subscriberChannelUpdate(a.id,b.widgetId,c.id,d)},streamCreate:function(a,b,c,e,g){f.streamCreate(a,b,c,e,d.Config.get("bitrates","min",d.APIKEY),d.Config.get("bitrates","max",d.APIKEY),g)},streamDestroy:function(a){f.streamDestroy(a)},streamChannelUpdate:function(a,b,c){f.streamChannelUpdate(a.id,b.id,c)}},this.signal=function(a,b){var c=a,e=b;if(d.$.isFunction(c)&&(e=c,c=null),this.isNot("connected")){var g="Unable to send signal - you are not connected to the session.";return void A(500,g,e)}f.signal(c,e,this.logEvent),a&&a.data&&"string"!=typeof a.data&&d.warn("Signaling of anything other than Strings is deprecated. Please update the data property to be a string.")},this.forceDisconnect=function(a,b){if(this.isNot("connected")){var c="Cannot call forceDisconnect(). You are not connected to the session.";return void A(d.ExceptionCodes.NOT_CONNECTED,c,b)}var e="string"==typeof a?a:a.id,g="Invalid Parameter. Check that you have passed valid parameter values into the method call.";if(!e)return void A(d.ExceptionCodes.INVALID_PARAMETER,g,b);var h="This token does not allow forceDisconnect. The role must be at least `moderator` to enable this functionality";return y("forceDisconnect")?void f.forceDisconnect(e,function(a){a?A(d.ExceptionCodes.INVALID_PARAMETER,g,b):b&&d.$.isFunction(b)&&b.apply(null,arguments)}):void A(d.ExceptionCodes.UNABLE_TO_FORCE_DISCONNECT,h,b)},this.forceUnpublish=function(a,b){if(this.isNot("connected")){var c="Cannot call forceUnpublish(). You are not connected to the session.";return void A(d.ExceptionCodes.NOT_CONNECTED,c,b)}var e="This token does not allow forceUnpublish. The role must be at least `moderator` to enable this functionality";if(y("forceUnpublish")){var g="string"==typeof a?this.streams.get(a):a;f.forceUnpublish(g.id,function(a){a?A(d.ExceptionCodes.UNABLE_TO_FORCE_UNPUBLISH,e,b):b&&d.$.isFunction(b)&&b.apply(null,arguments)})}else A(d.ExceptionCodes.UNABLE_TO_FORCE_UNPUBLISH,e,b)},this.isConnected=function(){return this.is("connected")},this.capabilities=new d.Capabilities([])};var R={audio:!0,video:!0};d.Publisher=function(b){if(!d.checkSystemRequirements())return void d.upgradeSystemRequirements();var c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=d.Publisher.nextId(),x={},y=!1,z=[1,7,15,30],A=d.$.hasCapabilities("webAudio"),B=b&&("screen"===b.videoSource||"window"===b.videoSource||"tab"===b.videoSource||"browser"===b.videoSource||"application"===b.videoSource),C=this;if(o=d.$.defaults(b||{},{publishAudio:B?!1:!0,publishVideo:!0,mirror:B?!1:!0,showControls:!0,fitMode:B?"contain":"cover",audioFallbackEnabled:B?!1:!0,maxResolution:B?{width:1920,height:1920}:void 0}),p={"320x240":{width:320,height:240},"640x480":{width:640,height:480},"1280x720":{width:1280,height:720}},q={timeStamp:d.$.now()},d.$.eventing(this),!B&&A){t=new d.AnalyserAudioLevelSampler(d.audioContext());var D=new d.IntervalRunner(function(){t.sample(function(a){d.$.requestAnimationFrame(function(){C.dispatchEvent(new d.AudioLevelUpdatedEvent(a))})})},60);this.on({"audioLevelUpdated:added":function(a){1===a&&D.start()},"audioLevelUpdated:removed":function(a){0===a&&D.stop()}})}var E=function(a,b,c,e){d.analytics.logEvent({action:a,variation:b,payload:c,sessionId:j?j.sessionId:null,connectionId:j&&j.isConnected()?j.connection.connectionId:null,partnerId:j?j.apiKey:d.APIKEY,streamId:h},e)},F=function(a,b){"Attempt"!==a&&u||(u=new d.ConnectivityAttemptPinger({action:"Publish",sessionId:j?j.sessionId:null,connectionId:j&&j.isConnected()?j.connection.connectionId:null,partnerId:j?j.apiKey:d.APIKEY,streamId:h})),"Failure"===a&&"Non-fatal"!==b.reason&&u.setVariation(a),E("Publish",a,b)},G=d.$.bind(function(a,b){var c={streamType:"WebRTC",sessionId:j?j.sessionId:null,connectionId:j&&j.isConnected()?j.connection.connectionId:null,partnerId:j?j.apiKey:d.APIKEY,streamId:h,width:e?Number(d.$.width(e.domElement).replace("px","")):void 0,height:e?Number(d.$.height(e.domElement).replace("px","")):void 0,version:d.properties.version,mediaServerName:j?j.sessionInfo.messagingServer:null,p2pFlag:j?j.sessionInfo.p2pEnabled:!1,duration:k?(new Date).getTime()-k.getTime():0,remoteConnectionId:a.id,scalableVideo:!!v};d.analytics.logQOS(d.$.extend(c,b)),this.trigger("qos",b)},this),H=function(){var a,b;return o.videoDimensions?(a=Math.min(o.videoDimensions.width,f.videoWidth()||640),b=Math.min(o.videoDimensions.height,f.videoHeight()||480)):(a=f.videoWidth()||640,b=f.videoHeight()||480),{width:a,height:b}},I=function(a){d.error("Publisher State Change Failed: ",a.message),d.debug(a)},J=d.$.bind(function(){r.isDestroyed()||(d.debug("OT.Publisher.onLoaded"),r.set("MediaBound"),e.loading(this.session?!g:!1),y=!0,$.call(this),this.trigger("initSuccess"),this.trigger("loaded",this))},this),K=d.$.bind(function(a){var b=d.ExceptionCodes.P2P_CONNECTION_FAILED,c={reason:"Publisher PeerConnection Error: ",code:b,message:a};F("Failure",c),r.set("Failed"),this.trigger("publishComplete",new d.Error(b,"Publisher PeerConnection Error: "+a)),d.handleJsException("Publisher PeerConnection Error: "+a,d.ExceptionCodes.P2P_CONNECTION_FAILED,{session:j,target:this})},this),L=d.$.bind(function(a){d.debug("OT.Publisher.onStreamAvailable"),r.set("BindingMedia"),W(),i=a,l=new d.Microphone(i,!o.publishAudio),this.publishVideo(o.publishVideo&&i.getVideoTracks().length>0),this.accessAllowed=!0,this.dispatchEvent(new d.Event(d.Event.names.ACCESS_ALLOWED,!1));var b={muted:!0,error:S};f=e.bindVideo(i,b,function(a){return a?void K(a):void J()}),t&&i.getAudioTracks().length>0&&t.webRTCStream(i)},this),M=d.$.bind(function(a){d.error("OT.Publisher.onStreamAvailableError "+a.name+": "+a.message),r.set("Failed"),this.trigger("publishComplete",new d.Error(d.ExceptionCodes.UNABLE_TO_PUBLISH,a.message)),
e&&e.destroy();var b={reason:"GetUserMedia",code:d.ExceptionCodes.UNABLE_TO_PUBLISH,message:"Publisher failed to access camera/mic: "+a.message};F("Failure",b),d.handleJsException(b.reason,b.code,{session:j,target:this})},this),N=d.$.bind(function(a){d.error("OT.Publisher.onScreenSharingError "+a.message),r.set("Failed"),this.trigger("publishComplete",new d.Error(d.ExceptionCodes.UNABLE_TO_PUBLISH,"Screensharing: "+a.message));var b={reason:"ScreenSharing",message:a.message};F("Failure",b)},this),O=d.$.bind(function(b){B&&"https:"!==a.location.protocol&&(b.message+=" Note: https:// is required for screen sharing."),d.error("OT.Publisher.onStreamAvailableError Permission Denied"),r.set("Failed");var c="Publisher Access Denied: Permission Denied"+(b.message?": "+b.message:""),e=d.ExceptionCodes.UNABLE_TO_PUBLISH;this.trigger("publishComplete",new d.Error(e,c));var f={reason:"GetUserMedia",code:e,message:c};F("Failure",f),this.dispatchEvent(new d.Event(d.Event.names.ACCESS_DENIED))},this),P=d.$.bind(function(){E("accessDialog","Opened"),this.dispatchEvent(new d.Event(d.Event.names.ACCESS_DIALOG_OPENED,!0))},this),Q=d.$.bind(function(){E("accessDialog","Closed"),this.dispatchEvent(new d.Event(d.Event.names.ACCESS_DIALOG_CLOSED,!1))},this),S=d.$.bind(function(a,b){d.error("OT.Publisher.onVideoError");var c=b+(a?" ("+a+")":"");E("stream",null,{reason:"Publisher while playing stream: "+c}),r.set("Failed"),r.isAttemptingToPublish()?this.trigger("publishComplete",new d.Error(d.ExceptionCodes.UNABLE_TO_PUBLISH,c)):this.trigger("error",c),d.handleJsException("Publisher error playing stream: "+c,d.ExceptionCodes.UNABLE_TO_PUBLISH,{session:j,target:this})},this),T=d.$.bind(function(a){d.debug("OT.Subscriber has been disconnected from the Publisher's PeerConnection"),this.cleanupSubscriber(a.remoteConnection().id)},this),U=d.$.bind(function(a,b,c,e){var f;f="ICEWorkflow"===e?d.ExceptionCodes.PUBLISHER_ICE_WORKFLOW_FAILED:d.ExceptionCodes.UNABLE_TO_PUBLISH;var g={reason:e?e:"PeerConnectionError",code:f,message:(e?e:"")+":Publisher PeerConnection with connection "+(c&&c.remoteConnection&&c.remoteConnection().id)+" failed: "+b,hasRelayCandidates:c.hasRelayCandidates()};r.isPublishing()?g.reason="Non-fatal":this.trigger("publishComplete",new d.Error(d.ExceptionCodes.UNABLE_TO_PUBLISH,g.message)),F("Failure",g),d.handleJsException("Publisher PeerConnection Error: "+b,f,{session:j,target:this}),delete x[c.remoteConnection().id]},this),V=d.$.bind(function(a){this.stream=g=a,g.on("destroyed",this.disconnect,this),r.set("Publishing"),e.loading(!y),k=new Date,this.trigger("publishComplete",null,this),this.dispatchEvent(new d.StreamEvent("streamCreated",a,null,!1));var b={streamType:"WebRTC"};F("Success",b)},this),W=function(){if(i){if(i.stop)i.stop();else{var a=i.getAudioTracks().concat(i.getVideoTracks());a.forEach(function(a){a.stop()})}i=null}},X=d.$.bind(function(a,c){var e=x[a.id];if(e)d.$.callAsync(function(){c(void 0,e)});else{var f=d.$.now();E("createPeerConnection","Attempt"),a.on("destroyed",d.$.bind(this.cleanupSubscriber,this,a.id));var g=1;if(v=!1,"Chrome"!==d.$.env.name||B||j.sessionInfo.p2pEnabled||!o.constraints.video||(v=j.sessionInfo.simulcast,void 0===v&&(v=b&&b._enableSimulcast)),v){var k=H();g=k.width>640&&k.height>480?3:2}e=x[a.id]=new d.PublisherPeerConnection(a,j,h,i,o.channels,g),e.on({connected:function(){var a={pcc:parseInt(d.$.now()-f,10),hasRelayCandidates:e.hasRelayCandidates()};E("createPeerConnection","Success",a)},disconnected:T,error:U,qos:G},this),e.init(s,c)}},this),Y=function(a){if(a===!1)return"off";var b=this.getStyle("buttonDisplayMode");return b===!1?"on":b},Z=function(a,b){if(m)switch(a){case"nameDisplayMode":m.name.setDisplayMode(b),m.backingBar.setNameMode(b);break;case"showArchiveStatus":E("showArchiveStatus","styleChange",{mode:b?"on":"off"}),m.archive.setShowArchiveStatus(b);break;case"buttonDisplayMode":m.muteButton.setDisplayMode(b),m.backingBar.setMuteMode(b);break;case"audioLevelDisplayMode":m.audioLevel.setDisplayMode(b);break;case"backgroundImageURI":e.setBackgroundImageURI(b)}},$=function(){this.getStyle("showArchiveStatus")||E("showArchiveStatus","createChrome",{mode:"off"});var a={backingBar:new d.Chrome.BackingBar({nameMode:o.name?this.getStyle("nameDisplayMode"):"off",muteMode:Y.call(this,this.getStyle("buttonDisplayMode"))}),name:new d.Chrome.NamePanel({name:o.name,mode:this.getStyle("nameDisplayMode")}),muteButton:new d.Chrome.MuteButton({muted:o.publishAudio===!1,mode:Y.call(this,this.getStyle("buttonDisplayMode"))}),archive:new d.Chrome.Archiving({show:this.getStyle("showArchiveStatus"),archiving:!1})};if(A){var b=new d.AudioLevelTransformer,c=function(a){n.setValue(b.transform(a.audioLevel))};n=new d.Chrome.AudioLevelMeter({mode:this.getStyle("audioLevelDisplayMode"),onActivate:function(){C.on("audioLevelUpdated",c)},onPassivate:function(){C.off("audioLevelUpdated",c)}}),a.audioLevel=n}m=new d.Chrome({parent:e.domElement}).set(a).on({muted:d.$.bind(this.publishAudio,this,!1),unmuted:d.$.bind(this.publishAudio,this,!0)}),aa()},_=d.$.bind(function(){m&&(m.destroy(),m=null),this.disconnect(),l=null,f&&(f.destroy(),f=null),W(),e&&(e.destroy(),e=null),j&&this._.unpublishFromSession(j,"reset"),this.id=c=null,this.stream=g=null,y=!1,this.session=j=null,r.isDestroyed()||r.set("NotPublishing")},this);d.StylableComponent(this,{showArchiveStatus:!0,nameDisplayMode:"auto",buttonDisplayMode:"auto",audioLevelDisplayMode:B?"off":"auto",backgroundImageURI:null},o.showControls,function(a){E("SetStyle","Publisher",a,.1)});var aa=function(){n&&"auto"===C.getStyle("audioLevelDisplayMode")&&(!o.publishVideo&&o.publishAudio?n.show():n.hide())},ba=function(a){e&&(e.audioOnly(a),e.showPoster(a)),aa()};this.publish=function(a){if(d.debug("OT.Publisher: publish"),(r.isAttemptingToPublish()||r.isPublishing())&&_(),r.set("GetUserMedia"),o.constraints)d.warn("You have passed your own constraints not using ours");else if(o.constraints=d.$.clone(R),B&&(null!=o.audioSource&&d.warn("Invalid audioSource passed to Publisher - when using screen sharing no audioSource may be used"),o.audioSource=null),null===o.audioSource||o.audioSource===!1?(o.constraints.audio=!1,o.publishAudio=!1):("object"==typeof o.audioSource&&(null!=o.audioSource.deviceId?o.audioSource=o.audioSource.deviceId:d.warn("Invalid audioSource passed to Publisher. Expected either a device ID")),o.audioSource&&("object"!=typeof o.constraints.audio&&(o.constraints.audio={}),o.constraints.audio.mandatory||(o.constraints.audio.mandatory={}),o.constraints.audio.optional||(o.constraints.audio.optional=[]),o.constraints.audio.mandatory.sourceId=o.audioSource)),null===o.videoSource||o.videoSource===!1)o.constraints.video=!1,o.publishVideo=!1;else{"object"==typeof o.videoSource&&null==o.videoSource.deviceId&&(d.warn("Invalid videoSource passed to Publisher. Expected either a device ID or device."),o.videoSource=null);var f=function(){"object"!=typeof o.constraints.video&&(o.constraints.video={}),o.constraints.video.mandatory||(o.constraints.video.mandatory={}),o.constraints.video.optional||(o.constraints.video.optional=[])};if(o.videoSource){f();var h=o.constraints.video.mandatory;B||(null!=o.videoSource.deviceId?h.sourceId=o.videoSource.deviceId:h.sourceId=o.videoSource)}o.resolution&&(p.hasOwnProperty(o.resolution)?(o.videoDimensions=p[o.resolution],f(),"Chrome"===d.$.env.name&&(o.constraints.video.optional=o.constraints.video.optional.concat([{minWidth:o.videoDimensions.width},{maxWidth:o.videoDimensions.width},{minHeight:o.videoDimensions.height},{maxHeight:o.videoDimensions.height}]))):d.warn("Invalid resolution passed to the Publisher. Got: "+o.resolution+' expecting one of "'+d.$.keys(p).join('","')+'"')),o.maxResolution&&(f(),o.maxResolution.width>1920&&(d.warn("Invalid maxResolution passed to the Publisher. maxResolution.width must be less than or equal to 1920"),o.maxResolution.width=1920),o.maxResolution.height>1920&&(d.warn("Invalid maxResolution passed to the Publisher. maxResolution.height must be less than or equal to 1920"),o.maxResolution.height=1920),o.videoDimensions=o.maxResolution,"Chrome"===d.$.env.name&&(f(),o.constraints.video.mandatory.maxWidth=o.videoDimensions.width,o.constraints.video.mandatory.maxHeight=o.videoDimensions.height)),void 0!==o.frameRate&&-1===d.$.arrayIndexOf(z,o.frameRate)?(d.warn("Invalid frameRate passed to the publisher got: "+o.frameRate+" expecting one of "+z.join(",")),delete o.frameRate):o.frameRate&&(f(),o.constraints.video.optional=o.constraints.video.optional.concat([{minFrameRate:o.frameRate},{maxFrameRate:o.frameRate}]))}return o.style&&this.setStyle(o.style,null,!0),o.name&&(o.name=o.name.toString()),o.classNames="OT_root OT_publisher",d.onLoad(function(){e=new d.WidgetView(a,o),C.id=c=e.domId(),C.element=e.domElement,e.on("videoDimensionsChanged",function(a,b){g&&g.setVideoDimensions(b.width,b.height),C.dispatchEvent(new d.VideoDimensionsChangedEvent(C,a,b))}),e.on("mediaStopped",function(){var a=new d.MediaStoppedEvent(C);C.dispatchEvent(a,function(){a.isDefaultPrevented()||(j?C._.unpublishFromSession(j,"mediaStopped"):C.destroy("mediaStopped"))})}),d.$.waterfall([function(a){B?d.checkScreenSharingCapability(function(c){if(c.supported)if(c.extensionRegistered===!1)N(new Error("Screen Sharing support in this browser requires an extension, but one has not been registered."));else if(c.extensionInstalled===!1)N(new Error("Screen Sharing support in this browser requires an extension, but the extension is not installed."));else{var e=d.pickScreenSharingHelper();e.proto.getConstraintsShowsPermissionUI&&P(),e.instance.getConstraints(b.videoSource,o.constraints,function(b,c){e.proto.getConstraintsShowsPermissionUI&&Q(),b?"PermissionDeniedError"===b.message?O(b):N(b):(o.constraints=c,a())})}else N(new Error("Screen Sharing is not supported in this browser"))}):d.$.shouldAskForDevices(function(b){b.video||(d.warn("Setting video constraint to false, there are no video sources"),o.constraints.video=!1),b.audio||(d.warn("Setting audio constraint to false, there are no audio sources"),o.constraints.audio=!1),a()})},function(){r.isDestroyed()||d.$.getUserMedia(o.constraints,L,M,P,Q,O)}])},this),this},this.publishAudio=function(a){return o.publishAudio=a,l&&l.muted(!a),m&&m.muteButton.muted(!a),j&&g&&g.setChannelActiveState("audio",a),aa(),this},this.publishVideo=function(a){var b=o.publishVideo;if(o.publishVideo=a,j&&g&&o.publishVideo!==b&&g.setChannelActiveState("video",a),i)for(var c=i.getVideoTracks(),d=0,e=c.length;e>d;++d)c[d].setEnabled(a);return ba(!a),this},this.destroy=function(a,b){return r.isAttemptingToPublish()&&(u&&(u.stop(),u=null),j&&F("Canceled")),r.isDestroyed()?void 0:(r.set("Destroyed"),_(),b!==!0&&this.dispatchEvent(new d.DestroyedEvent(d.Event.names.PUBLISHER_DESTROYED,this,a),d.$.bind(this.off,this)),this)},this.disconnect=function(){for(var a in x)this.cleanupSubscriber(a)},this.cleanupSubscriber=function(a){var b=x[a];b&&(b.destroy(),delete x[a],E("disconnect","PeerConnection",{subscriberConnection:a}))},this.processMessage=function(a,b,c){switch(d.debug("OT.Publisher.processMessage: Received "+a+" from "+b.id),d.debug(c),a){case"unsubscribe":this.cleanupSubscriber(c.content.connection.id);break;default:X(b,function(b,d){if(b)throw b;d.processMessage(a,c)})}},this.getImgData=function(){return y?f.imgData():(d.error("OT.Publisher.getImgData: Cannot getImgData before the Publisher is publishing."),null)},this._={publishToSession:d.$.bind(function(a){this.session=j=a,h=d.$.uuid();var b=function(){if(j){r.set("PublishingToSession");var b=d.$.bind(function(a,b,c){if(a){var e,f,g=[403,404,409];a.code&&d.$.arrayIndexOf(g,a.code)>-1?(e=d.ExceptionCodes.UNABLE_TO_PUBLISH,f=a.message):(e=d.ExceptionCodes.UNEXPECTED_SERVER_RESPONSE,f="Unexpected server response. Try this operation again later.");var i={reason:"Publish",code:e,message:f};return F("Failure",i),r.isAttemptingToPublish()&&this.trigger("publishComplete",new d.Error(e,f)),void d.handleJsException(a.message,e,{session:j,target:this})}this.streamId=h=b,s=d.Raptor.parseIceServers(c)},this),c=H(),e=[];null!==o.videoSource&&o.videoSource!==!1&&e.push(new d.StreamChannel({id:"video1",type:"video",active:o.publishVideo,orientation:d.VideoOrientation.ROTATED_NORMAL,frameRate:o.frameRate,width:c.width,height:c.height,source:B?"screen":"camera",fitMode:o.fitMode})),null!==o.audioSource&&o.audioSource!==!1&&e.push(new d.StreamChannel({id:"audio1",type:"audio",active:o.publishAudio})),a._.streamCreate(o.name||"",h,o.audioFallbackEnabled,e,b)}};return y?b.call(this):this.on("initSuccess",b,this),F("Attempt",{streamType:"WebRTC",dataChannels:o.channels}),this},this),unpublishFromSession:d.$.bind(function(a,b){return j&&a.id===j.id?(a.isConnected()&&this.stream&&a._.streamDestroy(this.stream.id),this.disconnect(),r.isAttemptingToPublish()&&F("Canceled"),this.session=j=null,r.isDestroyed()||r.set("MediaBound"),u&&(u.stop(),u=null),E("unpublish","Success",{sessionId:a.id}),this._.streamDestroyed(b),this):(d.warn("The publisher "+w+" is trying to unpublish from a session "+a.id+" it is not attached to (it is attached to "+(j&&j.id||"no session")+")"),this)},this),streamDestroyed:d.$.bind(function(a){if(d.$.arrayIndexOf(["reset"],a)<0){var b=new d.StreamEvent("streamDestroyed",g,a,!0),c=d.$.bind(function(){b.isDefaultPrevented()||this.destroy()},this);this.dispatchEvent(b,c)}},this),archivingStatus:d.$.bind(function(a){return m&&m.archive.setArchiving(a),a},this),webRtcStream:function(){return i},switchTracks:function(){return new Promise(function(a,b){d.$.getUserMedia(o.constraints,function(c){W(),i=c,l=new d.Microphone(i,!o.publishAudio);var g={muted:!0,error:S};f=e.bindVideo(i,g,function(a){a&&(K(a),b(a))}),t&&i.getAudioTracks().length>0&&t.webRTCStream(i);var h=[];Object.keys(x).forEach(function(a){var b=x[a];b.getSenders().forEach(function(a){"audio"===a.track.kind&&c.getAudioTracks().length?h.push(a.replaceTrack(c.getAudioTracks()[0])):"video"===a.track.kind&&c.getVideoTracks().length&&h.push(a.replaceTrack(c.getVideoTracks()[0]))})}),Promise.all(h).then(a,b)},function(a){M(a),b(a)},P,Q,function(a){O(a),b(a)})})},switchAcquiredWindow:function(a){if("Firefox"!==d.$.env.name||d.$.env.version<38)throw new Error("switchAcquiredWindow is an experimental method and is not supported bythe current platform");"undefined"!=typeof a&&(o.constraints.video.browserWindow=a),E("SwitchAcquiredWindow","Attempt",{constraints:o.constraints});var b=C._.switchTracks();return b.then(function(){E("SwitchAcquiredWindow","Success",{constraints:o.constraints})},function(a){E("SwitchAcquiredWindow","Failure",{error:a,constraints:o.constraints})}),b},getDataChannel:function(a,b,c){var e=x[d.$.keys(x)[0]];return e?void e.getDataChannel(a,b,c):void c(new d.$.Error("Cannot create a DataChannel before there is a subscriber."))}},this.detectDevices=function(){d.warn("Fixme: Haven't implemented detectDevices")},this.detectMicActivity=function(){d.warn("Fixme: Haven't implemented detectMicActivity")},this.getEchoCancellationMode=function(){return d.warn("Fixme: Haven't implemented getEchoCancellationMode"),"fullDuplex"},this.setMicrophoneGain=function(){d.warn("Fixme: Haven't implemented setMicrophoneGain")},this.getMicrophoneGain=function(){return d.warn("Fixme: Haven't implemented getMicrophoneGain"),.5},this.setCamera=function(){d.warn("Fixme: Haven't implemented setCamera")},this.setMicrophone=function(){d.warn("Fixme: Haven't implemented setMicrophone")},this.guid=function(){return w},this.videoElement=function(){return f.domElement()},this.setStream=V,this.isWebRTC=!0,this.isLoading=function(){return e&&e.loading()},this.videoWidth=function(){return f.videoWidth()},this.videoHeight=function(){return f.videoHeight()},this.on("styleValueChanged",Z,this),r=new d.PublishingState(I),this.accessAllowed=!1},d.Publisher.nextId=d.$.uuid,d.initSession=function(a,b){null==b&&(b=a,a=null),d.$.isArray(b)&&1===b.length&&(b=b[0]);var c=d.sessions.get(b);return c||(c=new d.Session(a,b),d.sessions.add(c)),c},d.initPublisher=function(a,b,c){d.debug("OT.initPublisher("+a+")"),"string"!=typeof a||document.getElementById(a)||(a=b,b=c,c=arguments[3]),"function"==typeof a?(c=a,b=void 0,a=void 0):d.$.isObject(a)&&!d.$.isElementNode(a)&&(c=b,b=a,a=void 0),"function"==typeof b&&(c=b,b=void 0);var e=new d.Publisher(b);d.publishers.add(e);var f=function(){c&&d.$.isFunction(c)&&c.apply(null,arguments)},g=function(a){e.off("publishComplete",h),f(a)},h=function(a){e.off("initSuccess",g),a&&f(a)};return e.once("initSuccess",g),e.once("publishComplete",h),e.publish(a),e},d.getDevices=function(a){d.$.getMediaDevices(a)},d.reportIssue=function(a){function b(b){if(b){if(a&&!g){var h=new d.Error(d.ExceptionCodes.REPORT_ISSUE_ERROR,"Error calling OT.reportIssue(). Check the client's network connection.");a(h),g=!0}}else f++,f>=e&&a&&!g&&a(null,c)}var c=d.$.uuid(),e=d.sessions.length(),f=0,g=!1,h={action:"ReportIssue",payload:{reportIssueId:c}};0===e?d.analytics.logEvent(h,null,b):d.sessions.forEach(function(a){var c=d.$.extend({sessionId:a.sessionId,partnerId:a.isConnected()?a.sessionInfo.partnerId:null},h);d.analytics.logEvent(c,null,b)})},d.components={},d.onUnload(function(){d.publishers.destroy(),d.subscribers.destroy(),d.sessions.destroy("unloaded")}),K(d.properties.cssURL),"function"==typeof define&&define.amd&&define("TB",[],function(){return TB})}(a,a.OT)}(window||exports);
//# sourceMappingURL=TB.js.map